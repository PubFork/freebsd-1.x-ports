#!/bin/sh

pre=l
fns=`ls ${pre}*.c | sed -e 's/^'${pre}'\(.*\)\.c$/\1/'`

message="This file is automatically generated by maketable -- DO NOT EDIT!"

echo "/* $message */" > table.h

for x in $fns; do
  info=`sed -e '1,/---INFOBEGIN---/d
		/---INFOEND---/,$d
		s/	/ /g
		s/^  *//
		s/  *$//' ${pre}${x}.c`

  echo "$info" |
    sed -e '/^COMMAND/ !d
	    s/COMMAND *//
	    s/^\([^ ]* *[^ ]* *\)remote\(  *.*\)$/\1REMOTEGLOB\2/
	    s/^\([^ ]* *[^ ]* *\)local\(  *.*\)$/\1LOCALGLOB\2/
	    s/^\([^ ]* *[^ ]* *\)none\(  *.*\)$/\1NOGLOB\2/
	    s/^/CMD(/
	    s/  */,'${pre}${x}_main',/
	    s/  */,/
	    s/$/)/' >> table.h
done
