%!PS-Adobe-2.0
%%Creator: dvips 5.497 Copyright 1986, 1992 Radical Eye Software
%%Title: manual.dvi
%%CreationDate: Mon Feb 15 18:01:38 1993
%%Pages: 58
%%PageOrder: Ascend
%%BoundingBox: 0 0 612 792
%%DocumentFonts: Times-Roman Times-Bold Times-Italic
%%EndComments
%DVIPSCommandLine: /usr/local/tex/bin/dvips -o manual.ps manual.dvi
%DVIPSSource:  TeX output 1993.02.15:1801
%%BeginProcSet: tex.pro
/TeXDict 250 dict def TeXDict begin /N{def}def /B{bind def}N /S{exch}N /X{S N}
B /TR{translate}N /isls false N /vsize 11 72 mul N /@rigin{isls{[0 -1 1 0 0 0]
concat}if 72 Resolution div 72 VResolution div neg scale isls{Resolution hsize
-72 div mul 0 TR}if Resolution VResolution vsize -72 div 1 add mul TR matrix
currentmatrix dup dup 4 get round 4 exch put dup dup 5 get round 5 exch put
setmatrix}N /@landscape{/isls true N}B /@manualfeed{statusdict /manualfeed
true put}B /@copies{/#copies X}B /FMat[1 0 0 -1 0 0]N /FBB[0 0 0 0]N /nn 0 N
/IE 0 N /ctr 0 N /df-tail{/nn 8 dict N nn begin /FontType 3 N /FontMatrix
fntrx N /FontBBox FBB N string /base X array /BitMaps X /BuildChar{
CharBuilder}N /Encoding IE N end dup{/foo setfont}2 array copy cvx N load 0 nn
put /ctr 0 N[}B /df{/sf 1 N /fntrx FMat N df-tail}B /dfs{div /sf X /fntrx[sf 0
0 sf neg 0 0]N df-tail}B /E{pop nn dup definefont setfont}B /ch-width{ch-data
dup length 5 sub get}B /ch-height{ch-data dup length 4 sub get}B /ch-xoff{128
ch-data dup length 3 sub get sub}B /ch-yoff{ch-data dup length 2 sub get 127
sub}B /ch-dx{ch-data dup length 1 sub get}B /ch-image{ch-data dup type
/stringtype ne{ctr get /ctr ctr 1 add N}if}B /id 0 N /rw 0 N /rc 0 N /gp 0 N
/cp 0 N /G 0 N /sf 0 N /CharBuilder{save 3 1 roll S dup /base get 2 index get
S /BitMaps get S get /ch-data X pop /ctr 0 N ch-dx 0 ch-xoff ch-yoff ch-height
sub ch-xoff ch-width add ch-yoff setcachedevice ch-width ch-height true[1 0 0
-1 -.1 ch-xoff sub ch-yoff .1 add]{ch-image}imagemask restore}B /D{/cc X dup
type /stringtype ne{]}if nn /base get cc ctr put nn /BitMaps get S ctr S sf 1
ne{dup dup length 1 sub dup 2 index S get sf div put}if put /ctr ctr 1 add N}
B /I{cc 1 add D}B /bop{userdict /bop-hook known{bop-hook}if /SI save N @rigin
0 0 moveto /V matrix currentmatrix dup 1 get dup mul exch 0 get dup mul add
.99 lt{/QV}{/RV}ifelse load def pop pop}N /eop{SI restore showpage userdict
/eop-hook known{eop-hook}if}N /@start{userdict /start-hook known{start-hook}
if pop /VResolution X /Resolution X 1000 div /DVImag X /IE 256 array N 0 1 255
{IE S 1 string dup 0 3 index put cvn put}for 65781.76 div /vsize X 65781.76
div /hsize X}N /p{show}N /RMat[1 0 0 -1 0 0]N /BDot 260 string N /rulex 0 N
/ruley 0 N /v{/ruley X /rulex X V}B /V{}B /RV statusdict begin /product where{
pop product dup length 7 ge{0 7 getinterval dup(Display)eq exch 0 4
getinterval(NeXT)eq or}{pop false}ifelse}{false}ifelse end{{gsave TR -.1 -.1
TR 1 1 scale rulex ruley false RMat{BDot}imagemask grestore}}{{gsave TR -.1
-.1 TR rulex ruley scale 1 1 false RMat{BDot}imagemask grestore}}ifelse B /QV{
gsave transform round exch round exch itransform moveto rulex 0 rlineto 0
ruley neg rlineto rulex neg 0 rlineto fill grestore}B /a{moveto}B /delta 0 N
/tail{dup /delta X 0 rmoveto}B /M{S p delta add tail}B /b{S p tail}B /c{-4 M}
B /d{-3 M}B /e{-2 M}B /f{-1 M}B /g{0 M}B /h{1 M}B /i{2 M}B /j{3 M}B /k{4 M}B
/w{0 rmoveto}B /l{p -4 w}B /m{p -3 w}B /n{p -2 w}B /o{p -1 w}B /q{p 1 w}B /r{
p 2 w}B /s{p 3 w}B /t{p 4 w}B /x{0 S rmoveto}B /y{3 2 roll p a}B /bos{/SS save
N}B /eos{SS restore}B end
%%EndProcSet
%%BeginProcSet: texps.pro
TeXDict begin /rf{findfont dup length 1 add dict begin{1 index /FID ne 2 index
/UniqueID ne and{def}{pop pop}ifelse}forall[1 index 0 6 -1 roll exec 0 exch 5
-1 roll VResolution Resolution div mul neg 0 0]/Metrics exch def dict begin
Encoding{exch dup type /integertype ne{pop pop 1 sub dup 0 le{pop}{[}ifelse}{
FontMatrix 0 get div Metrics 0 get div def}ifelse}forall Metrics /Metrics
currentdict end def[2 index currentdict end definefont 3 -1 roll makefont
/setfont load]cvx def}def /ObliqueSlant{dup sin S cos div neg}B /SlantFont{4
index mul add}def /ExtendFont{3 -1 roll mul exch}def /ReEncodeFont{/Encoding
exch def}def end
%%EndProcSet
%%BeginProcSet: special.pro
TeXDict begin /SDict 200 dict N SDict begin /@SpecialDefaults{/hs 612 N /vs
792 N /ho 0 N /vo 0 N /hsc 1 N /vsc 1 N /ang 0 N /CLIP 0 N /rwiSeen false N
/rhiSeen false N /letter{}N /note{}N /a4{}N /legal{}N}B /@scaleunit 100 N
/@hscale{@scaleunit div /hsc X}B /@vscale{@scaleunit div /vsc X}B /@hsize{/hs
X /CLIP 1 N}B /@vsize{/vs X /CLIP 1 N}B /@clip{/CLIP 2 N}B /@hoffset{/ho X}B
/@voffset{/vo X}B /@angle{/ang X}B /@rwi{10 div /rwi X /rwiSeen true N}B /@rhi
{10 div /rhi X /rhiSeen true N}B /@llx{/llx X}B /@lly{/lly X}B /@urx{/urx X}B
/@ury{/ury X}B /magscale true def end /@MacSetUp{userdict /md known{userdict
/md get type /dicttype eq{userdict begin md length 10 add md maxlength ge{/md
md dup length 20 add dict copy def}if end md begin /letter{}N /note{}N /legal{
}N /od{txpose 1 0 mtx defaultmatrix dtransform S atan/pa X newpath clippath
mark{transform{itransform moveto}}{transform{itransform lineto}}{6 -2 roll
transform 6 -2 roll transform 6 -2 roll transform{itransform 6 2 roll
itransform 6 2 roll itransform 6 2 roll curveto}}{{closepath}}pathforall
newpath counttomark array astore /gc xdf pop ct 39 0 put 10 fz 0 fs 2
F/|______Courier fnt invertflag{PaintBlack}if}N /txpose{pxs pys scale ppr
aload pop por{noflips{pop S neg S TR pop 1 -1 scale}if xflip yflip and{pop S
neg S TR 180 rotate 1 -1 scale ppr 3 get ppr 1 get neg sub neg ppr 2 get ppr 0
get neg sub neg TR}if xflip yflip not and{pop S neg S TR pop 180 rotate ppr 3
get ppr 1 get neg sub neg 0 TR}if yflip xflip not and{ppr 1 get neg ppr 0 get
neg TR}if}{noflips{TR pop pop 270 rotate 1 -1 scale}if xflip yflip and{TR pop
pop 90 rotate 1 -1 scale ppr 3 get ppr 1 get neg sub neg ppr 2 get ppr 0 get
neg sub neg TR}if xflip yflip not and{TR pop pop 90 rotate ppr 3 get ppr 1 get
neg sub neg 0 TR}if yflip xflip not and{TR pop pop 270 rotate ppr 2 get ppr 0
get neg sub neg 0 S TR}if}ifelse scaleby96{ppr aload pop 4 -1 roll add 2 div 3
1 roll add 2 div 2 copy TR .96 dup scale neg S neg S TR}if}N /cp{pop pop
showpage pm restore}N end}if}if}N /normalscale{Resolution 72 div VResolution
72 div neg scale magscale{DVImag dup scale}if 0 setgray}N /psfts{S 65781.76
div N}N /startTexFig{/psf$SavedState save N userdict maxlength dict begin
/magscale false def normalscale currentpoint TR /psf$ury psfts /psf$urx psfts
/psf$lly psfts /psf$llx psfts /psf$y psfts /psf$x psfts currentpoint /psf$cy X
/psf$cx X /psf$sx psf$x psf$urx psf$llx sub div N /psf$sy psf$y psf$ury
psf$lly sub div N psf$sx psf$sy scale psf$cx psf$sx div psf$llx sub psf$cy
psf$sy div psf$ury sub TR /showpage{}N /erasepage{}N /copypage{}N /p 3 def
@MacSetUp}N /doclip{psf$llx psf$lly psf$urx psf$ury currentpoint 6 2 roll
newpath 4 copy 4 2 roll moveto 6 -1 roll S lineto S lineto S lineto closepath
clip newpath moveto}N /endTexFig{end psf$SavedState restore}N /@beginspecial{
SDict begin /SpecialSave save N gsave normalscale currentpoint TR
@SpecialDefaults count /ocount X /dcount countdictstack N}N /@setspecial{CLIP
1 eq{newpath 0 0 moveto hs 0 rlineto 0 vs rlineto hs neg 0 rlineto closepath
clip}if ho vo TR hsc vsc scale ang rotate rwiSeen{rwi urx llx sub div rhiSeen{
rhi ury lly sub div}{dup}ifelse scale llx neg lly neg TR}{rhiSeen{rhi ury lly
sub div dup scale llx neg lly neg TR}if}ifelse CLIP 2 eq{newpath llx lly
moveto urx lly lineto urx ury lineto llx ury lineto closepath clip}if
/showpage{}N /erasepage{}N /copypage{}N newpath}N /@endspecial{count ocount
sub{pop}repeat countdictstack dcount sub{end}repeat grestore SpecialSave
restore end}N /@defspecial{SDict begin}N /@fedspecial{end}B /li{lineto}B /rl{
rlineto}B /rc{rcurveto}B /np{/SaveX currentpoint /SaveY X N 1 setlinecap
newpath}N /st{stroke SaveX SaveY moveto}N /fil{fill SaveX SaveY moveto}N
/ellipse{/endangle X /startangle X /yrad X /xrad X /savematrix matrix
currentmatrix N TR xrad yrad scale 0 0 1 startangle endangle arc savematrix
setmatrix}N end
%%EndProcSet
TeXDict begin 40258431 52099146 1000 300 300
(/golem/5/people/jhr/sml/CML/doc/manual/manual.dvi) @start
/Fa 15 118 df<001FC3C000FFF3C001FFFFC007FFFFC00FF87FC00FE03FC01FC01FC03F801FC0
3F000FC07E000FC07E0007C07E0007C07C0007C0FC000000FC000000F8000000F8000000F80000
00F8000000F8000000F8000000F8000000FC000000FC0000007C0000007E0007C07E0007C07F00
07C03F000FC03F800FC01FC01F800FE03F800FF87F0007FFFE0001FFFC0000FFF000001FC0001A
257EA41F>67 D<7FFFFCFFFFFEFFFFFE7FFFFC007C00007C00007C00007C00007C00007C00007C
00007C00007C00007C00007C00007C00007C00007C00007C00007C00007C00007C00007C00007C
00007C00007C00007C00007C00007C00007C00007C00007C00007C007FFFFCFFFFFEFFFFFE7FFF
FC17257CA41F>73 D<FFFC0000FFFE0000FFFE0000FFFC00000F8000000F8000000F8000000F80
00000F8000000F8000000F8000000F8000000F8000000F8000000F8000000F8000000F8000000F
8000000F8000000F8000000F8000000F8000000F8000000F8000000F8000000F8000000F800380
0F8007C00F8007C00F8007C00F8007C00F8007C00F8007C0FFFFFFC0FFFFFFC0FFFFFFC0FFFFFF
C01A257EA41F>76 D<FF801FF0FF801FF0FFC03FF0FFC03FF01FC03F801EE077801EE077801EE0
77801EE077801EF0F7801EF0F7801E70E7801E70E7801E79E7801E79E7801E79E7801E39C7801E
39C7801E39C7801E39C7801E1F87801E1F87801E1F87801E0F07801E0F07801E0007801E000780
1E0007801E0007801E0007801E0007801E0007801E000780FFC03FF0FFC03FF0FFC03FF0FFC03F
F01C257FA41F>I<03FFC01FFFF83FFFFC3FFFFC7F00FE7E007E7C003E7C003EF8001FF8001FF8
001FF8001FF8001FF8001FF8001FF8001FF8001FF8001FF8001FF8001FF8001FF8001FF8001FF8
001FF8001FF8001FF8001FF8001FFC003F7C003E7C003E7E007E7F00FE3FFFFC3FFFFC1FFFF803
FFC018257DA41F>79 D<7FFF0000FFFFE000FFFFF0007FFFF8000F81FC000F807E000F803E000F
803F000F801F000F801F000F801F000F801F000F803F000F803E000F807E000F81FC000FFFF800
0FFFF0000FFFE0000FFFF0000F83F8000F80FC000F80FC000F807C000F807C000F807C000F807C
000F807C000F807C000F807CF80F807CF80F807CF80F807EF87FF03FF8FFF83FF0FFF81FE07FF0
0FC01D257FA41F>82 D<7FFFFFF0FFFFFFF0FFFFFFF0FFFFFFF0F80F81F0F80F81F0F80F81F0F8
0F81F0F80F81F0F80F81F0000F8000000F8000000F8000000F8000000F8000000F8000000F8000
000F8000000F8000000F8000000F8000000F8000000F8000000F8000000F8000000F8000000F80
00000F8000000F8000000F8000000F8000000F8000000F800001FFFC0001FFFC0001FFFC0001FF
FC001C257FA41F>84 D<0FFE00003FFF80007FFFE0007FFFF0007E07F8007E01FC003C00FC0000
007C0000007C000003FC0000FFFC0007FFFC001FFFFC003FFF7C007FC07C00FE007C00FC007C00
F8007C00F8007C00FC00FC00FE01FC007F07FC007FFFFFE03FFFFFE01FFFBFE007FC1FE01B1A7D
991F>97 D<007FE001FFF807FFFC0FFFFC1FC0FC3F80FC7F00787E00007C0000FC0000FC0000F8
0000F80000F80000F80000FC0000FC00007E00007E007C7F007C3F80FC1FE1FC0FFFF807FFF001
FFE0007F00161A7C991F>99 D<00FF0003FFC007FFE00FFFF01FE3F83F80FC7F00FC7E007C7C00
7EFC003EF8003EFFFFFEFFFFFEFFFFFEFFFFFEFC0000FC00007C00007E003E7F003E3F807E1FE1
FE0FFFFC07FFF801FFF0007FC0171A7D991F>101 D<7FFE0000FFFE0000FFFE00007FFE000000
3E0000003E0000003E0000003E0000003E0000003E0000003E0000003E0000003E0000003E0000
003E0000003E0000003E0000003E0000003E0000003E0000003E0000003E0000003E0000003E00
00003E0000003E0000003E0000003E0000003E0000003E0000003E0000003E0000003E00007FFF
FF00FFFFFF80FFFFFF807FFFFF0019257DA41F>108 D<FE7E0FC0FFFF3FE0FFFFFFF0FFFFFFF8
1FC7F8F81F87F0F81F03E0781F03E0781F03E0781E03C0781E03C0781E03C0781E03C0781E03C0
781E03C0781E03C0781E03C0781E03C0781E03C0781E03C0781E03C0781E03C078FFC7F8FFFFCF
F9FFFFCFF9FFFFC7F8FF201A81991F>I<7FC3F800FFCFFE00FFFFFF007FFFFF0007FC3F8007F8
1F8007F00F8007E00F8007E00F8007C00F8007C00F8007C00F8007C00F8007C00F8007C00F8007
C00F8007C00F8007C00F8007C00F8007C00F8007C00F8007C00F807FFC3FF8FFFE7FFCFFFE7FFC
7FFC3FF81E1A80991F>I<7FF03F00FFF1FFC0FFF3FFE07FFFFFE001FFE7E001FF87E001FF03C0
01FE000001FC000001F8000001F8000001F8000001F0000001F0000001F0000001F0000001F000
0001F0000001F0000001F0000001F0000001F000007FFFF000FFFFF800FFFFF8007FFFF0001B1A
7F991F>114 D<7FC0FF80FFC1FF80FFC1FF807FC0FF8007C00F8007C00F8007C00F8007C00F80
07C00F8007C00F8007C00F8007C00F8007C00F8007C00F8007C00F8007C00F8007C00F8007C00F
8007C00F8007C01F8007C03F8007E07F8007FFFFF803FFFFFC01FFEFFC007F8FF81E1A80991F>
117 D E /Fb 81[19 52[17 17 25 17 19 10 15 15 1[19 19 19 27
10 1[10 10 19 19 10 17 19 17 19 19 7[21 4[21 19 4[25 31 21
1[17 1[27 2[23 3[23 1[19 15[10 9 12 9 2[12 12 6[12 33[{}42
37.500000 /Times-Italic rf /Fc 1 2 df<70F8F8F87005057D8B0B>1
D E /Fd 1 49 df<1E1E1E3E3C3C3C3878787070F0E0E0070F7F8F0A>48
D E /Fe 4 62 df<01C00380038007000E000C001C001800380038007000700070007000E000E0
00E000E000E000E000E000E000E000E000E000E000E000E0007000700070007000380038001800
1C000C000E0007000380038001C00A2A7D9E10>40 D<E0007000700038001C000C000E00060007
000700038003800380038001C001C001C001C001C001C001C001C001C001C001C001C001C001C0
03800380038003800700070006000E000C001C00380070007000E0000A2A7E9E10>I<00060000
000600000006000000060000000600000006000000060000000600000006000000060000000600
000006000000060000FFFFFFE0FFFFFFE000060000000600000006000000060000000600000006
0000000600000006000000060000000600000006000000060000000600001B1C7E9720>43
D<FFFFFFE0FFFFFFE0000000000000000000000000000000000000000000000000000000000000
0000FFFFFFE0FFFFFFE01B0C7E8F20>61 D E /Ff 136[22 15 1[9 1[13
1[17 17 17 24 3[9 3[15 1[15 1[17 51[11 45[{}13 33.333332 /Times-Italic
rf /Fg 172[18 4[24 31 22 1[17 6[24 19[9 47[{}7 33.333332 /Times-Bold
rf /Fh 86 126 df<60F0F0F0F0F0F0F0F0F0F0F0F0F0700000000060F0F0600417789614>33
D<6030F078F078F078F078F078F07870707070707070700D0B7D9714>I<380E007C0E00FE1E00
EE1E00EE3C00EE3C00EE3800FE78007C780038700000F00000F00001E00001E00001C00003C000
03C000078000078000070E000F1F000F3F800E3B801E3B801E3B803C3B803C3F80381F00380E00
111D7F9914>37 D<38787C3C1C1C1C3C78F8F0E0060C799614>39 D<01C003C007800F001E003C
003800780070007000F000E000E000E000E000E000E000E000F00070007000780038003C001E00
0F00078003C001C00A1D7A9914>I<E000F00078003C001E000F00070007800380038003C001C0
01C001C001C001C001C001C003C003800380078007000F001E003C007800F000E0000A1D7D9914
>I<038003800380638CF39E7FFC3FF80FE00FE03FF87FFCF39E638C0380038003800F107E9214>
I<01C00001C00001C00001C00001C00001C00001C000FFFF80FFFF80FFFF8001C00001C00001C0
0001C00001C00001C00001C00011117F9314>I<387C7E7E3E1E1E7CF870070A7A8414>I<FFFEFF
FEFFFE0F037E8C14>I<70F8F8F8700505798414>I<000E000E001E001E003C003C0078007800F0
00F001E001E003C003C00380078007800F000F001E001E003C003C0078007800F000F000E000E0
000F1D7E9914>I<07C00FE01FF03C783838701C701CE00EE00EE00EE00EE00EE00EE00EE00EF0
1E701C701C38383C781FF00FE007C00F177E9614>I<0300070007000F003F00FF00FF00E70007
0007000700070007000700070007000700070007000700FFF0FFF0FFF00C177C9614>I<0FC03F
F07FF8F07CF01EF01EF00E600E000E001E001C003C007800F001E003C007801F003E0E780EFFFE
FFFEFFFE0F177E9614>I<0FC03FF07FF8787C781C781C001C003C00F80FF00FE00FF8007C001C
000E000E600EF00EF01EF07C7FF83FF01FE00F177E9614>I<7FFC7FFC7FFC7000700070007000
7000700077E07FF07FF8783C701E000E000E600EF01EF01EF07C7FF83FF01FC00F177E9614>53
D<E000FFFEFFFEFFFEE03CE078007000F000E001E003C00380038007800700070007000F000E00
0E000E000E000E000E000F187E9714>55 D<0FE01FF07FFC783CF01EE00EE00EF01E783C3FF80F
E01FF0783C701CE00EE00EE00EE00EF01E783C3FF81FF007C00F177E9614>I<0FC01FF03FF87C
78F03CF01CE01EE01EE00EF01EF83E7FFE3FFE1FEE020E001E001C303C787878F87FF03FE01F80
0F177E9614>I<70F8F8F87000000000000070F8F8F8700510798F14>I<387C7C7C380000000000
00387C7C7C3C1C3C78F06006157A8F14>I<0004001E003E00FC01F803E00FC01F807E00FC00F0
00FC007E001F800FC003E001F800FC003E001E00040F157E9514>I<FFFF80FFFF80FFFF800000
00000000000000FFFF80FFFF80FFFF8011097F8F14>I<4000F000F8007E003F000F8007E003F0
00FC007E001E007E00FC03F007E00F803F007E00F800F00040000F157E9514>I<03E00FF81FF8
3E3C3DFC7BFE77FEF7BEEF1EEE0EEE0EEE0EEE0EEE0EEF1EF7BC77FC7BF83DF03E1E1FFE0FFC03
F00F177E9614>64 D<01C00003E00003E000036000036000077000077000077000077000063000
0E38000E38000E38000E38001E3C001FFC001FFC001FFC001C1C00380E00FE3F80FE3F80FE3F80
11177F9614>I<FFF0FFFCFFFE381E3807380738073807380E387E3FFC3FFC3FFE380E38073807
38073807380F381EFFFEFFFCFFF810177F9614>I<03F1800FFF801FFF803F0F803C0780780780
700380F00380F00000E00000E00000E00000E00000E00000F00000F003807003807803803C0780
3F0F001FFE000FFC0003F00011177F9614>I<FFE000FFF800FFFC00383E00381E00380F003807
00380700380380380380380380380380380380380380380380380780380700380F00381E00383E
00FFFC00FFF800FFE00011177F9614>I<FFFF80FFFF80FFFF801C03801C03801C03801C03801C
00001C1C001C1C001FFC001FFC001FFC001C1C001C1C001C00001C01C01C01C01C01C01C01C0FF
FFC0FFFFC0FFFFC01217809614>I<FFFFC0FFFFC0FFFFC01C01C01C01C01C01C01C01C01C0000
1C1C001C1C001FFC001FFC001FFC001C1C001C1C001C00001C00001C00001C00001C0000FF8000
FF8000FF80001217809614>I<07E6000FFE001FFE003E3E003C1E00780E00700E00F00E00E000
00E00000E00000E00000E07F80E07F80E07F80F00E00700E00781E003C1E003E3E001FFE000FFE
0007EE0011177F9614>I<FE3F80FE3F80FE3F80380E00380E00380E00380E00380E00380E0038
0E003FFE003FFE003FFE00380E00380E00380E00380E00380E00380E00380E00FE3F80FE3F80FE
3F8011177F9614>I<FFF8FFF8FFF8070007000700070007000700070007000700070007000700
07000700070007000700FFF8FFF8FFF80D177D9614>I<07FF07FF07FF00380038003800380038
0038003800380038003800380038003800386038F038F078FFF07FE03FC010177E9614>I<FE7F
00FE7F00FE7F00383C0038780038F00038F00039E0003BC0003BC0003FC0003FE0003EE0003EF0
003C7000387800383800383C00381C00381E00FE1F80FE1F80FE1F8011177F9614>I<FFC000FF
C000FFC0001C00001C00001C00001C00001C00001C00001C00001C00001C00001C00001C00001C
00001C00001C03801C03801C03801C0380FFFF80FFFF80FFFF8011177F9614>I<FE0FE0FE0FE0
FE0FE03B1B803B1B803B1B803B1B803BBB803BBB8039B38039B38039B38039F38038E38038E380
380380380380380380380380380380FE0FE0FE0FE0FE0FE01317809614>I<FE3F80FE3F80FE3F
803B0E003B0E003B0E003B0E003B8E00398E00398E0039CE0039CE0039CE0038CE0038CE0038EE
00386E00386E00386E00386E00FE3E00FE3E00FE3E0011177F9614>I<1FF07FFC7FFC701CF01E
E00EE00EE00EE00EE00EE00EE00EE00EE00EE00EE00EE00EE00EF01E783C7FFC7FFC1FF00F177E
9614>I<FFF800FFFE00FFFF001C0F001C07801C03801C03801C03801C03801C07801C0F001FFF
001FFE001FF8001C00001C00001C00001C00001C00001C0000FF8000FF8000FF80001117809614
>I<1FF07FFC7FFC783CF01EE00EE00EE00EE00EE00EE00EE00EE00EE00EE00EE00EE00EE3CEF3
DE79FC7FFC7FFC1FF000780038003C001C001E0F1C7E9614>I<FFE000FFF000FFF800383C0038
1E00380E00380E00380E00381E00383C003FF8003FF0003FF800387C00381C00381C00381C0038
1C00381DC0381DC0FE1FC0FE0FC0FE078012177F9614>I<0FCC3FFC7FFCF87CF03CE01CE01CF0
00F8007F003FE01FF801FC003C001E000EE00EE00EF01EF83CFFFCFFF8CFE00F177E9614>I<FF
FF80FFFF80FFFF80E1C380E1C380E1C380E1C38001C00001C00001C00001C00001C00001C00001
C00001C00001C00001C00001C00001C00001C0000FF8000FF8000FF80011177F9614>I<FF8FF8
FF8FF8FF8FF81C01C01C01C01C01C01C01C01C01C01C01C01C01C01C01C01C01C01C01C01C01C0
1C01C01C01C01C01C01E03C00E03800F8F8007FF0003FE0000F8001517819614>I<FE3F80FE3F
80FE3F80380E00380E003C1E001C1C001C1C001C1C001C1C000E38000E38000E38000E38000630
0007700007700007700003600003600003E00003E00001C00011177F9614>I<FE0FE0FE0FE0FE
0FE038038038038038038038038038038038038018E30019F3001DF7001DB7001DB7001DB7001D
B7001DB7000DB6000DB6000D16000F1E000F1E000F1E001317809614>I<FE7F00FE7F00FE7F00
1E38000E78000F700007700007E00003E00003C00001C00003C00003E00003E000077000077000
0E78000E38001C3C001C1C00FE3F80FE3F80FE3F8011177F9614>I<FE3F80FE3F80FE3F803C1E
001C1C001E3C000E38000E380007700007700003E00003E00003E00001C00001C00001C00001C0
0001C00001C00001C00007F00007F00007F00011177F9614>I<FFFEFFFEFFFEE01CE03CE078E0
7800F001E001E003C0038007800F000F001E003C0E3C0E780E700EFFFEFFFEFFFE0F177E9614>
I<FFE0FFE0FFE0E000E000E000E000E000E000E000E000E000E000E000E000E000E000E000E000
E000E000E000E000E000E000E000FFE0FFE0FFE00B1D799914>I<E000E000F000F00078007800
3C003C001E001E000F000F0007800780038003C003C001E001E000F000F000780078003C003C00
1E001E000E000E0F1D7E9914>I<FFE0FFE0FFE000E000E000E000E000E000E000E000E000E000
E000E000E000E000E000E000E000E000E000E000E000E000E000E0FFE0FFE0FFE00B1D7F9914>
I<0E003F807FC0FBE0F1E040400B067C9614>I<FFFEFFFEFFFE0F037E7E14>I<3FC0007FF0007F
F800787C00301C0000FC001FFC007FFC007F9C00F01C00E01C00E03C00F87C007FFF807FFF801F
8F8011107E8F14>97 D<FC0000FC0000FC00001C00001C00001C00001C00001CFC001FFE001FFF
001F8F801E03801C03C01C01C01C01C01C01C01C01C01E03C01E07801F8F801FFF001FFE001CFC
001217809614>I<07FC1FFE3FFE7C1E780CF000E000E000E000E000F00E780E7E1E3FFC1FF807
F00F107E8F14>I<007E00007E00007E00000E00000E00000E00000E000FCE001FFE003FFE007C
3E00781E00F00E00E00E00E00E00E00E00E00E00F01E00703E007C7E003FFFC01FFFC00FCFC012
177F9614>I<07E01FF83FFC7C3C781EF00EFFFEFFFEFFFEE000F00E780E7E1E3FFC1FF807E00F
107E8F14>I<007C01FE03FE079E070C07000700FFFEFFFEFFFE07000700070007000700070007
00070007000700FFF8FFF8FFF80F177F9614>I<07CF001FFF803FFF807C7F00783C00701C0070
1C00783C007C7C003FF8007FF00077C0007800003FF8003FFE007FFF00F00F80E00780E00380E0
0380F007807C1F007FFF001FFC0007F00011197F8F14>I<FC0000FC0000FC00001C00001C0000
1C00001C00001CFC001FFE001FFF001F0F001E07001C07001C07001C07001C07001C07001C0700
1C07001C0700FF9FE0FF9FE0FF9FE01317809614>I<03000780078003000000000000000000FF
80FF80FF800380038003800380038003800380038003800380FFFCFFFCFFFC0E187D9714>I<00
6000F000F0006000000000000000001FF01FF01FF0007000700070007000700070007000700070
007000700070007000700070007060F0F1E0FFE0FFC07F000C207E9714>I<FC0000FC0000FC00
001C00001C00001C00001C00001CFFC01CFFC01CFFC01C7C001CF8001DF0001FE0001FE0001FF0
001F70001E78001C3C001C1E00FF3FC0FF3FC0FF3FC01217809614>I<FF80FF80FF8003800380
038003800380038003800380038003800380038003800380038003800380FFFEFFFEFFFE0F177E
9614>I<FFDF00FFFF80FFFF803CF3803CF38038E38038E38038E38038E38038E38038E38038E3
8038E380FEFBE0FEFBE0FEFBE01310808F14>I<FCFC00FFFE00FFFF001F0F001E07001C07001C
07001C07001C07001C07001C07001C07001C0700FF9FE0FF9FE0FF9FE01310808F14>I<07C01F
F03FF8783C701CF01EE00EE00EE00EE00EF01E701C7C7C3FF81FF007C00F107E8F14>I<FCFC00
FFFE00FFFF001F8F801E03801C03C01C01C01C01C01C01C01C01C01E03C01E07801F8F801FFF00
1FFE001CFC001C00001C00001C00001C00001C0000FF8000FF8000FF80001218808F14>I<07E7
001FFF003FFF007C3F00780F00F00F00E00700E00700E00700E00700F00F00781F007C3F003FFF
001FF7000FC700000700000700000700000700000700003FE0003FE0003FE013187F8F14>I<FE
3F00FEFF80FFFF800FE7800F83000F00000F00000E00000E00000E00000E00000E00000E0000FF
F800FFF800FFF80011107F8F14>I<1FF87FF8FFF8F038E038F0007F803FF80FFC003EE00EE00E
F83EFFFCFFF8CFF00F107E8F14>I<0E000E000E000E000E00FFFCFFFCFFFC0E000E000E000E00
0E000E000E0E0E0E0E0E0F1E07FC07F803E00F157F9414>I<FC3F00FC3F00FC3F001C07001C07
001C07001C07001C07001C07001C07001C07001C07001C1F001FFFE00FFFE007F7E01310808F14
>I<FF7F80FF7F80FF7F801C1C001C1C001C1C000E38000E38000E380006300007700007700007
700003E00003E00003E00011107F8F14>I<FF7F80FF7F80FF7F80300600380E00380E003BEE00
3BEE003BEE003B6E003B6E001B6C001B6C001E3C001E3C001E3C0011107F8F14>I<FE7F80FE7F
80FE7F800E780007700007E00003E00001C00003C00003E0000770000E78000E3800FF7F80FF7F
80FF7F8011107F8F14>I<FF7F80FF7F80FF7F801C1C001C1C000E1C000E38000E380007380007
300007300003700003700003E00001E00001E00001C00001C00001C0007B80007F80007F00007E
00003C000011187F8F14>I<7FFF7FFF7FFF703E707C70F801F003E007C00F801F073E077C07FF
FFFFFFFFFF10107F8F14>I<007E01FE03FE03C0038003800380038003800380038003800F80FF
00FE00FF000F800380038003800380038003800380038003C003FE01FE007E0F1D7E9914>I<E0
E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0031D789914>I<FC00FF00
FF8007800380038003800380038003800380038003E001FE00FE01FE03E0038003800380038003
800380038003800780FF80FF00FC000F1D7E9914>I E /Fi 135[42 3[28
1[37 1[46 1[46 4[23 46 2[37 46 2[42 29[60 55 60 8[42 42 42
42 42 42 42 42 49[{}21 83.333336 /Times-Bold rf /Fj 29 122
df<FFF8FFF8FFF80D037E8B12>45 D<70F8F8F87005057A8412>I<03F00FF81FFC3EFC79FE7BFE
F39EF79EE70EE70EE70EE70EF79EF39C7BFC79F83EFE1FFE0FFC03F00F147F9312>64
D<07E60FFE1FFE3E3E781E700EF00EE000E000E000E000E000E000F00E700E781E3E3E1FFC0FF8
07E00F147F9312>67 D<FFFEFFFEFFFE380E380E380E387038703FF03FF03FF038703870380038
0038003800FF00FF00FF000F147F9312>70 D<FFF8FFF8FFF80700070007000700070007000700
0700070007000700070007000700FFF8FFF8FFF80D147E9312>73 D<3FE07FF07FF0F078E038E0
38E038E038E038E038E038E038E038E038E038E038F0787FF07FF03FE00D147E9312>79
D<FF80FFE0FFF0387838383838383838783FF03FE03FE038F038703870387038703877FE7FFE3F
FE1E10147F9312>82 D<3FE0007FF0007FF800783C0031FC001FFC007FFC00FE1C00E01C00E03C
00F87C007FFF807FFF801F8F80110E7F8D12>97 D<FC00FC00FC001C001C001C001DF81FFC1FFE
1F1E1E0F1C071C071C071C071E0F1F1E1FFE1FFC1DF01014809312>I<0FF01FF83FF87C78F030
E000E000E000F038F0387C783FF01FE00FC00D0E7E8D12>I<01F801F801F80038003800381FB8
3FF87FF878F8F078E038E038E038E038F07878F87FFF3FFF1FBF10147F9312>I<0FC01FE03FF0
78F8F078FFF8FFF8FFF8F038F0387C783FF01FE00FC00D0E7E8D12>I<0FBE3FFF3FFF78F67070
707078F03FE07FE07F8070007FF07FF87FFCF03EE00EE00EF01EF83E7FFC3FF80FE010167F8D12
>103 D<FC0000FC0000FC00001C00001C00001C00001DF0001FF8001FFC001F1C001E1C001C1C
001C1C001C1C001C1C001C1C001C1C00FF9F80FF9F80FF9F801114809312>I<06000F000F0006
00000000000000FF00FF00FF0007000700070007000700070007000700FFF8FFF8FFF80D157D94
12>I<FC0000FC0000FC00001C00001C00001C00001DFF001DFF001DFF001CF0001DE0001FC000
1FE0001FE0001EF0001C78001C3C00FF3F80FF3F80FF3F801114809312>107
D<FF00FF00FF0007000700070007000700070007000700070007000700070007000700FFF8FFF8
FFF80D147E9312>I<FFDF00FFFF80FFFF803CF38038E38038E38038E38038E38038E38038E380
38E380FEFBE0FEFBE0FEFBE0130E818D12>I<FDF000FFF800FFFC001F1C001E1C001C1C001C1C
001C1C001C1C001C1C001C1C00FF9F80FF9F80FF9F80110E808D12>I<0F803FE03FE078F0F078
E038E038E038E038F07878F03FE03FE00F800D0E7E8D12>I<FDF8FFFCFFFE1F1E1E0F1C071C07
1C071C071E0F1F1E1FFE1FFC1DF01C001C001C001C00FF80FF80FF801015808D12>I<0FDC003F
FC007FFC007C7C00F03C00E01C00E01C00E01C00E01C00F03C00787C007FFC003FFC000F9C0000
1C00001C00001C00001C0000FF8000FF8000FF8011157F8D12>I<FEFCFFFEFFFE0FDE0F0C0F00
0E000E000E000E000E00FFF0FFF0FFF00F0E7F8D12>I<1FF07FF0FFF0F070E070FF007FE01FF0
0078E038F078FFF8FFF0DFC00D0E7E8D12>I<0E000E000E000E00FFF8FFF8FFF80E000E000E00
0E000E1C0E1C0E1C0F3C0FF807F003E00E127F9112>I<FCFC00FCFC00FCFC001C1C001C1C001C
1C001C1C001C1C001C1C001C1C001C3C001FFF801FFF800FFF80110E808D12>I<FCFEFCFEFCFE
0EE00FC007C00380078007C00EE01EF0FEFEFEFEFEFE0F0E7F8D12>120
D<FEFEFEFEFEFE1C381C701C700E700E600EE006E006E007C003C003C00380038037807F007F00
7E0038000F157F8D12>I E /Fk 81[18 51[15 17 17 24 17 17 9 13
11 17 17 17 17 26 9 17 1[9 17 17 11 15 17 15 17 15 3[11 1[11
2[24 2[24 20 18 22 3[24 30 3[11 24 1[18 2[22 22 24 5[9 1[17
17 1[17 1[17 17 17 17 17 1[8 11 8 2[11 11 2[28 37[{}56 33.333332
/Times-Roman rf /Fl 199[12 12 12 12 12 12 12 12 49[{}8 25.000000
/Times-Roman rf /Fm 134[29 29 42 29 32 19 23 26 1[32 29 32
48 16 32 1[16 32 29 19 26 32 26 32 29 9[58 1[42 39 32 42 1[36
45 1[55 39 2[23 45 45 36 1[42 42 39 42 8[29 29 29 29 29 29
29 29 1[16 15 19 45[{}51 58.333336 /Times-Bold rf /Fn 62[14
15[21 2[21 51[16 18 18 28 18 21 12 16 16 1[21 21 21 30 12 18
12 12 21 21 12 18 21 18 21 21 9[35 2[23 21 25 1[25 1[28 35
23 1[18 14 30 30 25 25 30 28 1[25 6[14 21 21 1[21 1[21 21 21
21 21 2[14 5[14 39[{}56 41.666668 /Times-Italic rf /Fo 143[15
15 2[8 3[15 15 1[13 1[13 1[13 3[10 1[10 4[21 1[18 16 19 3[21
26 3[10 21 21 2[21 2[21 7[15 15 15 15 15 15 15 15 15 15 48[{}31
29.166668 /Times-Roman rf /Fp 65 123 df<6030F078F078F078F078F078F078F078F078F0
78E038E0380D0C7C9916>34 D<387C7E7E3E0E0E0E1E3C3CF8F060070E799816>39
D<00E001E007C007800F001E003C0038007800700070007000F000E000E000E000E000E000E000
E000F000700070007000780038003C001E000F00078007C001E000E00B217A9C16>I<E000F000
7C003C001E000F000780038003C001C001C001C001E000E000E000E000E000E000E000E001E001
C001C001C003C0038007800F001E003C007C00F000E0000B217C9C16>I<0380038003800380E3
8EFBBEFFFE3FF80FE00FE03FF8FFFEFBBEE38E03800380038003800F127D9516>I<FFFF80FFFF
80FFFF8011037E8D16>45 D<78FCFCFCFC780606788516>I<000380000380000780000780000F
00000F00001E00001E00003C00003C0000780000780000F00000F00001E00001E00003C00003C0
000780000780000F00000F00001E00001E00003C00003C0000780000780000F00000F00000E000
00E0000011207E9C16>I<03E0000FF8001FFC001E3C00380E00780F00700700700700E00380E0
0380E00380E00380E00380E00380E00380E00380F00780700700700700780F003C1E001E3C001F
FC000FF80003E00011197E9816>I<070007000F001F003F00FF00FF00F7000700070007000700
0700070007000700070007000700070007000700FFF8FFF8FFF80D197B9816>I<0FF0001FFC00
7FFE00783F00F00F00F00780F00380F00380000380000380000780000700000F00001E00003C00
00780000F00003E00007C0000F00001E03803C0380FFFF80FFFF80FFFF8011197E9816>I<0FF0
003FFC007FFE00781F00780F00780700300700000F00000F00003E0007FC0007F80007FC00001E
00000F00000780000380600380F00380F00780F00F00F81F007FFE003FFC000FF00011197E9816
>I<007C0000FC0000FC0001DC00039C00039C00071C000F1C000E1C001E1C003C1C00381C0078
1C00F01C00FFFFE0FFFFE0FFFFE0001C00001C00001C00001C00001C0001FFC001FFC001FFC013
197F9816>I<07F0001FFC003FFE007C1F00F00780E00380E00380E003807007007C1F001FFC00
07F0001FFC003C1E00700700F00780E00380E00380E00380F007807007007C1F003FFE001FFC00
07F00011197E9816>56 D<07F0001FF8003FFC007C3E00780F00F00F00E00700E00780E00780E0
0380F00780F00780780F803FFF803FFF800FF380010780000700300F00780E00783E00787C007F
F8003FF0000FC00011197E9816>I<E00000F80000FC00003F00001F800007E00003F00000FC00
007E00001F80000F80001F80007E0000FC0003F00007E0001F80003F0000FC0000F80000E00000
11157E9616>62 D<01F80007FE000FFF001F0F803E7F803CFF8079FFC073C7C0F383C0E783C0E7
01C0E701C0E701C0E701C0E701C0E783C0F3838073C78079FF003CFE003E7C001F03C00FFFC007
FF8001FC0012197E9816>64 D<00E00001F00001F00001B00001B00003B80003B80003B8000318
00071C00071C00071C00071C00071C000E0E000E0E000FFE000FFE001FFF001C07001C07001C07
00FF1FE0FF1FE0FF1FE013197F9816>I<FFF800FFFE00FFFF001C07001C07801C03801C03801C
03801C03801C07001FFF001FFE001FFE001C1F001C03801C03C01C01C01C01C01C01C01C01C01C
03C01C0780FFFF80FFFF00FFFC0012197F9816>I<03F18007FF800FFF801F0F803C0780780780
780380700380F00000E00000E00000E00000E00000E00000E00000E00000F00000700380780380
7803803C07801F0F000FFE0007FC0003F00011197E9816>I<FFF800FFFE00FFFF001C0F001C07
801C03C01C01C01C01C01C01E01C00E01C00E01C00E01C00E01C00E01C00E01C00E01C00E01C01
C01C01C01C03C01C07801C0F80FFFF00FFFE00FFF8001319809816>I<FFFFC0FFFFC0FFFFC01C
01C01C01C01C01C01C01C01C00001C00001C1C001C1C001FFC001FFC001FFC001C1C001C1C001C
00001C00E01C00E01C00E01C00E01C00E0FFFFE0FFFFE0FFFFE013197F9816>I<FFFFE0FFFFE0
FFFFE01C00E01C00E01C00E01C00E01C00001C00001C1C001C1C001FFC001FFC001FFC001C1C00
1C1C001C00001C00001C00001C00001C00001C0000FFC000FFC000FFC00013197F9816>I<03F1
8007FF800FFF801F0F803C0780780780780380700380F00000E00000E00000E00000E00000E01F
E0E01FE0E01FE0F003807003807807807807803C0F801F1F800FFF8007FB8003F38013197F9816
>I<FF8FF8FF8FF8FF8FF81C01C01C01C01C01C01C01C01C01C01C01C01C01C01FFFC01FFFC01F
FFC01C01C01C01C01C01C01C01C01C01C01C01C01C01C01C01C01C01C0FF8FF8FF8FF8FF8FF815
19809816>I<FFFEFFFEFFFE038003800380038003800380038003800380038003800380038003
8003800380038003800380FFFEFFFEFFFE0F197D9816>I<FFC000FFC000FFC0001C00001C0000
1C00001C00001C00001C00001C00001C00001C00001C00001C00001C00001C00001C00001C0040
1C00E01C00E01C00E01C00E0FFFFE0FFFFE0FFFFE013197F9816>76 D<FC07E0FE0FE0FE0FE03A
0B803B1B803B1B803B1B803B1B803BBB803BBB8039B38039B38039B38039B38039F38038E38038
E380380380380380380380380380380380FE0FE0FE0FE0FE0FE013197F9816>I<FE0FF8FF0FF8
FF0FF81D81C01D81C01D81C01DC1C01CC1C01CE1C01CE1C01C61C01C71C01C71C01C71C01C31C0
1C39C01C39C01C19C01C1DC01C0DC01C0DC01C0DC0FF87C0FF87C0FF83C01519809816>I<1FFC
003FFE007FFF00780F00F00780E00380E00380E00380E00380E00380E00380E00380E00380E003
80E00380E00380E00380E00380E00380F00780F00780780F007FFF003FFE001FFC0011197E9816
>I<FFF800FFFE00FFFF001C0F801C03801C03C01C01C01C01C01C01C01C03C01C03801C0F801F
FF001FFE001FF8001C00001C00001C00001C00001C00001C00001C0000FF8000FF8000FF800012
197F9816>I<FFF000FFFC00FFFE001C0F001C07801C03801C03801C03801C03801C07801C0F00
1FFE001FFC001FFE001C1F001C0F001C07001C07001C07001C07381C07381C07F8FF87F8FF83F0
FF81E01519809816>82 D<0FF3001FFF007FFF00781F00F00F00E00700E00700E00000F0000078
00007F80003FF8000FFC0000FE00000F00000780000380000380E00380E00380F00780F81F00FF
FE00FFFC00CFF80011197E9816>I<FFFFE0FFFFE0FFFFE0E0E0E0E0E0E0E0E0E0E0E0E000E000
00E00000E00000E00000E00000E00000E00000E00000E00000E00000E00000E00000E00000E000
00E0000FFE000FFE000FFE0013197F9816>I<FF8FF8FF8FF8FF8FF81C01C01C01C01C01C01C01
C01C01C01C01C01C01C01C01C01C01C01C01C01C01C01C01C01C01C01C01C01C01C01E03C01E03
C00F07800F8F8007FF0003FE0000F8001519809816>I<FF07F8FF07F8FF07F83800E03800E038
00E03800E01C01C01C01C01C01C01C71C01CF9C01CF9C01CD9C01CD9C00CD9800CD9800CD9800D
DD800D8D800D8D800D8D80078F00078F000707001519809816>87 D<FFFF80FFFF80FFFF80E00F
80E00F00E01E00E03E00003C0000780000F80000F00001E00003E00003C0000780000F80000F00
001E03803E03803C0380780380F80380FFFF80FFFF80FFFF8011197E9816>90
D<FFF0FFF0FFF0E000E000E000E000E000E000E000E000E000E000E000E000E000E000E000E000
E000E000E000E000E000E000E000E000E000E000FFF0FFF0FFF00C20789C16>I<FFF0FFF0FFF0
007000700070007000700070007000700070007000700070007000700070007000700070007000
70007000700070007000700070FFF0FFF0FFF00C207F9C16>93 D<FFFF80FFFF80FFFF8011037E
7E16>95 D<1FE0007FF8007FFC00783E00301E00000E00007E000FFE003FFE007FCE00F80E00E0
0E00E00E00F01E00F83E007FFFE03FFFE01FC3E013127E9116>97 D<FC0000FC0000FC00001C00
001C00001C00001C00001CFC001FFF001FFF801F8FC01E03C01E01E01C01E01C00E01C00E01C00
E01C00E01E01E01E01C01F03C01F8F801FFF801FFE001CFC0013197F9816>I<03FC0FFE1FFE3E
1E780C7000F000E000E000E000E000F00070077C073E1F1FFE0FFC03F010127D9116>I<003F00
003F00003F0000070000070000070000070007E7001FFF003FFF003E3F00780F00700F00F00700
E00700E00700E00700E00700F00F00F00F00781F007E3F003FFFE01FF7E007E7E013197F9816>
I<03F0000FFC003FFE003E1F00780F80F80780F00380FFFF80FFFF80FFFF80E00000F00000F803
807C07803E0F801FFF000FFE0003F80011127E9116>I<003F0000FF8001FF8003E78003830003
8000038000FFFF00FFFF00FFFF0003800003800003800003800003800003800003800003800003
8000038000038000038000FFFE00FFFE00FFFE0011197F9816>I<03E7C00FFFE01FFFE01E3CE0
3C1E00380E00380E00380E003C1E001E3C001FFC003FF8003BE0003800003C00003FFE003FFF80
7FFFC07807C0F001E0E000E0E000E0E000E0F001E07E0FC03FFF801FFF0007FC00131C7F9116>
I<FC0000FC0000FC00001C00001C00001C00001C00001CFC001FFE001FFF001F8F001E07001E07
001C07001C07001C07001C07001C07001C07001C07001C07001C0700FF9FE0FF9FE0FF9FE01319
7F9816>I<07000F800F800F800700000000000000FF80FF80FF80038003800380038003800380
038003800380038003800380FFFEFFFEFFFE0F1A7C9916>I<FE0000FE0000FE00000E00000E00
000E00000E00000E7FE00E7FE00E7FE00E1F000E3E000E7C000EF8000FF0000FF8000FFC000FBC
000F1E000E1F000E0F800E0780FFCFF0FFCFF0FFCFF01419809816>107
D<FFC000FFC000FFC00001C00001C00001C00001C00001C00001C00001C00001C00001C00001C0
0001C00001C00001C00001C00001C00001C00001C00001C00001C000FFFF80FFFF80FFFF801119
7E9816>I<FBC780FFEFC0FFFFE03E7CE03C78E03870E03870E03870E03870E03870E03870E038
70E03870E03870E03870E0FE7CF8FE7CF8FE7CF81512809116>I<FCFC00FFFE00FFFF001F8F00
1E07001E07001C07001C07001C07001C07001C07001C07001C07001C07001C0700FF9FE0FF9FE0
FF9FE013127F9116>I<03E0000FF8001FFC003C1E00780F00700700E00380E00380E00380E003
80E00380F00780700700780F003C1E001FFC000FF80003E00011127E9116>I<FCFC00FFFF00FF
FF801F8FC01E03C01E01E01C01E01C00E01C00E01C00E01C00E01E01E01E01C01F03C01F8F801F
FF801FFE001CFC001C00001C00001C00001C00001C00001C0000FF8000FF8000FF8000131B7F91
16>I<07F3800FFB801FFF803E1F80780F80700780F00780E00380E00380E00380E00380F00780
700780780F803E1F803FFF801FFB8007E380000380000380000380000380000380000380003FF8
003FF8003FF8151B7F9116>I<FF1FC0FF7FE0FFFFE007F9E007E0C007C0000780000780000700
00070000070000070000070000070000070000FFFC00FFFC00FFFC0013127F9116>I<1FEC3FFC
7FFCF03CE01CE01CF8007FC03FF007FC003EE00EE00EF00EF83EFFFCFFF8CFF00F127D9116>I<
070000070000070000070000070000FFFF00FFFF00FFFF00070000070000070000070000070000
070000070000070100070380070380070780078F8003FF0003FE0000F80011177F9616>I<FC3F
00FC3F00FC3F001C07001C07001C07001C07001C07001C07001C07001C07001C07001C07001C0F
001E1F001FFFE00FFFE007F7E013127F9116>I<FF9FE0FF9FE0FF9FE01C07001C07000E0E000E
0E000E0E00071C00071C00071C00071C0003B80003B80003B80001F00001F00000E00013127F91
16>I<FF1FE0FF1FE0FF1FE038038038038038038038038039F38039F38019F30019B30019B300
19B3001DB7001D17001F1F000F1E000E0E0013127F9116>I<7F3FC07F3FC07F3FC00F1E00073C
0003B80003F00001F00000E00001E00001F00003B800073C00071C000E0E00FF3FE0FF3FE0FF3F
E013127F9116>I<FF9FE0FF9FE0FF9FE01C07000E07000E0E000E0E00070E00071C00071C0003
9C00039C0003980001B80001B80000F00000F00000F00000E00000E00000E00001C00079C0007B
C0007F80007F00003C0000131B7F9116>I<7FFFC07FFFC07FFFC0700F80701F00703E00007C00
00F80001F00003E00007C0000F80001F01C03E01C07C01C0FFFFC0FFFFC0FFFFC012127F9116>
I E /Fq 9 119 df<0FFFF01FFFF03FFFF0786000606000E0E00000E00000C00001C00001C000
01C00001C00003800003800003800003800007000007000014127F9112>28
D<70F8F8F87005057D840C>58 D<0003F00007F0000EF8000EF8001C70001C00001C00001C0000
3C0000380000380003FFC003FF8000780000700000700000700000700000700000F00000E00000
E00000E00000E00001E00001C00001C00001C00001C000038000038000038000F38000F70000FF
0000FE00007C000015257E9C14>102 D<007DC001FFC003CFC00787C00F03C01F03801E03801E
07803E07803C07003C07003C0F003C0F003C1E003C3E001E7E001FFE0007DC00001C00003C0000
3C00F03800F07800F1F000FFE0007F8000121A809114>I<3E0FC1F8003F3FE3FE007778F71E00
67E07E0E00E7C07C0E00C780780E000780700E000F00F01E000F00F01C000E00E01C000E00E03C
001E01E038E01E01E038E01C01C078C01C01C071C03C03C07B803C03C03F003803801E0023127F
9124>109 D<1E1F803F3FE07771E067E0E0E7C0E0C780E00700E00F01E00F01C00E01C00E03C0
1E038E1E038E1C078C1C071C3C07B83C03F03801E017127F9119>I<01F807FC0F1E0E1E1E3E1E
1C1F001FE00FF807F8007C203CF038F038F078F0F07FE03F800F127E9113>115
D<01C001C001C003C003C0038003800780FFF0FFF007000F000F000E000E001E001E001C001C00
3C383C383870387039E03FC01F000D1A80990F>I<1F03803F8780738780638780E38380C78380
0701800703800F03000E03000E03000E07000E06000E0E000E1C000F38000FF80003E00011127F
9114>118 D E /Fr 81[23 51[18 21 21 30 21 23 14 16 18 23 23
21 23 35 12 23 1[12 23 21 14 18 23 18 23 21 8[30 1[30 30 28
23 30 1[25 32 30 39 28 1[21 16 32 1[25 28 30 30 28 30 7[21
21 21 21 21 21 21 21 21 21 12 10 14 10 2[14 14 40[{}62 41.666668
/Times-Bold rf /Fs 81[58 51[46 52 52 1[52 58 35 40 46 1[58
52 58 86 29 2[29 58 52 35 46 58 46 58 52 12[69 58 2[63 81 1[98
69 2[40 3[69 75 75 69 75 17[29 1[35 45[{}37 104.166664 /Times-Bold
rf /Ft 3 34 df<70F8F8F87005057D8C0C>1 D<0003FE0000000FFF8000003E03E00000F800F8
0001E0003C000380000E0007000007000E000003801C000001C018000000C038000000E0300000
0060700000007060000000306000000030E000000038C000000018C000000018C000000018C000
000018C000000018C000000018C000000018E00000003860000000306000000030700000007030
0000006038000000E018000000C01C000001C00E0000038007000007000380000E0001E0003C00
00F800F800003E03E000000FFF80000003FE000025277E9D2A>13 D<0000003000000000380000
0000180000000018000000001C000000000E000000000E000000000700000000038000000001E0
FFFFFFFFF8FFFFFFFFF800000001E0000000038000000007000000000E000000000E000000001C
00000000180000000018000000003800000000300025167E942A>33 D E
/Fu 61[14 7[18 8[21 1[23 23 3[18 47[18 21 21 30 21 21 12 16
14 21 21 21 21 32 12 21 12 12 21 21 14 18 21 18 21 18 3[14
1[14 1[30 30 39 30 30 25 23 28 30 23 30 30 37 25 30 16 14 30
30 23 25 30 28 28 30 1[18 3[12 12 21 21 21 21 21 21 21 21 21
21 12 10 14 10 2[14 14 14 32 3[17 34[{}81 41.666668 /Times-Roman
rf /Fv 140[19 17 2[25 25 4[14 3[22 14[36 28[25 25 7[25 1[12
4[17 17 40[{}13 50.000000 /Times-Roman rf /Fw 134[29 2[29 29
16 23 19 1[29 29 29 1[16 2[16 29 2[26 1[26 29 26 12[36 1[39
3[42 52 36 1[23 1[42 1[32 2[39 39 42 7[29 1[29 29 1[29 29 1[29
29 1[15 1[15 5[45 38[{}37 58.333336 /Times-Roman rf /Fx 47[71
88[51 35 35 20 27 23 2[35 35 55 3[20 35 35 1[31 1[31 1[31 16[39
10[43 1[47 67[{}19 70.833336 /Times-Roman rf end
%%EndProlog
%%BeginSetup
%%Feature: *Resolution 300dpi
TeXDict begin

%%EndSetup
%%Page: 0 1
0 0 bop 553 624 a Fx(Concurrent)20 b(Programming)g(with)d(Ev)o(ents)1055
715 y(\320)760 806 y Fw(The)d(Concurrent)h(ML)f(Manual)942
856 y Fv(\(V)-6 b(ersion)12 b(0.9.8\))891 1005 y Fw(February)j(1,)f(1993)917
1455 y(John)g(H.)g(Repp)o(y)805 1604 y(A)-6 b(T&T)13 b(Bell)h(Laboratories)
866 1679 y(600)h(Mountain)f(A)l(v)o(e.)824 1754 y(Murray)h(Hill,)f(NJ)g
(07974)p eop
%%Page: 1 2
1 1 bop 493 928 a Fu(COPYRIGHT)752 927 y(c)741 928 y Ft(\015)10
b Fu(1990,1991,1992)e(by)i(John)g(H.)g(Reppy)506 978 y(COPYRIGHT)765
977 y(c)754 978 y Ft(\015)g Fu(1993)f(by)h(A)-5 b(T&T)12 b(Bell)d
(Laboratories)701 1028 y(ALL)i(RIGHTS)g(RESER)m(VED)p eop
%%Page: 1 3
1 2 bop 33 435 a Fs(Contents)33 713 y Fr(License)11 b(and)f(disclaimer)1359
b(iii)33 825 y(Pr)o(eface)1648 b(1)33 937 y(1)41 b(A)10 b(CML)g(tutorial)1435
b(3)95 1008 y Fu(1.1)43 b(Getting)9 b(started)27 b Fq(:)20
b(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g
(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f
(:)78 b Fu(3)95 1078 y(1.2)43 b(Basic)11 b(concurrenc)o(y)g(primiti)o(v)o(es)
i Fq(:)20 b(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h
(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)78
b Fu(4)95 1149 y(1.3)43 b(Running)9 b(a)i Fr(CML)f Fu(program)35
b Fq(:)21 b(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g
(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)78
b Fu(5)95 1220 y(1.4)43 b(Streams)g Fq(:)20 b(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g
(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f
(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)78
b Fu(6)95 1290 y(1.5)43 b(First-class)10 b(synchronous)g(operations)20
b Fq(:)g(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h
(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)78 b Fu(8)95
1361 y(1.6)43 b(More)11 b(synchronous)e(operations)36 b Fq(:)20
b(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h
(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)57 b Fu(11)95
1431 y(1.7)43 b(Building)8 b(ne)o(w)j(synchronous)e(abstractions)38
b Fq(:)21 b(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g
(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)57 b Fu(12)95 1502 y(1.8)43
b(Client-serv)o(er)10 b(protocols)19 b Fq(:)h(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g
(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f
(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)57 b Fu(16)33 1614 y Fr(2)41
b(Basic)10 b(concurr)o(ency)j(primitives)1179 b(20)95 1685
y Fu(2.1)43 b(Threads)g Fq(:)20 b(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g
(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h
(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)57 b Fu(20)95
1755 y(2.2)43 b(Channels)21 b Fq(:)f(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f
(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g
(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)57 b Fu(21)33
1867 y Fr(3)41 b(Events)1576 b(22)95 1938 y Fu(3.1)43 b(Simple)10
b(e)o(v)o(ents)41 b Fq(:)20 b(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g
(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f
(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)57 b Fu(22)95 2008 y(3.2)43
b(Wrappers)15 b Fq(:)20 b(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f
(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g
(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)57 b Fu(23)95 2079 y(3.3)43
b(Selecti)o(v)o(e)11 b(communication)j Fq(:)20 b(:)h(:)f(:)g(:)h(:)f(:)g(:)g
(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f
(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)57 b Fu(23)95 2149 y(3.4)43
b(Adv)o(anced)11 b(e)o(v)o(ent)g(programming)27 b Fq(:)20 b(:)h(:)f(:)g(:)g
(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f
(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)57 b Fu(24)95 2220 y(3.5)43
b(Polling)9 b(and)h(timeouts)25 b Fq(:)20 b(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g
(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h
(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)57 b Fu(25)33 2332 y Fr(4)41
b(Condition)9 b(variables)1346 b(27)33 2444 y(5)41 b(Multi-thr)o(eaded)11
b(I/O)1354 b(29)95 2515 y Fu(5.1)43 b(Stream)11 b(I/O)24 b
Fq(:)c(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)
h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f
(:)g(:)h(:)f(:)57 b Fu(29)95 2585 y(5.2)43 b(Lo)o(w-le)o(v)o(el)11
b(I/O)38 b Fq(:)20 b(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f
(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g
(:)h(:)f(:)g(:)h(:)f(:)57 b Fu(30)927 2799 y(i)p eop
%%Page: 2 4
2 3 bop 190 82 a Fr(6)42 b(Initialization)7 b(and)k(termination)1169
b(31)253 153 y Fu(6.1)43 b(Serv)o(ers)11 b(and)g(top-le)o(v)o(el)e(channels)
25 b Fq(:)20 b(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)
h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)57
b Fu(31)253 223 y(6.2)43 b(Starting)9 b(and)h(stopping)f(a)h
Fr(CML)h Fu(program)17 b Fq(:)j(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g
(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)57
b Fu(32)190 335 y Fr(7)42 b(Deb)o(ugging)10 b(CML)g(pr)o(ograms)1216
b(34)253 406 y Fu(7.1)43 b(Deb)o(ugging)9 b(hints)29 b Fq(:)20
b(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g
(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)57
b Fu(34)253 477 y(7.2)43 b(T)o(race)12 b(modules)27 b Fq(:)21
b(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g
(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h
(:)57 b Fu(34)253 547 y(7.3)43 b(Thread)11 b(watching)24 b
Fq(:)c(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)
g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h
(:)57 b Fu(36)253 618 y(7.4)43 b(Uncaught)10 b(e)o(xceptions)20
b Fq(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g
(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)57
b Fu(36)190 730 y Fr(8)42 b(Administrative)8 b(details)1303
b(38)253 800 y Fu(8.1)43 b(Ho)o(w)10 b(to)g(get)g(the)g(release)33
b Fq(:)20 b(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g
(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)57
b Fu(38)253 871 y(8.2)43 b(Installing)8 b(CML)15 b Fq(:)21
b(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g
(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h
(:)57 b Fu(39)253 941 y(8.3)43 b(Release)12 b(history)j Fq(:)21
b(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g
(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h
(:)57 b Fu(39)253 1012 y(8.4)43 b(Bug)10 b(reports)i Fq(:)20
b(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h
(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f
(:)g(:)h(:)57 b Fu(40)190 1124 y Fr(A)33 b(The)10 b(top-le)o(vel)g(en)n(vir)o
(onment)1232 b(43)253 1195 y Fu(A.1)34 b Fp(CML)13 b Fq(:)20
b(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g
(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f
(:)g(:)g(:)h(:)f(:)g(:)h(:)57 b Fu(43)253 1265 y(A.2)34 b Fp(RunCml)11
b Fq(:)21 b(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g
(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h
(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)57 b Fu(45)253 1336 y(A.3)34
b Fp(CIO)13 b Fq(:)20 b(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h
(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g
(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)57 b Fu(45)253
1406 y(A.4)34 b Fp(TraceCML)e Fq(:)20 b(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h
(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g
(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)57 b Fu(46)190
1518 y Fr(B)35 b(The)10 b(CML)g(Library)1369 b(48)253 1589
y Fu(B.1)36 b(Plumbing)13 b Fq(:)20 b(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h
(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g
(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)57 b Fu(48)253
1660 y(B.2)36 b(Buf)o(fered)10 b(channels)35 b Fq(:)20 b(:)h(:)f(:)g(:)g(:)h
(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g
(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)57 b Fu(49)253
1730 y(B.3)36 b(Futures)18 b Fq(:)j(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g
(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f
(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)57 b
Fu(50)253 1801 y(B.4)36 b(Cobe)o(gin)f Fq(:)20 b(:)g(:)g(:)h(:)f(:)g(:)h(:)f
(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g
(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)57
b Fu(50)253 1871 y(B.5)36 b(Safe)11 b(callcc)28 b Fq(:)20 b(:)g(:)h(:)f(:)g
(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h
(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)f(:)g(:)g(:)h(:)f(:)g(:)h(:)57
b Fu(51)190 1983 y Fr(C)33 b(Sour)o(ce)11 b(\256les)g(f)o(or)f(examples)1259
b(52)1079 2799 y Fu(ii)p eop
%%Page: 3 5
3 4 bop 33 435 a Fs(License)26 b(and)f(disclaimer)33 672 y
Fu(This)10 b(distrib)o(ution)d(is)j(pro)o(vided)f(free)i(of)f(char)o(ge,)i
(under)e(the)g(follo)o(wing)d(\252X-windo)o(ws)j(style\272)g(copyright:)528
775 y(Copyright)718 774 y(c)706 775 y Ft(\015)g Fu(1990,1991,1992)e(by)i
(John)g(H.)h(Reppy)773 825 y(All)f(rights)f(reserv)o(ed.)136
892 y(Permission)17 b(to)f(use,)j(copy)m(,)f(modify)m(,)g(and)f(distrib)o
(ute)d(this)i(software)g(and)h(its)f(documentation)f(for)i(an)o(y)136
941 y(purpose)c(and)g(without)f(fee)i(is)f(hereby)g(granted,)h(pro)o(vided)e
(that)h(the)g(abo)o(v)o(e)h(copyright)d(notice)i(appear)h(in)136
991 y(all)d(copies)g(and)g(that)f(both)g(the)h(copyright)e(notice)h(and)h
(this)f(permission)g(notice)h(and)g(warranty)f(disclaimer)136
1041 y(appear)d(in)g(supporting)g(d)o(ocumentation)o(,)e(and)i(that)g(the)g
(name)g(of)g(John)g(H.)f(Reppy)g(not)g(b)o(e)h(used)g(in)f(adv)o(ertisi)o(ng)
136 1091 y(or)11 b(publicity)e(pertaining)h(to)h(distrib)o(utio)o(n)e(of)h
(the)i(software)e(without)g(speci\256c,)i(written)e(prior)g(permission.)136
1141 y(John)f(H.)h(Reppy)e(makes)i(no)f(representations)g(about)g(the)g
(suitability)d(of)j(this)g(software)g(for)f(an)o(y)i(purpose.)15
b(It)136 1191 y(is)10 b(pro)o(vided)g("as)h(is")f(without)e(e)o(xpress)j(or)f
(implied)f(warranty)m(.)136 1257 y Fr(J)o(ohn)j(H.)g(Reppy)f(disclaims)f(all)
g(warranties)i(with)e(r)o(egard)j(to)e(this)f(softwar)o(e,)j(including)d(all)
g(implied)136 1307 y(warranties)h(of)e(mer)o(chantability)g(and)g(\256tness)i
(In)f(no)f(e)o(vent)i(shall)d(J)o(ohn)i(H.)h(Reppy)f(be)g(liable)f(f)o(or)g
(any)136 1357 y(special,)j(indir)o(ect)g(or)f(consequential)h(damages)e(or)i
(any)f(damages)f(whatsoe)o(ver)i(r)o(esulting)f(fr)o(om)g(loss)136
1406 y(of)f(use,)h(data)e(or)h(pr)o(o\256ts,)h(whether)g(in)e(an)h(action)f
(of)h(contract,)g(negligence)h(or)f(other)g(tortious)f(action,)136
1456 y(arising)h(out)g(of)g(or)h(in)f(connection)g(with)g(the)h(use)g(or)f
(perf)o(ormance)i(of)e(this)g(softwar)o(e.)95 1560 y Fu(Portions)f(of)h(this)
f(software)h(may)h(also)f(be)h(under)e(the)i Fr(SML/NJ)e Fu(copyright:)541
1664 y(Copyright)731 1663 y(c)719 1664 y Ft(\015)h Fu(1993)f(by)h(A)-5
b(T&T)12 b(Bell)e(Laboratories)136 1730 y(Permission)17 b(to)f(use,)j(copy)m
(,)f(modify)m(,)g(and)f(distrib)o(ute)d(this)i(software)g(and)h(its)f
(documentation)f(for)i(an)o(y)136 1780 y(purpose)c(and)g(without)f(fee)i(is)f
(hereby)g(granted,)h(pro)o(vided)e(that)h(the)g(abo)o(v)o(e)h(copyright)d
(notice)i(appear)h(in)136 1830 y(all)d(copies)g(and)g(that)f(both)g(the)h
(copyright)e(notice)h(and)h(this)f(permission)g(notice)h(and)g(warranty)f
(disclaimer)136 1880 y(appear)g(in)f(supporting)d(documentation,)j(and)g
(that)f(the)h(name)h(of)f(A)-5 b(T&T)10 b(Bell)e(Laboratories)h(or)g(an)o(y)g
(A)-5 b(T&T)136 1929 y(entity)12 b(not)h(be)g(used)g(in)g(adv)o(ertising)f
(or)h(publicity)e(pertaining)g(to)i(distrib)o(ution)c(of)k(the)g(software)g
(without)136 1979 y(speci\256c,)f(written)d(prior)g(permission.)136
2046 y(A)-5 b(T&T)18 b(disclaims)d(all)h(warranties)f(with)g(re)o(gard)h(to)f
(this)g(software,)i(including)c(all)j(implied)e(warranties)136
2095 y(of)h(merchantability)f(and)h(\256tness.)30 b(In)15 b(no)g(e)o(v)o(ent)
g(shall)g(A)-5 b(T&T)16 b(be)g(liable)e(for)h(an)o(y)g(special,)i(indirect)d
(or)136 2145 y(consequential)g(damages)h(or)e(an)o(y)h(damages)h(whatsoe)o(v)
o(er)g(resulting)d(from)h(loss)h(of)f(use,)j(data)e(or)f(pro\256ts,)136
2195 y(whether)8 b(in)e(an)i(action)f(of)g(contract,)h(ne)o(gligence)f(or)g
(other)g(tortious)e(action,)j(arising)f(out)f(of)h(or)g(in)g(connection)136
2245 y(with)j(the)g(use)g(or)g(performance)i(of)d(this)h(software.)915
2799 y(iii)p eop
%%Page: 4 6
4 5 bop 1075 2799 a Fu(i)o(v)p eop
%%Page: 1 7
1 6 bop 33 435 a Fs(Pr)n(eface)33 682 y Fu(Concurrent)12 b(ML)i(\()p
Fr(CML)p Fu(\))f(is)h(a)g(system)g(for)f(concurrent)g(programming)g(in)g
(Standard)g(ML)h(\()p Fr(SML)p Fu(\))1544 669 y Fo([MTH90)n(])1657
682 y Fu(.)25 b(A)14 b Fr(CML)33 741 y Fu(program)g(consists)g(of)h(a)g(set)g
(of)f Fn(thr)n(eads)h Fu(\(or)f(light-weight)e(processes\).)30
b(A)15 b(thread)f(is)h(the)f(sequential)g(e)o(v)o(aluation)g(of)33
801 y(a)g Fr(ML)f Fu(e)o(xpression.)25 b(It)13 b(does)g(not)g(ha)o(v)o(e)h
(to)f(be)h(a)g(terminating)e(computation;)h(in)g(fact,)i(in\256nitely)c
(looping)h(threads)h(are)33 861 y(often)f(useful.)23 b(The)13
b(e)o(v)o(aluation)f(of)h(a)g(thread)g(may)g(in)n(v)o(olv)o(e)g
(communication)f(with)g(other)g(threads,)i(which)f(is)f(done)h(by)33
921 y(sending)c(a)h(message)h(on)f(a)g(channel.)15 b(Message)c(passing)e(is)h
(synchronous)f(and)g(forms)h(the)f(basis)h(of)g(communication)f(and)33
980 y(synchronization)f(in)h Fr(CML)p Fu(.)i(This)e(model)h(is)g(e)o(xtended)
g(by)g Fn(\256rst-class)f(sync)o(hr)n(onous)h(oper)o(ations)1480
967 y Fo([Rep88)n(])1574 980 y Fu(,)h(which)e(pro)o(vide)33
1040 y(a)h(mechanism)i(for)e(b)o(uilding)e(ne)o(w)i(synchronization)f(and)h
(communication)g(abstractions.)95 1121 y Fr(CML)j Fu(is)h(implemented)f(on)g
(top)g(of)g(Standard)g(ML)h(of)f(Ne)o(w)h(Jerse)o(y)g(\()p
Fr(SML/NJ)p Fu(\).)f(W)m(e)h(use)g Fr(SML/NJ)p Fu(')n(s)f(\256rst-class)33
1181 y(continuations)259 1167 y Fo([DHM9)o(1)m(])386 1181 y
Fu(to)f(implement)g(threads)h(and)g(its)f(asynchronous)h(signal)f(mechanism)
1421 1167 y Fo([Rep90)o(])1530 1181 y Fu(to)g(implement)h(pre-)33
1240 y(empti)o(v)o(e)d(thread)g(scheduling.)k(The)d(implementation)e(is)h
(deri)o(v)o(ed)h(from)f(the)g(one)g(described)h(in)e([Rep89)o(].)95
1321 y(In)h(addition)f(to)h(this)f(manual,)j(the)e(distrib)o(ution)d(also)k
(contains)f(an)h(o)o(v)o(ervie)o(w)f(paper)n(,)i(which)e(is)g(a)h(re)o(vised)
g(v)o(ersion)f(of)33 1381 y([Rep91a)o(],)i(and)f(a)h(description)e(of)h(the)g
(formal)g(semantics)h(of)f(the)g Fr(CML)h Fu(concurrenc)o(y)f(primiti)o(v)o
(es,)g(which)g(is)g(a)h(re)o(vised)33 1440 y(v)o(ersion)e(of)g([Rep91b)o(].)
15 b(The)c(author')n(s)e(disseratation)g([Rep92)o(])h(pro)o(vides)g(further)f
(details)h(about)g Fr(CML)p Fu(.)95 1521 y(W)m(e)i(would)e(like)g(to)h(hear)i
(from)e(you.)19 b(If)11 b(you)g(ftp)g(a)h(copy)f(of)g(the)g(distrib)o(ution,)
e(then)j(please)g(send)g(us)f(mail;)h(we)g(will)33 1581 y(use)h(this)e
(information)g(for)h(sending)f(b)o(ug)i(\256x)o(es)g(between)g(releases.)23
b(If)12 b(you)g(ha)o(v)o(e)i(an)o(y)f(comments,)h(suggestion)d(or)h(b)o(ug)33
1641 y(reports,)e(then)g(please)h(send)f(them)h(to)e(us)h(at:)136
1747 y Fp(sml-bugs@research.a)o(tt.co)o(m)684 1732 y Fo(1)33
1854 y Fu(or)g(surface)g(mail)h(to:)136 1951 y(John)f(H.)h(Reppy)136
2001 y(Rm.)16 b(2A-428)136 2051 y(A)-5 b(T&T)12 b(Bell)e(Laboratories)136
2101 y(600)g(Mountain)f(A)m(v)o(e.)136 2151 y(Murray)h(Hill,)g(NJ)g(07974)33
2360 y Fm(Ho)o(w)15 b(to)g(r)o(ead)f(this)h(manual)33 2483
y Fu(This)d(manual)g(attempts)g(to)f(satisfy)h(man)o(y)h(needs:)19
b(tutorial,)11 b(user')n(s)h(guide)f(and)h(reference)i(manual,)f(as)g(well)f
(as)g(release)33 2543 y(notes.)i(F)o(or)c(a)g(tutorial)d(introduction)g(to)i
Fr(CML)p Fu(,)g(you)g(should)g(read)g(Chapter)g(1.)15 b(Source)10
b(code)g(for)f(man)o(y)h(of)f(the)g(e)o(xamples)33 2603 y(is)k(included)g(in)
g(the)h(distrib)o(ution;)e(Appendix)g(C)i(gi)o(v)o(es)g(a)g(mapping)g(from)f
(e)o(xamples)i(to)e(source)i(\256les.)26 b(Chapters)13 b(2\2615)p
33 2635 720 2 v 78 2662 a Fl(1)92 2674 y Fk(The)8 b(old)g(address)f(of)h
Fj(cml-bugs@c)o(s.c)o(orn)o(ell)o(.e)o(du)d Fk(should)i(still)i(work.)922
2799 y Fu(1)p eop
%%Page: 2 8
2 7 bop 190 82 a Fu(are)12 b(a)f(more)g(complete)f(and)h(systematic)g
(presentation)e(of)h Fr(CML)p Fu(.)h(The)g(information)e(in)h(Chapter)g(6)g
(is)h(important)e(for)h(the)190 142 y(de)o(v)o(elopment)k(and)g(construction)
e(of)i(systems)g(based)h(on)f Fr(CML)p Fu(.)g(Some)g(hints)f(on)h(deb)o
(uggin)e Fr(CML)i Fu(programs)g(and)g(a)190 202 y(description)d(of)h(the)g
(deb)o(ugging)e(support)h(pro)o(vided)g(is)h(gi)o(v)o(en)g(in)f(Chapter)h(7.)
20 b(Installation)10 b(and)i(licensing)f(information)190 262
y(can)i(be)f(found)e(in)h(Chapter)h(8.)19 b(Appendix)10 b(A)i(contains)f(the)
h(complete)f(signatures)h(of)f(the)g Fr(CML)h Fu(system;)g(Appendix)f(B)190
321 y(gi)o(v)o(es)f(the)f(signatures)f(of)h(the)g(library)f(modules.)14
b(Lastly)m(,)c(Appendix)e(C)h(gi)o(v)o(es)g(list)f(of)h(the)g(source)h
(\256les)f(in)g(the)g(distrib)o(ution)190 381 y(corresponding)g(to)h(the)g(e)
o(xamples.)190 542 y Fm(Ackno)o(wledgements)190 665 y Fu(The)15
b(design)e(and)h(implementation)f(of)g Fr(CML)h Fu(was)g(done)g(at)g(Cornell)
e(Uni)o(v)o(ersity)m(,)i(and)g(was)g(was)g(supported,)g(in)f(part,)190
725 y(by)g(the)g(NSF)g(and)h(ONR)e(under)h(NSF)h(grant)e(CCR-85-14862,)f(and)
j(by)e(the)h(NSF)h(under)e(grant)h(CCR-89-18233.)21 b(The)190
785 y(graphs)12 b(in)g(Chapter)g(1)g(were)h(dra)o(wn)f(using)g
Fp(dag)912 772 y Fo([GNV88)n(])1022 785 y Fu(.)21 b(Some)13
b(of)f(the)g(plumbing)f(\256xtures)h(described)g(in)g(Section)g(B.1)190
845 y(of)g(the)g(appendix)g(were)h(suggested)f(in)g([Ram90].)21
b(Geor)o(ges)13 b(Lauri)f(was)g(v)o(ery)h(helpful)e(in)h(getting)e(the)i(b)o
(ugs)g(out)g(of)g(the)190 905 y(\256rst)g(distrib)o(utio)o(n.)k(Clif)o(f)10
b(Krumvieda,)i(Cl)r(\302)-16 b(ement)11 b(Pellerin)g(and)h(Thomas)g(Y)l(an)g
(ha)o(v)o(e)g(pro)o(vided)f(b)o(ug)g(reports)f(and)i(useful)190
964 y(feedback)f(about)e(the)g(system)h(and)g(documentation.)k(Clif)o(f)8
b(Krumvieda)h(has)i(also)e(pro)o(vided)g(the)g(design)g(of)h(an)g(impro)o(v)o
(ed)190 1024 y(trace)h(facility)m(.)j(And)c(T)o(im)g(T)m(eitelbaum)h(pro)o
(vided)e(helpful)g(comments)i(on)f(this)f(manual.)1080 2799
y(2)p eop
%%Page: 3 9
3 8 bop 33 414 a Fi(Chapter)20 b(1)33 643 y Fs(A)26 b(CML)g(tutorial)33
889 y Fu(This)15 b(chapter)i(pro)o(vides)e(information)f(on)i(ho)o(w)f(to)g
(load)h(and)g(run)f(the)h(system,)i(and)e(a)h(tutorial)d(introduction)f(to)i
(the)33 949 y(concurrenc)o(y)10 b(features)g(and)f(common)h(programming)f
(techniques)g(of)g Fr(CML)p Fu(.)h(W)m(e)g(assume)h(familiarity)c(with)h
Fr(SML)i Fu(\(and)33 1009 y Fr(SML/NJ)p Fu(\),)f(which)h(pro)o(vides)g(the)g
(sequential)g(core)h(of)f Fr(CML)p Fu(.)g(See)i([P)o(au91)o(])f(or)f([Har86)o
(])g(for)g(an)h(introduction)c(to)j Fr(SML)p Fu(.)33 1170 y
Fm(1.1)57 b(Getting)16 b(started)33 1293 y Fu(If)11 b Fr(CML)h
Fu(has)g(not)e(been)j(installed)d(on)h(your)g(local)g(system,)i(you)e(will)f
(need)j(to)e(load)g(it.)1328 1278 y Fo(1)1363 1293 y Fu(T)m(o)g(do)h(so,)g
(change)g(to)f(the)h(root)33 1353 y(directory)d(of)h(the)g
Fr(CML)g Fu(installation;)e(there)i(you)g(will)f(\256nd)h(a)g(\256le)h
Fp(load-cml)p Fu(.)i(Start)d(up)g Fr(SML/NJ)p Fu(,)g(and)g(load)g(this)g
(\256le:)95 1452 y Fh(\045)19 b(sml)95 1498 y(Standard)d(ML)j(of)g(New)g
(Jersey,)d(Version)h(0.93,)h(February)f(1,)h(1993)95 1544 y(val)g(it)h(=)g
(\(\))g(:)h(unit)95 1589 y(-)f(use)g("load-cml)o(";)95 1635
y([opening)d(load-cml])95 1681 y(val)i(loadCML)f(=)j(fn)e(:)i(unit)e(->)g
(unit)95 1726 y(val)g(loadAll)f(=)j(fn)e(:)i(unit)e(->)g(unit)95
1772 y([closing)e(load-cml])95 1818 y(val)i(it)h(=)g(\(\))g(:)h(unit)95
1863 y(-)33 1977 y Fu(Applying)8 b(the)j(function)e Fp(loadCML)g
Fu(will)h(load)g(the)g(v)o(arious)g(pieces)i(of)e Fr(CML)p
Fu(;)g(the)h(function)e Fp(loadAll)g Fu(will)h(load)g Fr(CML)33
2037 y Fu(plus)16 b(the)h(v)o(arious)g(library)e(modules)i(\(see)i(Appendix)d
(B\).)35 b(Loading)17 b(the)g(system)g(de\256nes)h(a)g(number)f(of)g(top-le)o
(v)o(el)33 2097 y(structures;)10 b(in)g(this)g(chapter)h(we)h(will)d(be)i
(concerned)h(just)e(with)g(the)g(structures)h Fp(CML)f Fu(and)h
Fp(RunCML)p Fu(.)f(The)i(full)d(signatures)33 2156 y(of)j(these)g(structures)
g(and)h(of)f(the)g(other)g(top-le)o(v)o(el)f(structures)h(can)h(be)f(found)g
(in)f(Appendix)h(A.)21 b(Note)12 b(that)g(loading)f(the)33
2216 y(system)e(does)g Fn(not)f Fu(open)h(these)g(structures.)15
b(Because)10 b(the)f Fp(use)f Fu(function)f(does)i(not)g(yet)f(support)g
(relati)o(v)o(e)h(paths,)g(you)f(need)33 2276 y(to)i(be)h(in)f(the)g
Fr(CML)h Fu(root)e(directory)h(for)g Fp(loadCML)f Fu(to)h(work.)15
b(Once)d(you)e(ha)o(v)o(e)h(loaded)g(the)f(system,)i(you)e(can)h(change)g(to)
33 2336 y(your)e(o)o(wn)h(personal)g(source)h(directory)e(using)g(the)h
(function)f Fp(System.Directory.c)o(d)p Fu(.)p 33 2372 720
2 v 78 2399 a Fl(1)92 2411 y Fk(See)g(section)e(8.2)h(for)g(information)f(on)
h(installing)f(a)i(pre-loaded)d(version)g(of)i Fg(CML)p Fk(.)922
2799 y Fu(3)p eop
%%Page: 4 10
4 9 bop 190 82 a Fm(1.2)58 b(Basic)14 b(concurr)o(ency)g(primiti)o(v)o(es)190
206 y Fu(Once)c(you)e(ha)o(v)o(e)i Fr(CML)e Fu(loaded,)h(the)g(\256rst)f
(thing)g(you)g(need)h(to)f(kno)o(w)g(is)h(ho)o(w)f(to)g(make)h(an)g
Fr(ML)g Fu(program)f(multi-threaded;)190 265 y(i.e.,)k(ho)o(w)e(to)f(create)j
(ne)o(w)e(threads.)16 b(This)10 b(is)g(easily)g(done)g(using)f(the)i(follo)o
(wing)c(function)253 364 y Fh(val)18 b(spawn)g(:)h(\(unit)f(->)h(unit\))e(->)
i(thread_id)190 477 y Fu(Applying)11 b Fp(spawn)g Fu(to)h(a)h(function)e
Fq(f)17 b Fu(causes)d(a)f(ne)o(w)g(thread)f(to)g(be)h(created,)h(which)e(e)o
(v)o(aluates)h(the)g(application)e(of)h Fq(f)17 b Fu(to)190
537 y Fp(\(\))p Fu(.)f(The)11 b(ne)o(wly)g(created)g(thread)g(is)f(called)h
(the)f Fn(c)o(hild)p Fu(,)h(and)f(its)g(creator)h(is)g(the)f
Fn(par)n(ent)p Fu(.)16 b(The)11 b(return)f(v)o(alue)h(of)f
Fp(spawn)g Fu(is)g(a)190 597 y Fn(thr)n(ead)f(id)f Fu(that)g(uniquely)e
(identi\256es)i(the)h(child)e(thread.)15 b(The)9 b(child)f(thread)g(will)f
(run)h(until)f(the)h(e)o(v)o(aluation)g(of)g(the)g(function)190
656 y(application)h(is)g(complete,)i(at)e(which)h(time)f(it)g(terminates.)15
b(A)10 b(thread)g(can)g(also)g(terminate)f(itself)g(by)h(calling)e(the)i
(function)253 755 y Fh(val)18 b(exit)g(:)h(unit)f(->)h('a)190
868 y Fu(which)9 b(ne)o(v)o(er)h(returns)f(\(hence)h(the)f
Fp('a)g Fu(return)f(type\).)15 b(Another)8 b(cause)j(of)e(thread)g
(termination)e(is)j(an)f(uncaught)g(e)o(xception)190 928 y(\(see)j(Section)e
(7.4\).)253 1008 y(Since)h Fr(CML)f Fu(runs)h(on)f(a)h(single)f(processor)h
(in)f(the)h(address)g(space)h(of)f(a)g(single)f(U)p Fk(NIX)h
Fu(process,)h(threads)e(must)h(share)190 1068 y(the)g(CPU.)f
Fr(CML)h Fu(uses)g(preempti)o(v)o(e)f(scheduling,)g(so)h(we)g(don')o(t)e
(need)i(to)f(be)g(concerned)i(with)d(insuring)f(that)i(threads)h(are)190
1128 y(scheduled)g(to)e(run.)475 1113 y Fo(2)253 1208 y Fu(Once)j(we)f(ha)o
(v)o(e)h(multiple)e(threads,)i(we)g(need)f(a)h(way)f(for)g(our)f(threads)h
(to)g(cooperate:)17 b(i.e.,)12 b(a)g(way)f(to)g(communicate)190
1268 y(and)16 b(synchronize.)32 b(There)17 b(are)g(a)g(number)e(of)h(dif)o
(ferent)f(language)h(mechanisms)h(for)f(pro)o(viding)e(this.)31
b Fr(CML)16 b Fu(uses)190 1328 y Fn(\256rst-class)c(sync)o(hr)n(onous)g(oper)
o(ations)761 1315 y Fo([Rep88)n(])868 1328 y Fu(for)g(synchronization)e(and)j
(communication.)20 b(This)12 b(mechanism)i(is)e(based)190 1388
y(on)e Fn(sync)o(hr)n(onous)h Fu(message)h(passing)e(via)g(typed)g(channels.)
15 b(Channels)10 b(are)h(dynamically)f(created)h(by)f(the)g(function)253
1486 y Fh(val)18 b(channel)f(:)i(unit)f(->)h('1a)g(chan)190
1599 y Fu(The)9 b(result)f(type)f(is)h Fn(weakly)h(polymorphic)e
Fu(in)g(order)h(to)f(a)o(v)o(oid)h(type)g(loop-holes)e(that)i(can)g(be)h
(introduced)e(by)g(polymorphic)190 1659 y(state.)276 1644 y
Fo(3)308 1659 y Fu(T)m(wo)j(operations)f(are)j(pro)o(vided)d(for)h(channel)g
(communication:)253 1758 y Fh(val)18 b(accept)f(:)j('a)e(chan)h(->)f('a)253
1803 y(val)g(send)57 b(:)20 b(\('a)e(chan)g(*)h('a\))g(->)g(unit)190
1916 y Fu(When)d(a)f(thread)g(e)o(x)o(ecutes)i(a)e Fp(send)f
Fu(or)h Fp(accept)f Fu(on)g(a)i(channel,)g(we)g(say)f(that)g(it)f(is)g
Fn(of)o(fering)g Fu(communication.)29 b(The)190 1976 y(thread)9
b(will)e(block)h(until)e(some)j(other)f(thread)g(of)o(fers)h(a)g
Fn(matc)o(hing)e Fu(communication)h(\(i.e.,)i(the)e(complementary)h
(operation)190 2036 y(on)k(the)f(same)j(channel\).)23 b(When)13
b(two)e(threads)i(of)o(fer)g(matching)f(communications,)h(the)o(y)g(e)o
(xchange)h(the)f(message)h(and)190 2095 y(both)9 b(threads)h(continue)f(e)o
(x)o(ecution.)16 b(This)9 b(is)h(also)g(called)g Fn(r)n(endezvous)h
Fu(style)f(communication,)g(since)g(two)f(threads)h(must)190
2155 y(rendezv)o(ous)h(to)f(e)o(xchange)h(data.)190 2260 y
Fr(Example)f(1.1)190 2341 y Fu(This)h(simple)f(e)o(xample)h(consists)f(of)g
(a)h(root)f(thread)g(that)g(creates)i(a)e(channel)h Fp(ch)f
Fu(and)h(then)f(spa)o(wns)h(two)e(children,)h(which)190 2400
y(use)k Fp(ch)g Fu(to)e(communicate)j(once.)25 b(All)13 b(three)h(threads)f
(print)f(a)i(message)h(at)f(their)f(be)o(ginning)f(and)h(end.)25
b(Note)14 b(that)f(the)190 2460 y(function)h Fp(CIO.print)g
Fu(is)i(used)g(to)f(print)f(the)h(messages;)20 b(the)15 b(structure)g
Fp(CIO)g Fu(pro)o(vides)h(an)f(implementation)g(of)g(I/O)190
2520 y(operations)10 b(that)f(can)i(be)g(safely)f(used)h(in)f(a)g
Fr(CML)h Fu(program)f(\(see)h(section)f(5.1\).)p 190 2555 720
2 v 236 2583 a Fl(2)250 2594 y Fk(This)f(is)f(in)g(contrast)g(with)g
(coroutine)f(based)g(implementations,)g(where)g(the)h(issue)g(of)g
(scheduling)e(rears)i(its)g(ugly)g(head.)236 2623 y Fl(3)250
2635 y Fk(This)h(is)g(one)f(of)h(the)f(places)g(in)h(which)f
Fg(SML/NJ)i Fk(v)o(aries)e(from)h(the)f(de\256nition)h(\([MTH90)o(]\).)14
b(The)9 b Ff(imperative)e Fk(types)h(of)h(the)f(de\256nition)h(are)f(more)190
2674 y(restricti)o(ve)g(then)g(the)g(weak)f(types)g(of)h Fg(SML/NJ)p
Fk(.)1080 2799 y Fu(4)p eop
%%Page: 5 11
5 10 bop 95 82 a Fh(fun)18 b(simple_comm)e(\(\))j(=)g(let)213
128 y(val)f(ch)h(=)g(channel\(\))213 174 y(val)f(pr)h(=)g(CIO.print)213
219 y(in)252 265 y(pr)g("hi-0\\n";)252 310 y(spawn)f(\(fn)g(\(\))h(=>)g(\(pr)
f("hi-1\\n";)36 b(send\(ch,)16 b(17\);)38 b(pr)19 b("bye-1\\n")o(\)\);)252
356 y(spawn)f(\(fn)g(\(\))h(=>)g(\(pr)f("hi-2\\n";)36 b(accept)17
b(ch;)97 b(pr)19 b("bye-2\\n")o(\)\);)252 402 y(pr)g("bye-0\\n")213
447 y(end)33 561 y Fu(An)10 b(outside)g(observ)o(er)h(of)g(this)e(program')n
(s)i(e)o(x)o(ecution)g(will)e(see)j(the)f(messages)h(\252)p
Fp(hi-0)p Fu(,)m(\272)g(\252)p Fp(hi-1)p Fu(,)m(\272)f(...,)i(\252)p
Fp(bye-2)p Fu(,)m(\272)e(printed)33 621 y(in)e(some)i(order)n(.)k(The)c
(possible)e(orders)h(are)i(characterized)f(by)f(the)g(follo)o(wing)e(graph:)
633 1181 y @beginspecial 35 @llx 35 @lly 181 @urx 155 @ury
1440 @rwi @setspecial
%%BeginDocument: simple-comm.ps
/coord-font-family /Times-Roman def
/node-font-family /Times-Roman def
/edge-font-family /Times-Roman def
/coordfont coord-font-family findfont 6 scalefont def

/set_font {
	findfont exch
	dup /dag_font_size exch def
	dup .8 mul /hack_font_size exch def
	scalefont setfont
} def

/setdagcolor {aload pop sethsbcolor} bind def

/dagalignedlabel {		% alignfactor height width name
	/alignfactor exch def
	/height exch def
	/width exch def
	/nodename exch def
	gsave
		currentpoint newpath moveto
		nodename stringwidth pop
		alignfactor mul hack_font_size  -.5 mul rmoveto
		nodename show
	grestore
} bind def

/daglabel {
	-.5 dagalignedlabel
} bind def

/midpoint {
	exch 4 -1 roll add 2 div
	3 1 roll add 2 div
} bind def

/arrowhead {
	gsave
	rotate
	currentpoint
	newpath
		moveto
		arrowlength arrowwidth 2 div rlineto
		0 arrowwidth neg rlineto
	closepath fill
	grestore
} bind def

/makearrow {
	currentpoint exch pop sub exch currentpoint pop sub atan
	arrowhead
} bind def


/Box {
	/height exch def
	/width exch def
	/nodename exch def
	currentpoint 2 copy
	newpath
		moveto
		width -2 div
		height -2 div
		rmoveto
		width 0 rlineto
		0 height rlineto
		width neg 0 rlineto
	closepath
	stroke
	moveto 
	nodename width .9 mul height .9 mul daglabel
} bind def

/Box_clip {	% height width x0 y0 x1 y1 -> x1 y1
	6 2 roll
	pop pop pop pop
} bind def

/Square {
	2 copy
	gt {exch pop dup} {pop dup} ifelse
	Box
} bind def

/Square_clip {
	Box_clip
} bind def

/Plaintext {
	daglabel
} bind def

/Plaintext_clip {
	Box_clip
} bind def


/Diamond {
	/height exch def
	/width exch def
	/nodename exch def
	/hh height 2 div def
	/hw width 2 div def
	currentpoint 2 copy
	newpath
		moveto
		0 hh neg rmoveto
		hw hh rlineto
		hw neg hh rlineto
		hw neg hh neg rlineto
	closepath
	stroke
	moveto 
	nodename width .9 mul height .9 mul daglabel
} bind def

/between {
	sub 3 1 roll sub mul 0 ge
} bind def

/seginter { % x2 y2 x3 y3 -> false  OR  xinter yinter true
	% use x0 y0 x1 y1 of current dict
	/y3 exch def
	/x3 exch def
	/y2 exch def
	/x2 exch def
	x0 x1 ne x2 x3 ne or
	{
		x2 x3 eq {	/x2 x0 /x0 x2 def def
				/y2 y0 /y0 y2 def def
				/x1 x3 /x3 x1 def def
				/y1 y3 /y3 y1 def def
		} if

		x0 x1 eq {
			/x x0 def false
		} 
		{
			/m0 y1 y0 sub x1 x0 sub div def
			/b0 y0 m0 x0 mul sub def
			/m1 y3 y2 sub x3 x2 sub div def
			/b1 y2 m1 x2 mul sub def
			m1 m0 eq {
				b0 b1 ne {false} 
				{	/l0lowx x0 x1 min def
				 	/l0highx x0 x1 max def
					/l1lowx x2 x3 min def
					/l1highx x2 x3 max def
					l0lowx l1lowx dup l0highx between
					{/x l1lowx def true}
					{
						l0lowx l1highx dup l0highx between
						{/x l1highx def true}
						{
							l1lowx l0lowx dup l1highx between
							{/x l0lowx def true}
							{false} ifelse
						} ifelse
					} ifelse
				} ifelse
			}
			{
				/x b1 b0 sub m0 m1 sub div def true
			} ifelse
		} ifelse
		{
			x2 x x x3 between
			{
				y2 m1 x mul b1 add dup y3 between
				{
					x
					m1 x mul b1 add 
					true
				}
				{
					false
				} ifelse
			}
			{ false } ifelse
		}
		{false} ifelse
	}
	{false} ifelse
} bind def

/Diamond_clip {
	/y1 exch def
	/x1 exch def
	/y0 exch def
	/x0 exch def
	2 div /height2 exch def
	2 div /width2  exch def
	x0 x1 eq y0 y1 eq and {x1 y1} {
		x0 0 ge y0 0 ge and {
			width2 0 0 height2 seginter
		}
		{
			x0 0 le y0 0 ge and {
				0 height2 width2 neg 0 seginter
			}
			{
				x0 0 le y0 0 le and {
					width2 neg 0 0 height2 neg seginter
				}
				{
					0 height2 neg width2 0 seginter
				} ifelse
			} ifelse
		} ifelse
		not {x1 y1} if
	} ifelse
} bind def

/Triangle {
	/y exch def
	/x exch def
	/nodename exch def
	/x2 x 2 div def
	/y2 y 2 div def
	currentpoint 
	x2 neg y2 2 div neg rmoveto x 0 rlineto x2 neg y 3 mul 4 div rlineto
	closepath stroke
	moveto nodename x y daglabel
} bind def

/Triangle_clip {
	/y1 exch def
	/x1 exch def
	/y0 exch def
	/x0 exch def
	/height exch def
	/width  exch def
	y0 height 4 div neg lt		% base
	{
		x0 x1 eq {
			x1 height 4 div neg
		}
		{
			width 2 div neg height 4 div neg width 2 div height 4 div neg
			seginter not
			{
				x1 0 gt {width 2 div}{width 2 div neg} ifelse
				height 4 div neg
			} if
		} ifelse
	}
	{
		%take one side or the other
		x1 0 gt {width 2 div}{width 2 div neg} ifelse	
		height 4 div neg					
		0 height 2 div			% the apex vertex
		seginter not
		{0 height 2 div} if		% return apex if it missed
	} ifelse
} bind def

/Circle {
	/y exch def
	/x exch def
	/nodename exch def
	currentpoint 2 copy 2 copy
	newpath
	moveto
	/rad x y lt {x} {y} ifelse 2 div def
	rad 0 rmoveto
	rad 0 360 arc stroke
	moveto
	nodename x .85 mul y .85 mul daglabel
} bind def

/Circle_clip {
	Ellipse_clip
} bind def

/Doublecircle {
	/height exch def
	/width exch def
	/nodename exch def
	currentpoint 2 copy 2 copy 2 copy
	newpath
	moveto
	width height lt {width} {height} ifelse
	2 div /rad exch def
	rad 0 rmoveto
	rad 0 360 arc stroke
	rad .9 mul 0 360 arc stroke
	moveto
	nodename width .85 mul height .85 mul daglabel
} bind def

/Doublecircle_clip {
	Circle_clip
} bind def

/Ellipse {
	/height exch def
	/width exch def
	/nodename exch def
	currentpoint			% save for label
	% distort user space
	gsave
		currentpoint translate
		0 0 moveto
		matrix currentmatrix		% save it
		width height div 1 scale	% scale in x
		height 2 div 0 rmoveto
		newpath 0 0 height 2 div 0 360 arc
		setmatrix					% restore
		stroke
	grestore
	moveto nodename width .9 mul height .9 mul daglabel
} bind def

/Ellipse_clip {
	/y1 exch def
	/x1 exch def
	/y0 exch def
	/x0 exch def
	2 div /ry exch def
	2 div /rx exch def
	x0 x1 eq 
	{	% degenerate case
		x1 y1
	} 
	{	% normal case
		{
			/gotanswer false def
			/m y1 y0 sub x1 x0 sub div def	% m = (y1 - y0)/(x1 - x0);
			/b y0 x0 m mul sub def		% b = y0 - m * x0
			% aa = 1/(rx*rx)+ (m*m)/(ry*ry);
			/aa 1 rx rx mul div m m mul ry ry mul div add def
			% bb = (2*m*b)/(ry*ry);
			/bb 2 m b mul mul ry ry mul div def 
			% cc = (b*b)/(ry*ry) - 1;
			/cc b b mul ry ry mul div 1 sub def
			m 0 eq {
				/s0 rx def
				/s1 rx neg def
				/gotanswer true def
			}
			{
				% t = b^2 - 4ac
				/t bb bb mul 4 aa cc mul mul sub def
				t 0 lt {
					x1 y1
					exit
				}
				{
					/s0 bb neg t sqrt add 2 aa mul div def
					/s1 bb neg t sqrt sub 2 aa mul div def
					/gotanswer true def
				} ifelse
			} ifelse
			gotanswer {
				% by here, s0 and s1 are set.
				s0 x0 sub abs s1 x0 sub abs le {s0} {s1} ifelse
				dup m mul b add
				exit
			} if
		} loop
	} ifelse
} bind def

/white		[0 0 1]	def
/black		[1 1 0]	def
/red		[0 1 1]	def
/green		[.333 1 1]	def
/blue		[.667 1 1]	def
/yellow		[.167 1 1]	def
/magenta	[.833 1 1]	def
/cyan		[.500 1 1]	def
save
/DagDict 200 dict def
DagDict begin
0.655 0.655 scale
/arrowlength 7 def
/arrowwidth arrowlength 2 div def
/node-font-family /Courier def
save
54 54 moveto 223 0 rlineto 0 183 rlineto -223 0 rlineto closepath clip newpath
55 55 translate
14 node-font-family set_font
33 90 moveto
(hi-1) 54 36 Ellipse
187 90 moveto
(hi-2) 54 36 Ellipse
33 18 moveto
(bye-1) 65 36 Ellipse
187 18 moveto
(bye-2) 65 36 Ellipse
110 162 moveto
(hi-0) 54 36 Ellipse
110 90 moveto
(bye-0) 65 36 Ellipse
[1 6 idtransform abs ceiling exch abs ceiling exch] 0 setdash
14 edge-font-family set_font
newpath  54 36 122 -60 9 -18 Ellipse_clip
90 add exch 33 add exch
moveto
 98 51 lineto
 65 36 -145 54 -32 12 Ellipse_clip
18 add exch 187 add exch
lineto currentpoint stroke moveto
98 51 makearrow
stroke
[] 0 setdash
newpath  54 36 0 -54 0 -18 Ellipse_clip
90 add exch 33 add exch
moveto
 33 54 lineto
 65 36 0 54 0 18 Ellipse_clip
18 add exch 33 add exch
lineto currentpoint stroke moveto
33 54 makearrow
stroke
[1 6 idtransform abs ceiling exch abs ceiling exch] 0 setdash
newpath  54 36 -122 -60 -9 -18 Ellipse_clip
90 add exch 187 add exch
moveto
 121 51 lineto
 65 36 145 54 32 12 Ellipse_clip
18 add exch 33 add exch
lineto currentpoint stroke moveto
121 51 makearrow
stroke
[] 0 setdash
newpath  54 36 0 -54 0 -18 Ellipse_clip
90 add exch 187 add exch
moveto
 187 54 lineto
 65 36 0 54 0 18 Ellipse_clip
18 add exch 187 add exch
lineto currentpoint stroke moveto
187 54 makearrow
stroke
[9 9 idtransform abs ceiling exch abs ceiling exch] 0 setdash
newpath  54 36 60 -54 26 -18 Ellipse_clip
162 add exch 110 add exch
moveto
 153 126 lineto
 54 36 -51 54 -17 18 Ellipse_clip
90 add exch 187 add exch
lineto currentpoint stroke moveto
153 126 makearrow
stroke
newpath  54 36 -60 -54 -26 -18 Ellipse_clip
162 add exch 110 add exch
moveto
 67 126 lineto
 54 36 51 54 17 18 Ellipse_clip
90 add exch 33 add exch
lineto currentpoint stroke moveto
67 126 makearrow
stroke
[] 0 setdash
newpath  54 36 0 -54 0 -18 Ellipse_clip
162 add exch 110 add exch
moveto
 110 126 lineto
 65 36 0 54 0 18 Ellipse_clip
90 add exch 110 add exch
lineto currentpoint stroke moveto
110 126 makearrow
stroke
showpage
restore
end
restore
%%EndDocument
 @endspecial 33 1295 a(The)17 b(solid)f(edges)i(are)f(induced)g(by)f(the)h
(order)g(of)f(sequential)h(e)o(x)o(ecution,)i(the)e(dashed)g(edges)g(by)g
Fp(spawn)p Fu(,)h(and)f(the)33 1355 y(dotted)g(edges)i(by)e(the)h(rendezv)o
(ous.)40 b(Ev)o(en)19 b(though)d(this)i(program)g(does)g(not)f(in)n(v)o(olv)o
(e)h(non-deterministic)e(choice)33 1415 y(\(i.e.,)e(from)e(selecti)o(v)o(e)i
(communication\),)f(it)e(e)o(xhibits)h(indeterminac)o(y)h(because)h(of)e(the)
h(independence)g(of)f(the)g(threads.)33 1474 y(Indeterminate)e(beha)o(vior)g
(is)g(both)f(the)i(bane)g(and)f(boon)g(of)g(concurrent)g(programming.)15
b(It)10 b(limits)f(our)h(ability)f(to)g(predict)33 1534 y(program)h(beha)o
(vior)n(,)g(b)o(ut)g(pro)o(vides)f(\257e)o(xibility)g(in)g(scheduling)h
(independent)f(tasks.)33 1695 y Fm(1.3)57 b(Running)16 b(a)f(CML)f(pr)o
(ogram)33 1819 y Fr(CML)c Fu(is)g(currently)f(designed)g(to)h(be)g(used)h(in)
e(\252batch\272)i(mode:)k(you)9 b(enter)i(a)f(program)g(in)g(the)g
(single-threaded)f(top-le)o(v)o(el)33 1878 y(en)n(vironment,)g(and)g(then)g
(you)f(run)h(it.)14 b(Threads)c(should)e(only)g(be)h(spa)o(wned)h(inside)e
(other)h(functions)f(\(ne)o(v)o(er)h(at)h(top-le)o(v)o(el\).)33
1938 y(T)m(o)g(run)g(a)g Fr(CML)h Fu(program)f(you)f(use)i(the)f(function)95
2038 y Fh(val)18 b(doit)g(:)i(\(\(unit)d(->)i(unit\))e(*)j(int)e(option\))f
(->)i(unit)33 2151 y Fu(from)11 b(the)h(structure)f Fp(RunCML)p
Fu(.)g(The)h(\256rst)f(ar)o(gument)h(is)g(your)e Fn(r)n(oot)i
Fu(thread,)g(which)f(is)g(a)i(function)d(that)h(creates)i(the)e(other)33
2211 y(threads)e(of)f(your)h(program.)14 b(The)c(second)f(ar)o(gument)h
(speci\256es)g(the)f(size)g(of)g(the)g(scheduling)f(time-slice)h(in)f
(milliseconds.)33 2271 y(If)i Fp(NONE)g Fu(is)g(supplied)g(as)h(the)f
(time-slice)h(v)o(alue,)g(then)f(preempti)o(v)o(e)h(scheduling)e(is)i
(disabled,)f(b)o(ut,)g(since)h(v)o(arious)f(system)33 2331
y(services)h(depend)f(on)g(preemption)f(to)h(work)f(correctly)m(,)i(it)e(is)h
(not)g(recommended.)33 2436 y Fr(Example)f(1.2)33 2517 y Fu(F)o(or)i(e)o
(xample,)i(let)e(us)g(look)f(at)h(the)g(steps)g(required)g(to)f(run)h(the)g
(program)g(gi)o(v)o(en)g(in)f(Example)i(1.1.)18 b(Assume)12
b(that)e(we)i(are)33 2576 y(in)e(the)h(root)f(directory)g(of)h(the)g
Fr(CML)g Fu(distrib)o(utio)o(n)d(and)j(are)h(running)d Fr(CML)p
Fu(.)j(Then)f(we)h(can)g(load)e(and)h(run)g(the)g(e)o(xample)33
2636 y(as)g(follo)o(ws:)922 2799 y(5)p eop
%%Page: 6 12
6 11 bop 253 82 a Fh(-)19 b(open)f(CML;)253 128 y(open)g(CML)253
174 y(-)h(use)f("examples/)o(ex-)o(sim)o(pl)o(e-c)o(om)o(m.s)o(ml")o(;)253
219 y([opening)e(examples/e)o(x-s)o(im)o(ple)o(-c)o(omm)o(.sm)o(l])253
265 y(val)i(simple_com)o(m)e(=)k(fn)f(:)g(unit)f(->)h(unit)253
310 y([closing)d(examples/e)o(x-s)o(im)o(ple)o(-c)o(omm)o(.sm)o(l])253
356 y(val)i(it)h(=)g(\(\))g(:)g(unit)253 402 y(-)g(RunCML.do)o(it\()o(si)o
(mpl)o(e_c)o(om)o(m,)d(SOME)i(20\);)253 447 y(hi-0)253 493
y(hi-1)253 539 y(hi-2)253 584 y(bye-0)253 630 y(bye-2)253 676
y(bye-1)253 721 y(val)g(it)h(=)g(\(\))g(:)g(unit)253 767 y(-)190
867 y Fu(In)11 b(this)f(e)o(xample,)i(we)f(\256rst)g(open)f(the)h
Fp(CML)f Fu(structure)g(to)h(pro)o(vide)f(the)g(right)g(en)n(vironment)g(for)
g(compiling)f(the)i(e)o(xample;)190 927 y(then)k(we)g(load)g(the)g(e)o
(xample)h(\256le)f(and)g(run)f(it.)29 b(The)16 b(\252)p Fp(SOME)21
b(20)p Fu(\272)15 b(ar)o(gument)g(to)g Fp(doit)f Fu(speci\256es)i(a)f
(time-slice)g(of)g(20)190 987 y(milli-seconds.)253 1067 y(T)m(ermination)e
(in)g(concurrent)g(programs)h(is)f(a)h(more)h(in)n(v)o(olv)o(ed)e(process)h
(than)f(in)g(sequential)g(programs.)26 b(A)14 b Fr(CML)190
1127 y Fu(program)9 b(will)f(terminate)h(if)g(it)f(deadlocks,)i(i.e.,)g(all)f
(of)g(its)f(threads)h(are)h(blocked)e(\(threads)h(waiting)e(for)i(input)f(or)
g(timeouts)190 1187 y(are)15 b(not)e(considered)g(blocked\).)25
b(In)13 b(the)h(case)h(of)f(Example)g(1.2,)h(all)e(of)h(the)f(user)h(threads)
g(terminate)g(and)g(the)f(system)190 1247 y(threads)c(are)g(all)f(blocked,)h
(so)f(the)h(whole)f(system)h(terminates.)15 b(In)8 b(general,)h(it)f(is)g
(necessary)i(to)e(terminate)h(under)f(software)190 1306 y(control,)g(since)h
(it)e(is)h(often)g(the)g(case)h(that)f(a)h(program)f(has)g(some)h(threads)f
(that)g(will)f(always)h(ha)o(v)o(e)h(the)f(potential)e(of)i(running)190
1366 y(\(e.g.,)13 b(monitoring)c(an)i(input)f(stream\).)18
b(The)12 b(function)d Fp(RunCML.shutdown)f Fu(forces)k(a)g(clean)f(shutdo)o
(wn)f(of)h(the)g(system.)190 1426 y(The)g(are)g(a)g(number)f(of)g(issues)g
(related)h(to)e(the)h(initialization)d(and)k(clean)f(termination)f(of)h
Fr(CML)g Fu(programs)g(that)g(we)g(ha)o(v)o(e)190 1486 y(not)g(discussed)g
(here.)16 b(See)11 b(Chapter)f(6)g(for)g(details.)253 1566
y(It)h(is)g(also)h(possible)e(to)h(kill)g(a)h Fr(CML)f Fu(program)h(by)f
(hitting)e(the)i(break)h(ke)o(y)g(\(e.g.)20 b(control-C\),)10
b(which)h(should)f(return)190 1626 y(control)h(to)h(the)g Fr(SML)g
Fu(top)f(loop.)680 1611 y Fo(4)717 1626 y Fu(If,)h(for)g(some)h(reason,)g
(this)e(does)i(not)e(terminate)h Fr(CML)p Fu(,)g(you)g(should)f(use)h(the)g
(U)p Fk(NIX)190 1686 y Fu(commands)g Fp(ps)p Fu(\(1\))d(and)h
Fp(kill)p Fu(\(1\))f(to)h(kill)f(the)h(program.)190 1844 y
Fm(1.4)58 b(Str)o(eams)190 1967 y Fu(One)15 b(use)f(of)g(processes)h(and)f
(channels)h(is)f(for)f(stream)i(\(or)f(data-\257o)o(w\))f(style)h
(programming)1594 1954 y Fo([ASS85)n(])1695 1967 y Fu(.)26
b(Streams)15 b(can)g(be)190 2027 y(vie)o(wed)c(as)g(in\256nite)e(lists;)f
(for)i(e)o(xample)758 2111 y Fr(Nat)h Fe(=)g Fq(f)t Fe(\()p
Fu(0)p Fe(\))h Fu(where)e Fq(f)t Fe(\()p Fq(n)p Fe(\))j(=)f
Fq(n)d Ft(\001)g Fq(f)t Fe(\()p Fq(n)h Fe(+)f Fu(1)p Fe(\))190
2195 y Fu(de\256nes)k(the)e(stream)i(\(or)e(list\))f(of)i(natural)f(numbers)h
(\(where)g(\252)p Ft(\001)p Fu(\272)g(is)f(lazy)h(cons\).)20
b(This)11 b(de\256nition)f(can)j(be)f(implemented)190 2255
y(as)f(follo)o(ws:)253 2341 y Fh(fun)18 b(makeNatStr)o(ea)o(m)f(\(\))i(=)g
(let)370 2387 y(val)g(ch)g(=)g(channel\(\))370 2432 y(fun)g(f)g(i)g(=)g
(\(send\(ch,)e(i\);)h(f\(i+1\)\))370 2478 y(in)410 2524 y(spawn)f(\(fn)i
(\(\))g(=>)f(f)i(0\);)410 2569 y(ch)370 2615 y(end)p 190 2635
720 2 v 236 2662 a Fl(4)250 2674 y Fk(If)9 b(the)e(garbage)g(collector)g(is)i
(running,)e(then)g(termination)g(is)i(postponed)d(until)i(after)g(it)h
(\256nishes.)1080 2799 y Fu(6)p eop
%%Page: 7 13
7 12 bop 33 82 a Fu(where)12 b(the)f(function)f Fq(f)16 b Fu(is)11
b(represented)h(by)f(a)h(thread,)g(and)f(the)g(stream)h(is)f(represented)h
(by)f(an)h(inte)o(ger)f(v)o(alued)g(channel.)33 142 y(This)k(style)h(of)f
(programming)g(has)i(been)f(used)g(to)f(implement)h(computations)f(with)g(po)
o(wer)g(series)i(in)e(the)h(language)33 202 y Fr(newsqueak)228
189 y Fo([McI90)o(])326 202 y Fu(.)33 307 y Fr(Example)9 b(1.3)h(\(Sie)o(ve)h
(of)e(Eratosthenes\))33 388 y Fu(As)14 b(an)g(e)o(xample)i(of)d(this)h(style)
f(of)h(programming,)g(we)h(will)e(implement)h(the)f Fn(Sie)o(ve)j(of)d(Er)o
(atosthenes)h Fu(for)g(computing)33 447 y(prime)c(numbers.)16
b(T)m(o)10 b(start)g(with,)g(we)h(need)g(the)g(stream)g(of)f(natural)g
(numbers)g(greater)h(than)f(one,)h(which)f(is)h(pro)o(vided)e(by)33
507 y(the)h(follo)o(wing)e(generalization)h(of)h(the)g(natural)g(number)g
(stream:)95 607 y Fh(fun)18 b(counter)f(start)h(=)h(let)213
653 y(val)f(ch)h(=)g(channel\(\))213 698 y(fun)f(count)g(i)h(=)g(\(send\(ch,)
d(i\);)j(count\(i+1)o(\)\))213 744 y(in)252 790 y(spawn)f(\(fn)g(\(\))h(=>)g
(count)e(start\);)252 835 y(ch)213 881 y(end)33 995 y Fu(The)d(function)e
Fp(sieve)g Fu(produces)i(a)g(ne)o(w)f(stream)i(of)e(prime)g(numbers,)i(which)
e(is)g(represented)h(by)f(a)h(chain)g(of)f(threads)33 1054
y(connected)d(by)g(channels:)95 1154 y Fh(fun)18 b(sieve)g(\(\))h(=)g(let)213
1200 y(val)f(primes)f(=)j(channel)c(\(\))213 1245 y(fun)i(filter)f(\(p,)i
(inCh\))e(=)j(let)252 1291 y(val)e(outCh)g(=)h(channel\(\))252
1337 y(fun)f(loop)g(\(\))h(=)g(let)g(val)f(i)i(=)f(accept)e(inCh)370
1382 y(in)409 1428 y(if)i(\(\(i)f(mod)g(p\))h(<>)g(0\))g(then)f(send)g
(\(outCh,)f(i\))i(else)f(\(\);)409 1474 y(loop)g(\(\))370 1519
y(end)252 1565 y(in)291 1611 y(spawn)g(loop;)291 1656 y(outCh)252
1702 y(end)213 1748 y(fun)g(head)g(ch)h(=)g(let)g(val)f(p)h(=)h(accept)d(ch)
330 1793 y(in)370 1839 y(send)h(\(primes,)e(p\);)370 1885 y(head)i(\(filter)e
(\(p,)j(ch\)\))330 1930 y(end)213 1976 y(in)252 2022 y(spawn)f(\(fn)g(\(\))h
(=>)g(head)f(\(counter)e(2\)\);)252 2067 y(primes)213 2113
y(end)33 2227 y Fu(Looking)8 b(at)i(the)f(implementation)g(of)g
Fp(sieve)p Fu(,)h(we)g(see)h(that)e(the)g(chain)h(of)f(threads)h(starts)g
(with)e(the)i Fp(counter)e Fu(thread)i(and)33 2286 y(ends)f(with)g(the)g
Fp(head)f Fu(thread.)15 b(There)10 b(is)g(one)f Fp(filter)f
Fu(thread)i(in)e(the)i(chain)f(for)g(each)h(prime)g(number)f(disco)o(v)o
(ered)h(so)f(far;)33 2346 y(the)j Fp(head)h Fu(thread)f(creates)j(ne)o(w)e
(\256lters)f(as)i(ne)o(w)f(primes)g(are)h(found.)22 b(The)14
b(function)d Fp(primes)h Fu(prints)g(the)g(\256rst)h Fp(n)g
Fu(prime)33 2406 y(numbers.)922 2799 y(7)p eop
%%Page: 8 14
8 13 bop 253 82 a Fh(fun)18 b(primes)f(n)j(=)f(let)370 128
y(val)g(ch)g(=)g(sieve)f(\(\))370 174 y(fun)h(loop)f(0)h(=)g(\(\))410
219 y(|)g(loop)f(i)h(=)g(\(CIO.print)o(\(ma)o(kes)o(tr)o(ing)o(\(a)o(cce)o
(pt)d(ch\)^"\\n"\);)g(loop\(i-1\))o(\))370 265 y(in)410 310
y(loop)i(n)370 356 y(end)190 464 y Fu(The)11 b(follo)o(wing)d(picture)i(sho)o
(ws)g(the)g(state)g(of)g(the)g(sie)o(v)o(e)i(at)e(each)h(iteration)e(of)h(e)o
(v)o(aluating)f Fp(primes)g(4)p Fu(:)565 956 y @beginspecial
35 @llx 35 @lly 523 @urx 235 @ury 2520 @rwi @setspecial
%%BeginDocument: sieve.ps
/coord-font-family /Times-Roman def
/node-font-family /Times-Roman def
/edge-font-family /Times-Roman def
/coordfont coord-font-family findfont 6 scalefont def

/set_font {
	findfont exch
	dup /dag_font_size exch def
	dup .8 mul /hack_font_size exch def
	scalefont setfont
} def

/setdagcolor {aload pop sethsbcolor} bind def

/dagalignedlabel {		% alignfactor height width name
	/alignfactor exch def
	/height exch def
	/width exch def
	/nodename exch def
	gsave
		currentpoint newpath moveto
		nodename stringwidth pop
		alignfactor mul hack_font_size  -.5 mul rmoveto
		nodename show
	grestore
} bind def

/daglabel {
	-.5 dagalignedlabel
} bind def

/midpoint {
	exch 4 -1 roll add 2 div
	3 1 roll add 2 div
} bind def

/arrowhead {
	gsave
	rotate
	currentpoint
	newpath
		moveto
		arrowlength arrowwidth 2 div rlineto
		0 arrowwidth neg rlineto
	closepath fill
	grestore
} bind def

/makearrow {
	currentpoint exch pop sub exch currentpoint pop sub atan
	arrowhead
} bind def


/Box {
	/height exch def
	/width exch def
	/nodename exch def
	currentpoint 2 copy
	newpath
		moveto
		width -2 div
		height -2 div
		rmoveto
		width 0 rlineto
		0 height rlineto
		width neg 0 rlineto
	closepath
	stroke
	moveto 
	nodename width .9 mul height .9 mul daglabel
} bind def

/Box_clip {	% height width x0 y0 x1 y1 -> x1 y1
	6 2 roll
	pop pop pop pop
} bind def

/Square {
	2 copy
	gt {exch pop dup} {pop dup} ifelse
	Box
} bind def

/Square_clip {
	Box_clip
} bind def

/Plaintext {
	daglabel
} bind def

/Plaintext_clip {
	Box_clip
} bind def


/Diamond {
	/height exch def
	/width exch def
	/nodename exch def
	/hh height 2 div def
	/hw width 2 div def
	currentpoint 2 copy
	newpath
		moveto
		0 hh neg rmoveto
		hw hh rlineto
		hw neg hh rlineto
		hw neg hh neg rlineto
	closepath
	stroke
	moveto 
	nodename width .9 mul height .9 mul daglabel
} bind def

/between {
	sub 3 1 roll sub mul 0 ge
} bind def

/seginter { % x2 y2 x3 y3 -> false  OR  xinter yinter true
	% use x0 y0 x1 y1 of current dict
	/y3 exch def
	/x3 exch def
	/y2 exch def
	/x2 exch def
	x0 x1 ne x2 x3 ne or
	{
		x2 x3 eq {	/x2 x0 /x0 x2 def def
				/y2 y0 /y0 y2 def def
				/x1 x3 /x3 x1 def def
				/y1 y3 /y3 y1 def def
		} if

		x0 x1 eq {
			/x x0 def false
		} 
		{
			/m0 y1 y0 sub x1 x0 sub div def
			/b0 y0 m0 x0 mul sub def
			/m1 y3 y2 sub x3 x2 sub div def
			/b1 y2 m1 x2 mul sub def
			m1 m0 eq {
				b0 b1 ne {false} 
				{	/l0lowx x0 x1 min def
				 	/l0highx x0 x1 max def
					/l1lowx x2 x3 min def
					/l1highx x2 x3 max def
					l0lowx l1lowx dup l0highx between
					{/x l1lowx def true}
					{
						l0lowx l1highx dup l0highx between
						{/x l1highx def true}
						{
							l1lowx l0lowx dup l1highx between
							{/x l0lowx def true}
							{false} ifelse
						} ifelse
					} ifelse
				} ifelse
			}
			{
				/x b1 b0 sub m0 m1 sub div def true
			} ifelse
		} ifelse
		{
			x2 x x x3 between
			{
				y2 m1 x mul b1 add dup y3 between
				{
					x
					m1 x mul b1 add 
					true
				}
				{
					false
				} ifelse
			}
			{ false } ifelse
		}
		{false} ifelse
	}
	{false} ifelse
} bind def

/Diamond_clip {
	/y1 exch def
	/x1 exch def
	/y0 exch def
	/x0 exch def
	2 div /height2 exch def
	2 div /width2  exch def
	x0 x1 eq y0 y1 eq and {x1 y1} {
		x0 0 ge y0 0 ge and {
			width2 0 0 height2 seginter
		}
		{
			x0 0 le y0 0 ge and {
				0 height2 width2 neg 0 seginter
			}
			{
				x0 0 le y0 0 le and {
					width2 neg 0 0 height2 neg seginter
				}
				{
					0 height2 neg width2 0 seginter
				} ifelse
			} ifelse
		} ifelse
		not {x1 y1} if
	} ifelse
} bind def

/Triangle {
	/y exch def
	/x exch def
	/nodename exch def
	/x2 x 2 div def
	/y2 y 2 div def
	currentpoint 
	x2 neg y2 2 div neg rmoveto x 0 rlineto x2 neg y 3 mul 4 div rlineto
	closepath stroke
	moveto nodename x y daglabel
} bind def

/Triangle_clip {
	/y1 exch def
	/x1 exch def
	/y0 exch def
	/x0 exch def
	/height exch def
	/width  exch def
	y0 height 4 div neg lt		% base
	{
		x0 x1 eq {
			x1 height 4 div neg
		}
		{
			width 2 div neg height 4 div neg width 2 div height 4 div neg
			seginter not
			{
				x1 0 gt {width 2 div}{width 2 div neg} ifelse
				height 4 div neg
			} if
		} ifelse
	}
	{
		%take one side or the other
		x1 0 gt {width 2 div}{width 2 div neg} ifelse	
		height 4 div neg					
		0 height 2 div			% the apex vertex
		seginter not
		{0 height 2 div} if		% return apex if it missed
	} ifelse
} bind def

/Circle {
	/y exch def
	/x exch def
	/nodename exch def
	currentpoint 2 copy 2 copy
	newpath
	moveto
	/rad x y lt {x} {y} ifelse 2 div def
	rad 0 rmoveto
	rad 0 360 arc stroke
	moveto
	nodename x .85 mul y .85 mul daglabel
} bind def

/Circle_clip {
	Ellipse_clip
} bind def

/Doublecircle {
	/height exch def
	/width exch def
	/nodename exch def
	currentpoint 2 copy 2 copy 2 copy
	newpath
	moveto
	width height lt {width} {height} ifelse
	2 div /rad exch def
	rad 0 rmoveto
	rad 0 360 arc stroke
	rad .9 mul 0 360 arc stroke
	moveto
	nodename width .85 mul height .85 mul daglabel
} bind def

/Doublecircle_clip {
	Circle_clip
} bind def

/Ellipse {
	/height exch def
	/width exch def
	/nodename exch def
	currentpoint			% save for label
	% distort user space
	gsave
		currentpoint translate
		0 0 moveto
		matrix currentmatrix		% save it
		width height div 1 scale	% scale in x
		height 2 div 0 rmoveto
		newpath 0 0 height 2 div 0 360 arc
		setmatrix					% restore
		stroke
	grestore
	moveto nodename width .9 mul height .9 mul daglabel
} bind def

/Ellipse_clip {
	/y1 exch def
	/x1 exch def
	/y0 exch def
	/x0 exch def
	2 div /ry exch def
	2 div /rx exch def
	x0 x1 eq 
	{	% degenerate case
		x1 y1
	} 
	{	% normal case
		{
			/gotanswer false def
			/m y1 y0 sub x1 x0 sub div def	% m = (y1 - y0)/(x1 - x0);
			/b y0 x0 m mul sub def		% b = y0 - m * x0
			% aa = 1/(rx*rx)+ (m*m)/(ry*ry);
			/aa 1 rx rx mul div m m mul ry ry mul div add def
			% bb = (2*m*b)/(ry*ry);
			/bb 2 m b mul mul ry ry mul div def 
			% cc = (b*b)/(ry*ry) - 1;
			/cc b b mul ry ry mul div 1 sub def
			m 0 eq {
				/s0 rx def
				/s1 rx neg def
				/gotanswer true def
			}
			{
				% t = b^2 - 4ac
				/t bb bb mul 4 aa cc mul mul sub def
				t 0 lt {
					x1 y1
					exit
				}
				{
					/s0 bb neg t sqrt add 2 aa mul div def
					/s1 bb neg t sqrt sub 2 aa mul div def
					/gotanswer true def
				} ifelse
			} ifelse
			gotanswer {
				% by here, s0 and s1 are set.
				s0 x0 sub abs s1 x0 sub abs le {s0} {s1} ifelse
				dup m mul b add
				exit
			} if
		} loop
	} ifelse
} bind def

/white		[0 0 1]	def
/black		[1 1 0]	def
/red		[0 1 1]	def
/green		[.333 1 1]	def
/blue		[.667 1 1]	def
/yellow		[.167 1 1]	def
/magenta	[.833 1 1]	def
/cyan		[.500 1 1]	def
save
/DagDict 200 dict def
DagDict begin
/arrowlength 7 def
/arrowwidth arrowlength 2 div def
/node-font-family /Courier def
/edge-font-family /Courier def
save
35 35 moveto 488 0 rlineto 0 200 rlineto -488 0 rlineto closepath clip newpath
36 36 translate
14 node-font-family set_font
27 72 moveto
() 54 36 Plaintext
108 18 moveto
(16) 36 36 Square
108 72 moveto
(10) 36 36 Square
108 126 moveto
(6) 36 36 Square
108 180 moveto
(3) 36 36 Square
180 180 moveto
(2) 36 36 Diamond
252 126 moveto
(3) 36 36 Diamond
324 72 moveto
(5) 36 36 Diamond
396 18 moveto
(7) 36 36 Diamond
180 126 moveto
(2) 36 36 Circle
180 72 moveto
(2) 36 36 Circle
180 18 moveto
(2) 36 36 Circle
252 72 moveto
(3) 36 36 Circle
252 18 moveto
(3) 36 36 Circle
324 18 moveto
(5) 36 36 Circle
468 18 moveto
() 36 36 Plaintext
[] 0 setdash
14 edge-font-family set_font
newpath  36 36 54 0 18 0 Square_clip
18 add exch 108 add exch
moveto
 144 18 lineto
 36 36 -54 0 -18 0 Circle_clip
18 add exch 180 add exch
lineto currentpoint stroke moveto
144 18 makearrow
stroke
144 25 moveto (16) 14 14 -0.50 dagalignedlabel
newpath  36 36 54 0 18 0 Square_clip
72 add exch 108 add exch
moveto
 144 72 lineto
 36 36 -54 0 -18 0 Circle_clip
72 add exch 180 add exch
lineto currentpoint stroke moveto
144 72 makearrow
stroke
144 79 moveto (10) 14 14 -0.50 dagalignedlabel
newpath  36 36 54 0 18 0 Square_clip
126 add exch 108 add exch
moveto
 144 126 lineto
 36 36 -54 0 -18 0 Circle_clip
126 add exch 180 add exch
lineto currentpoint stroke moveto
144 126 makearrow
stroke
144 133 moveto (6) 7 14 -0.50 dagalignedlabel
newpath  36 36 54 0 18 0 Square_clip
180 add exch 108 add exch
moveto
 144 180 lineto
 36 36 -54 0 -18 0 Diamond_clip
180 add exch 180 add exch
lineto currentpoint stroke moveto
144 180 makearrow
stroke
144 187 moveto (3) 7 14 -0.50 dagalignedlabel
newpath  36 36 54 0 18 0 Circle_clip
126 add exch 180 add exch
moveto
 216 126 lineto
 36 36 -54 0 -18 0 Diamond_clip
126 add exch 252 add exch
lineto currentpoint stroke moveto
216 126 makearrow
stroke
216 133 moveto (5) 7 14 -0.50 dagalignedlabel
newpath  36 36 54 0 18 0 Circle_clip
72 add exch 180 add exch
moveto
 216 72 lineto
 36 36 -54 0 -18 0 Circle_clip
72 add exch 252 add exch
lineto currentpoint stroke moveto
216 72 makearrow
stroke
216 79 moveto (9) 7 14 -0.50 dagalignedlabel
newpath  36 36 54 0 18 0 Circle_clip
18 add exch 180 add exch
moveto
 216 18 lineto
 36 36 -54 0 -18 0 Circle_clip
18 add exch 252 add exch
lineto currentpoint stroke moveto
216 18 makearrow
stroke
216 25 moveto (15) 14 14 -0.50 dagalignedlabel
newpath  36 36 54 0 18 0 Circle_clip
72 add exch 252 add exch
moveto
 288 72 lineto
 36 36 -54 0 -18 0 Diamond_clip
72 add exch 324 add exch
lineto currentpoint stroke moveto
288 72 makearrow
stroke
288 79 moveto (7) 7 14 -0.50 dagalignedlabel
newpath  36 36 54 0 18 0 Circle_clip
18 add exch 252 add exch
moveto
 288 18 lineto
 36 36 -54 0 -18 0 Circle_clip
18 add exch 324 add exch
lineto currentpoint stroke moveto
288 18 makearrow
stroke
288 25 moveto (13) 14 14 -0.50 dagalignedlabel
newpath  36 36 54 0 18 0 Circle_clip
18 add exch 324 add exch
moveto
 360 18 lineto
 36 36 -54 0 -18 0 Diamond_clip
18 add exch 396 add exch
lineto currentpoint stroke moveto
360 18 makearrow
stroke
360 25 moveto (11) 14 14 -0.50 dagalignedlabel
showpage
restore
end
restore
%%EndDocument
 @endspecial 190 1064 a(The)14 b Fp(counter)d Fu(thread)i(is)f(represented)h
(as)h(a)f(square)g(labeled)g(by)f(the)h(current)f(counter)g(v)o(alue.)23
b(The)13 b(\256lters)g(are)g(circles)190 1124 y(labeled)f(by)f(their)g(prime)
h(number)n(,)h(and)f(the)f Fp(head)g Fu(is)h(represented)g(by)f(a)h(diamond)g
(labeled)f(with)g(the)h(ne)o(xt)f(prime.)20 b(The)190 1183
y(numbers)13 b(labeling)f(the)g(arro)o(ws)h(between)g(the)g(threads)f(are)i
(the)e(v)o(alues)h(that)f(the)h(threads)g(on)f(the)h(left)f(are)h(of)o
(fering)f(the)190 1243 y(threads)f(on)f(the)g(right.)253 1324
y(Note)f(that)g(in)g(this)g(e)o(xample)h(there)g(is)f(no)g(mechanism)i(for)e
(capturing)g(an)g(intermediate)h(v)o(alue)f(or)g(state)h(of)f(the)h(stream)
190 1383 y(\(the)g(way)g(one)h(can)g(do)f(with)f(a)i(lazy)f(in\256nite)f
(list\).)190 1543 y Fm(1.5)58 b(First-class)14 b(synchr)o(onous)g(operations)
190 1666 y Fu(Thread)d(creation)f(and)g(message)h(passing)f(pro)o(vide)f(a)i
(base)g(for)e(concurrent)h(programming,)f(b)o(ut)g(we)i(need)f(more)h(to)e
(write)190 1726 y(real)15 b(applications.)26 b(It)13 b(is)i(necessary)g(for)f
(threads)g(to)g(be)g(able)h(to)e(manage)j(communication)d(with)h(multiple)e
(partners.)190 1786 y(One)k(common)h(way)e(to)g(pro)o(vide)g(this)g(ability)f
(is)i(the)f Fn(select)i Fu(operation,)f(which)f(allo)o(ws)h(a)g(thread)f(to)h
(of)o(fer)f(multiple)190 1846 y(communications.)22 b(The)13
b(\256rst)f(communication)g(that)g(is)g(matched)i(is)e(selected.)23
b(If)12 b(more)h(than)f(one)h(communication)f(is)190 1906 y(matched,)h(then)e
(a)g(non-deterministic)e(choice)j(is)f(made.)19 b Fr(CML)11
b Fu(pro)o(vides)g(the)g(select)g(mechanism)i(as)e(part)g(of)g(the)g(more)190
1965 y(general)g(mechanism)g(of)f Fn(\256rst-class)g(sync)o(hr)n(onous)g
(oper)o(ations)p Fu(.)253 2046 y(The)h(basic)g(idea)g(is)g(to)f(treat)g
(synchronous)g(operations,)g(such)h(as)g(channel)g(I/O,)g(as)g(v)o(alues.)17
b(These)12 b(v)o(alues)f(may)g(then)190 2106 y(be)h(combined)e(with)g(other)g
(v)o(alues)i(to)e(form)h(ne)o(w)g(synchronization)e(and)i(communication)f
(abstractions.)17 b(W)m(e)11 b(start)g(with)190 2165 y(a)g(ne)o(w)g(type)f
(constructor)253 2259 y Fh(type)18 b('a)h(event)190 2367 y
Fu(If)c(a)h(synchronous)d(operation)h(has)i(the)f(type)f Fq(\034)30
b Ft(!)24 b Fq(\034)1023 2352 y Fd(0)1035 2367 y Fu(,)16 b(then)f(the)g(e)o
(v)o(ent-v)o(alued)f(v)o(ersion)h(will)f(ha)o(v)o(e)i(the)f(type)f
Fq(\034)30 b Ft(!)190 2427 y Fq(\034)213 2412 y Fd(0)232 2427
y Fp(event)o Fu(.)15 b(F)o(or)c(e)o(xample,)g(the)f(basic)h(channel)g(I/O)e
(operations)h(are)h(b)o(uilt)d(by:)253 2521 y Fh(val)18 b(receive)37
b(:)19 b('a)g(chan)f(->)h('a)f(event)253 2566 y(val)g(transmit)f(:)i(\('a)f
(chan)g(*)i('a\))e(->)h(unit)f(event)190 2674 y Fu(T)m(o)11
b(synchronize)f(on)f(an)i(e)o(v)o(ent)g(v)o(alue,)f(we)h(ha)o(v)o(e)g(the)f
(function)1080 2799 y(8)p eop
%%Page: 9 15
9 14 bop 95 82 a Fh(val)18 b(sync)g(:)i('a)f(event)e(->)i('a)33
185 y Fu(W)m(e)9 b(can)h(dra)o(w)g(an)g(analogy)f(with)f(\256rst-class)h
(function)f(v)o(alues)i(in)e(which)h(the)g Fp(event)g Fu(type)g(constructor)f
(plays)h(the)g(role)g(of)33 244 y Fp(->)h Fu(and)g Fp(sync)g
Fu(plays)g(the)g(role)g(of)g(function)f(application.)14 b(Returning)8
b(to)i(the)g(channel)h(I/O)e(operations,)h(we)h(can)g(rede\256ne)33
304 y(them)f(in)g(terms)g(of)g(e)o(v)o(ents)h(as:)95 392 y
Fh(val)18 b(accept)g(=)h(sync)f(o)h(receive)95 438 y(val)f(send)58
b(=)19 b(sync)f(o)h(transmit)95 561 y Fu(From)d(these)h(base)g(e)o(v)o(ent)f
(v)o(alues)g(we)h(can)g(b)o(uild)d(ne)o(w)j(v)o(alues)f(by)g
Fn(wr)o(apping)e Fu(them)i(with)f(post-synchronization)33 621
y(actions.)g(F)o(or)10 b(e)o(xample,)i(we)f(can)g(de\256ne)f(a)h(string)e(v)o
(alued)h(interface)g(to)g(a)h(boolean)f(v)o(alued)g(channel,)g
Fp(ch)p Fu(,)h(by)95 709 y Fh(wrap)18 b(\()134 755 y(receive)f(ch,)134
801 y(fn)i(true)f(=>)h("yes")f(|)h(false)e(=>)i("no"\))33 903
y Fu(Synchronizing)11 b(on)i(this)f(v)o(alue)h(will)f(read)h(a)h(v)o(alue)f
(from)g Fp(ch)g Fu(and)g(map)h(it)e(to)h(either)f Fp("yes")g
Fu(or)h Fp("no")p Fu(.)23 b(As)14 b(one)f(might)33 963 y(e)o(xpect,)e(the)f
Fp(wrap)g Fu(function)f(has)h(the)g(type)95 1051 y Fh(val)18
b(wrap)g(:)i(\('a)e(event)g(*)h(\('a)f(->)h('b\)\))f(->)h('b)g(event)95
1174 y Fu(A)10 b(wrapper)g(function)f(may)h(also)g(contain)f(synchronous)g
(operations.)15 b(F)o(or)10 b(e)o(xample,)h(a)g(v)o(ery)f(common)g(paradigm)g
(in)33 1234 y(concurrent)f(programs)h(is)g(a)h(request/result)d(e)o(xchange)k
(\(or)d Fn(r)n(emote)i(pr)n(ocedur)n(e)g(call)f Fu(\(RPC\)\))f(with)g(a)h
(serv)o(er)h(thread.)k(The)33 1294 y(client)9 b(side)i(of)e(this)h(e)o
(xchange)h(can)g(be)g(wrapped)f(up)g(into)f(a)i(single)e(synchronous)h(e)o(v)
o(ent:)95 1382 y Fh(wrap\(tran)o(smi)o(t)17 b(reqCh,)g(fn)i(\(\))f(=>)h
(accept)f(resCh\))33 1484 y Fu(where)12 b Fp(reqCh)f Fu(and)h
Fp(resCh)f Fu(are)h(the)g(request)g(and)g(result)f(channels,)i(respecti)o(v)o
(ely)f(\(section)f(1.8)h(discusses)g(these)h(kinds)33 1544
y(of)d(protocols)e(in)i(greater)h(detail\).)95 1625 y(The)d(primiti)o(v)o(es)
e(that)h(we)g(ha)o(v)o(e)i(e)o(xamined)f(so)f(far)g(are)h(suf)o(\256cient)f
(for)g(a)h(small)f(e)o(xample)i(of)e(b)o(uilding)t(ne)o(w)h(abstractions.)33
1724 y Fr(Example)h(1.4)h(\(Futur)o(es\))33 1805 y Fu(A)i Fr(Multi-lisp)f
Fn(futur)n(e)h Fu(is)g(the)g(parallel)g(e)o(v)o(aluation)f(of)h(an)h(e)o
(xpression)1072 1792 y Fo([Hal85)o(])1162 1805 y Fu(.)22 b(The)13
b(result)e(is)i(acquired)f(by)g Fn(touc)o(hing)f Fu(the)33
1865 y(future;)e(the)h(touching)f(thread)h(may)h(ha)o(v)o(e)g(to)f(wait)f
(for)h(the)g(future)g(computation)f(to)h(complete.)15 b(Since)c(touching)e(a)
i(future)33 1924 y(is)f(a)h(synchronous)e(operation,)g(we)i(will)e(represent)
i(futures)e(as)i(e)o(v)o(ents.)16 b(The)11 b Fp(future)e Fu(operation)g(has)i
(the)f(type:)95 2013 y Fh(val)18 b(future)g(:)h(\('a)f(->)h('2b\))f(->)h('a)g
(->)g('2b)f(event)33 2115 y Fu(and)11 b Fp(sync)f Fu(is)h(the)g(touch)g
(operator)n(.)17 b(The)12 b(implementation)e(of)h Fp(future)f
Fu(is)h(straight-forward:)i(we)f(spa)o(wn)g(a)f(ne)o(w)h(thread)33
2175 y(to)d(e)o(v)o(aluate)i(the)f(application)f(and)h(create)i(a)e(channel)h
(for)f(reporting)e(the)i(result.)95 2263 y Fh(fun)18 b(future)g(f)h(x)g(=)g
(let)213 2309 y(datatype)d('a)j(msg_t)f(=)h(RESULT)e(of)i('a)g(|)g(EXN)g(of)f
(exn)213 2355 y(val)g(resCh)g(=)h(channel\(\))213 2400 y(fun)f(repeater)f(x)i
(=)g(\(send\(resC)o(h,)d(x\);)i(repeater)f(x\))213 2446 y(in)252
2492 y(spawn)h(\(fn)g(\(\))h(=>)g(repeater\()o(RE)o(SUL)o(T\()o(f)e(x\))i
(handle)e(ex)i(=>)g(EXN)f(ex\)\);)252 2537 y(wrap)g(\()291
2583 y(receive)f(resCh,)291 2628 y(fn)i(\(RESULT)e(x\))i(=>)f(x)i(|)f(\(EXN)f
(ex\))g(=>)h(raise)f(ex\))213 2674 y(end)922 2799 y Fu(9)p
eop
%%Page: 10 16
10 15 bop 190 82 a Fu(Since)11 b(the)e(e)o(v)o(aluation)g(of)g(a)i(future)e
(might)f(result)h(in)h(a)g(raised)g(e)o(xception,)g(the)g(result)f(channel)h
(\()p Fp(resCh)p Fu(\))e(can)j(carry)f(either)190 142 y(the)g(result,)f(or)g
(an)h(e)o(xception.)15 b(A)10 b(future)e(v)o(alue)i(may)g(be)g(touched)f(se)o
(v)o(eral)h(times,)g(so)g(we)g(use)g(the)f(tail-recursi)o(v)o(e)g(function)
190 202 y Fp(repeater)i Fu(to)h(repeatedly)g(send)h(the)f(result)g(\(or)g(e)o
(xception\))g(message)i(on)e(the)g(result)g(channel.)1626 187
y Fo(5)1665 202 y Fu(This)g(might)f(seem)j(to)190 262 y(pose)f(a)g(problem)f
(with)f(resource)i(reclamation,)h(b)o(ut)e(if)f(the)i(future)e(e)o(v)o(ent)i
(v)o(alue)g(becomes)g(garbage,)h(then)e(the)g(garbage)190 321
y(collector)e(will)e(also)i(reclaim)h(the)f(channel)g(and)g(thread.)15
b(In)10 b(general,)h(an)o(y)f(process)h(that)e(communicates)i(in\256nitely)d
(often)190 381 y(will)15 b(be)h(garbage)g(collected)f(if)g(it)g(becomes)i
(disconnected)f(from)f(the)h(rest)g(of)f(the)g(system.)1592
366 y Fo(6)1641 381 y Fu(This)h(is)f(an)h(important)190 441
y(property)m(,)10 b(which)g(we)h(often)e(e)o(xploit.)253 521
y(The)i(e)o(v)o(ent-v)o(alue)g(produced)g(by)f(the)h Fp(future)f
Fu(abstraction)g(may)h(cause)i(an)e(e)o(xception)g(to)f(be)h(raised)g(when)g
(a)h(thread)190 581 y(synchronizes)e(on)g(it.)15 b(W)m(e)c(can)f(hide)g(this)
g(beha)o(vior)g(by)f(wrapping)h(an)g(e)o(xception)g(handler)g(around)g(the)g
(e)o(v)o(ent:)292 681 y Fh(\(*)19 b(myFuture)d(:)j(\('a)g(->)g('2b\))f(->)h
('a)g(->)f('2b)h(option)e(event)h(*\))331 726 y(fun)h(myFuture)d(f)j(x)h(=)f
(wrapHandl)o(er)d(\()449 772 y(wrap)i(\(future)f(f)i(x,)g(SOME\),)449
818 y(fn)g(_)g(=>)g(NONE\))190 931 y Fu(This)d(ne)o(w)f(operation)f(will)g
(return)h Fp(NONE)f Fu(in)h(the)g(situation)e(where)j(an)g(e)o(xception)f
(was)g(raised.)31 b(The)16 b Fp(wrapHandler)190 991 y Fu(function)9
b(has)i(the)f(type)331 1091 y Fh(val)19 b(wrapHand)o(ler)d(:)j('a)g(event)f
(*)h(\(exn)f(->)h('a\))f(->)h('a)g(event)190 1205 y Fu(If)9
b(synchronizing)f(on)h(the)g(\256rst)g(ar)o(gument)g(raises)h(an)g(e)o
(xception,)f(then)g(the)g(e)o(xception)g(will)f(be)i(caught)f(and)g(passed)h
(to)f(the)190 1264 y(second)i(ar)o(gument.)253 1345 y(The)k(future)f
(abstraction)g(in)h(Example)g(1.4)g(has)g(the)g(same)h(status)f(as)h(the)e(b)
o(uilt-in)f(abstractions,)j(since)f(it)f(has)h(an)190 1405
y(e)o(v)o(ent-v)o(alued)h(interface.)34 b(The)17 b(synchronous)e(character)i
(of)f(the)g(abstraction)g(has)h(not)e(been)i(hidden)e(\(although)g(the)190
1464 y(details)9 b(of)g(the)f(implementation)g(ha)o(v)o(e)i(been\).)15
b(F)o(or)9 b(the)g(primiti)o(v)o(es)f(we)h(ha)o(v)o(e)h(seen)g(so)f(far)n(,)h
(we)g(could)e(ha)o(v)o(e)i(used)f(function)190 1524 y(abstraction,)14
b(instead)f(of)g(e)o(v)o(ents,)i(to)e(produce)g(the)g(same)i(results.)24
b(But)12 b(with)h(selecti)o(v)o(e)h(communication,)f(we)h(need)g(to)190
1584 y(ha)o(v)o(e)e(the)e(synchronous)f(character)i(of)f(our)g(abstractions)g
(e)o(xposed)h(\261)f(function)e(abstraction)i(hides)g(too)f(much.)253
1665 y Fr(CML)i Fu(pro)o(vides)f(selecti)o(v)o(e)i(communication)f(via)g(the)
g Fp(choose)f Fu(combinator)n(,)h(which)g(b)o(uilds)f(an)h(e)o(v)o(ent)h(v)o
(alue)f(that)g(is)190 1724 y(the)f(\252)p Fn(non-deterministic)f(or)p
Fu(\272)i(of)f(a)h(homogeneously)e(typed)h(list)f(of)h(e)o(v)o(ent)g(v)o
(alues.)16 b(As)10 b(e)o(xpected,)i Fp(choose)d Fu(has)i(the)f(type)253
1824 y Fh(val)18 b(choose)f(:)j('a)e(event)g(list)g(->)h('a)g(event)190
1938 y Fu(As)9 b(we)f(sa)o(w)i(in)d(Example)i(1.1,)g(there)f(is)g
(non-determinism)f(in)h(the)g(order)g(in)f(which)h(parallel)g(actions)g
(occur;)h(with)e Fp(choose)190 1997 y Fu(there)k(is)f(also)g(non-determinism)
f(in)h(which)g(actions)g(occur)n(.)190 2103 y Fr(Example)g(1.5)190
2183 y Fu(T)m(o)h(make)f(this)g(concrete,)h(consider)f(the)g(follo)o(wing)e
(v)o(ariation)h(on)h(Example)h(1.1:)p 190 2219 720 2 v 236
2247 a Fl(5)250 2259 y Fk(A)d(better)g(way)g(to)g(do)f(this)i(is)f(to)g(use)g
(a)g Ff(write-once)f Fk(condition)g(v)o(ariable)g(\(see)h(Chapter)g(4\).)236
2288 y Fl(6)250 2299 y Fk(There)g(are)g(a)g(couple)f(of)h(technical)f
(exceptions)f(to)i(this,)g(b)o(ut)g(they)f(tend)h(not)g(to)g(arise)g(in)g
(practice.)1070 2799 y Fu(10)p eop
%%Page: 11 17
11 16 bop 95 82 a Fh(fun)18 b(simple_comm)o(2)e(\(\))j(=)g(let)213
128 y(val)f(ch1)h(=)g(channel\(\))d(and)i(ch2)h(=)g(channel\(\))213
174 y(val)f(pr)h(=)g(CIO.print)213 219 y(in)252 265 y(pr)g("hi-0\\n";)252
310 y(spawn)f(\(fn)g(\(\))h(=>)g(\(pr)f("hi-1\\n";)36 b(send\(ch1,)16
b(17\);)38 b(pr)19 b("bye-1\\n)o("\)\))o(;)252 356 y(spawn)f(\(fn)g(\(\))h
(=>)g(\(pr)f("hi-2\\n";)36 b(send\(ch2,)16 b(37\);)38 b(pr)19
b("bye-2\\n)o("\)\))o(;)252 402 y(sync)f(\(choose)f([)291 447
y(wrap)h(\(receive)f(ch1,)h(fn)h(_)g(=>)g(pr)f("bye-0.1\\n")o(\),)291
493 y(wrap)g(\(receive)f(ch2,)h(fn)h(_)g(=>)g(pr)f("bye-0.2\\n")o(\))252
539 y(]\))213 584 y(end)33 698 y Fu(The)9 b(observ)o(ational)f(beha)o(vior)h
(of)g(this)f(program)h(\256ts)g(one)g(of)g(two)f(graphs,)h(depending)g(on)f
(the)h(non-deterministic)e(choice)33 758 y(made)k(by)f(the)g(parent)g
(thread:)247 1290 y @beginspecial 35 @llx 35 @lly 181 @urx
148 @ury 1440 @rwi @setspecial
%%BeginDocument: simple-comm2a.ps
/coord-font-family /Times-Roman def
/node-font-family /Times-Roman def
/edge-font-family /Times-Roman def
/coordfont coord-font-family findfont 6 scalefont def

/set_font {
	findfont exch
	dup /dag_font_size exch def
	dup .8 mul /hack_font_size exch def
	scalefont setfont
} def

/setdagcolor {aload pop sethsbcolor} bind def

/dagalignedlabel {		% alignfactor height width name
	/alignfactor exch def
	/height exch def
	/width exch def
	/nodename exch def
	gsave
		currentpoint newpath moveto
		nodename stringwidth pop
		alignfactor mul hack_font_size  -.5 mul rmoveto
		nodename show
	grestore
} bind def

/daglabel {
	-.5 dagalignedlabel
} bind def

/midpoint {
	exch 4 -1 roll add 2 div
	3 1 roll add 2 div
} bind def

/arrowhead {
	gsave
	rotate
	currentpoint
	newpath
		moveto
		arrowlength arrowwidth 2 div rlineto
		0 arrowwidth neg rlineto
	closepath fill
	grestore
} bind def

/makearrow {
	currentpoint exch pop sub exch currentpoint pop sub atan
	arrowhead
} bind def


/Box {
	/height exch def
	/width exch def
	/nodename exch def
	currentpoint 2 copy
	newpath
		moveto
		width -2 div
		height -2 div
		rmoveto
		width 0 rlineto
		0 height rlineto
		width neg 0 rlineto
	closepath
	stroke
	moveto 
	nodename width .9 mul height .9 mul daglabel
} bind def

/Box_clip {	% height width x0 y0 x1 y1 -> x1 y1
	6 2 roll
	pop pop pop pop
} bind def

/Square {
	2 copy
	gt {exch pop dup} {pop dup} ifelse
	Box
} bind def

/Square_clip {
	Box_clip
} bind def

/Plaintext {
	daglabel
} bind def

/Plaintext_clip {
	Box_clip
} bind def


/Diamond {
	/height exch def
	/width exch def
	/nodename exch def
	/hh height 2 div def
	/hw width 2 div def
	currentpoint 2 copy
	newpath
		moveto
		0 hh neg rmoveto
		hw hh rlineto
		hw neg hh rlineto
		hw neg hh neg rlineto
	closepath
	stroke
	moveto 
	nodename width .9 mul height .9 mul daglabel
} bind def

/between {
	sub 3 1 roll sub mul 0 ge
} bind def

/seginter { % x2 y2 x3 y3 -> false  OR  xinter yinter true
	% use x0 y0 x1 y1 of current dict
	/y3 exch def
	/x3 exch def
	/y2 exch def
	/x2 exch def
	x0 x1 ne x2 x3 ne or
	{
		x2 x3 eq {	/x2 x0 /x0 x2 def def
				/y2 y0 /y0 y2 def def
				/x1 x3 /x3 x1 def def
				/y1 y3 /y3 y1 def def
		} if

		x0 x1 eq {
			/x x0 def false
		} 
		{
			/m0 y1 y0 sub x1 x0 sub div def
			/b0 y0 m0 x0 mul sub def
			/m1 y3 y2 sub x3 x2 sub div def
			/b1 y2 m1 x2 mul sub def
			m1 m0 eq {
				b0 b1 ne {false} 
				{	/l0lowx x0 x1 min def
				 	/l0highx x0 x1 max def
					/l1lowx x2 x3 min def
					/l1highx x2 x3 max def
					l0lowx l1lowx dup l0highx between
					{/x l1lowx def true}
					{
						l0lowx l1highx dup l0highx between
						{/x l1highx def true}
						{
							l1lowx l0lowx dup l1highx between
							{/x l0lowx def true}
							{false} ifelse
						} ifelse
					} ifelse
				} ifelse
			}
			{
				/x b1 b0 sub m0 m1 sub div def true
			} ifelse
		} ifelse
		{
			x2 x x x3 between
			{
				y2 m1 x mul b1 add dup y3 between
				{
					x
					m1 x mul b1 add 
					true
				}
				{
					false
				} ifelse
			}
			{ false } ifelse
		}
		{false} ifelse
	}
	{false} ifelse
} bind def

/Diamond_clip {
	/y1 exch def
	/x1 exch def
	/y0 exch def
	/x0 exch def
	2 div /height2 exch def
	2 div /width2  exch def
	x0 x1 eq y0 y1 eq and {x1 y1} {
		x0 0 ge y0 0 ge and {
			width2 0 0 height2 seginter
		}
		{
			x0 0 le y0 0 ge and {
				0 height2 width2 neg 0 seginter
			}
			{
				x0 0 le y0 0 le and {
					width2 neg 0 0 height2 neg seginter
				}
				{
					0 height2 neg width2 0 seginter
				} ifelse
			} ifelse
		} ifelse
		not {x1 y1} if
	} ifelse
} bind def

/Triangle {
	/y exch def
	/x exch def
	/nodename exch def
	/x2 x 2 div def
	/y2 y 2 div def
	currentpoint 
	x2 neg y2 2 div neg rmoveto x 0 rlineto x2 neg y 3 mul 4 div rlineto
	closepath stroke
	moveto nodename x y daglabel
} bind def

/Triangle_clip {
	/y1 exch def
	/x1 exch def
	/y0 exch def
	/x0 exch def
	/height exch def
	/width  exch def
	y0 height 4 div neg lt		% base
	{
		x0 x1 eq {
			x1 height 4 div neg
		}
		{
			width 2 div neg height 4 div neg width 2 div height 4 div neg
			seginter not
			{
				x1 0 gt {width 2 div}{width 2 div neg} ifelse
				height 4 div neg
			} if
		} ifelse
	}
	{
		%take one side or the other
		x1 0 gt {width 2 div}{width 2 div neg} ifelse	
		height 4 div neg					
		0 height 2 div			% the apex vertex
		seginter not
		{0 height 2 div} if		% return apex if it missed
	} ifelse
} bind def

/Circle {
	/y exch def
	/x exch def
	/nodename exch def
	currentpoint 2 copy 2 copy
	newpath
	moveto
	/rad x y lt {x} {y} ifelse 2 div def
	rad 0 rmoveto
	rad 0 360 arc stroke
	moveto
	nodename x .85 mul y .85 mul daglabel
} bind def

/Circle_clip {
	Ellipse_clip
} bind def

/Doublecircle {
	/height exch def
	/width exch def
	/nodename exch def
	currentpoint 2 copy 2 copy 2 copy
	newpath
	moveto
	width height lt {width} {height} ifelse
	2 div /rad exch def
	rad 0 rmoveto
	rad 0 360 arc stroke
	rad .9 mul 0 360 arc stroke
	moveto
	nodename width .85 mul height .85 mul daglabel
} bind def

/Doublecircle_clip {
	Circle_clip
} bind def

/Ellipse {
	/height exch def
	/width exch def
	/nodename exch def
	currentpoint			% save for label
	% distort user space
	gsave
		currentpoint translate
		0 0 moveto
		matrix currentmatrix		% save it
		width height div 1 scale	% scale in x
		height 2 div 0 rmoveto
		newpath 0 0 height 2 div 0 360 arc
		setmatrix					% restore
		stroke
	grestore
	moveto nodename width .9 mul height .9 mul daglabel
} bind def

/Ellipse_clip {
	/y1 exch def
	/x1 exch def
	/y0 exch def
	/x0 exch def
	2 div /ry exch def
	2 div /rx exch def
	x0 x1 eq 
	{	% degenerate case
		x1 y1
	} 
	{	% normal case
		{
			/gotanswer false def
			/m y1 y0 sub x1 x0 sub div def	% m = (y1 - y0)/(x1 - x0);
			/b y0 x0 m mul sub def		% b = y0 - m * x0
			% aa = 1/(rx*rx)+ (m*m)/(ry*ry);
			/aa 1 rx rx mul div m m mul ry ry mul div add def
			% bb = (2*m*b)/(ry*ry);
			/bb 2 m b mul mul ry ry mul div def 
			% cc = (b*b)/(ry*ry) - 1;
			/cc b b mul ry ry mul div 1 sub def
			m 0 eq {
				/s0 rx def
				/s1 rx neg def
				/gotanswer true def
			}
			{
				% t = b^2 - 4ac
				/t bb bb mul 4 aa cc mul mul sub def
				t 0 lt {
					x1 y1
					exit
				}
				{
					/s0 bb neg t sqrt add 2 aa mul div def
					/s1 bb neg t sqrt sub 2 aa mul div def
					/gotanswer true def
				} ifelse
			} ifelse
			gotanswer {
				% by here, s0 and s1 are set.
				s0 x0 sub abs s1 x0 sub abs le {s0} {s1} ifelse
				dup m mul b add
				exit
			} if
		} loop
	} ifelse
} bind def

/white		[0 0 1]	def
/black		[1 1 0]	def
/red		[0 1 1]	def
/green		[.333 1 1]	def
/blue		[.667 1 1]	def
/yellow		[.167 1 1]	def
/magenta	[.833 1 1]	def
/cyan		[.500 1 1]	def
save
/DagDict 200 dict def
DagDict begin
0.615 0.615 scale
/arrowlength 7 def
/arrowwidth arrowlength 2 div def
/node-font-family /Courier def
save
57 57 moveto 237 0 rlineto 0 183 rlineto -237 0 rlineto closepath clip newpath
58 58 translate
14 node-font-family set_font
123 162 moveto
(hi-0) 54 36 Ellipse
33 90 moveto
(hi-1) 54 36 Ellipse
207 90 moveto
(hi-2) 54 36 Ellipse
33 18 moveto
(bye-1) 65 36 Ellipse
123 18 moveto
(bye-0.1) 79 36 Ellipse
207 18 moveto
() 54 36 Plaintext
[] 0 setdash
14 edge-font-family set_font
newpath  54 36 0 -126 0 -18 Ellipse_clip
162 add exch 123 add exch
moveto
 123 90 lineto
 79 36 0 126 0 18 Ellipse_clip
18 add exch 123 add exch
lineto currentpoint stroke moveto
123 90 makearrow
stroke
[9 9 idtransform abs ceiling exch abs ceiling exch] 0 setdash
newpath  54 36 -70 -54 -27 -16 Ellipse_clip
162 add exch 123 add exch
moveto
 74 127 lineto
 54 36 63 56 20 18 Ellipse_clip
90 add exch 33 add exch
lineto currentpoint stroke moveto
74 127 makearrow
stroke
newpath  54 36 65 -54 28 -18 Ellipse_clip
162 add exch 123 add exch
moveto
 169 126 lineto
 54 36 -56 54 -19 18 Ellipse_clip
90 add exch 207 add exch
lineto currentpoint stroke moveto
169 126 makearrow
stroke
[] 0 setdash
newpath  54 36 0 -54 0 -18 Ellipse_clip
90 add exch 33 add exch
moveto
 33 54 lineto
 65 36 0 54 0 18 Ellipse_clip
18 add exch 33 add exch
lineto currentpoint stroke moveto
33 54 makearrow
stroke
[1 6 idtransform abs ceiling exch abs ceiling exch] 0 setdash
newpath  54 36 70 -54 27 -16 Ellipse_clip
90 add exch 33 add exch
moveto
 81 55 lineto
 79 36 -63 56 -20 18 Ellipse_clip
18 add exch 123 add exch
lineto currentpoint stroke moveto
81 55 makearrow
stroke
showpage
restore
end
restore
%%EndDocument
 @endspecial 771 w @beginspecial 35 @llx 35 @lly 181 @urx 148
@ury 1440 @rwi @setspecial
%%BeginDocument: simple-comm2b.ps
/coord-font-family /Times-Roman def
/node-font-family /Times-Roman def
/edge-font-family /Times-Roman def
/coordfont coord-font-family findfont 6 scalefont def

/set_font {
	findfont exch
	dup /dag_font_size exch def
	dup .8 mul /hack_font_size exch def
	scalefont setfont
} def

/setdagcolor {aload pop sethsbcolor} bind def

/dagalignedlabel {		% alignfactor height width name
	/alignfactor exch def
	/height exch def
	/width exch def
	/nodename exch def
	gsave
		currentpoint newpath moveto
		nodename stringwidth pop
		alignfactor mul hack_font_size  -.5 mul rmoveto
		nodename show
	grestore
} bind def

/daglabel {
	-.5 dagalignedlabel
} bind def

/midpoint {
	exch 4 -1 roll add 2 div
	3 1 roll add 2 div
} bind def

/arrowhead {
	gsave
	rotate
	currentpoint
	newpath
		moveto
		arrowlength arrowwidth 2 div rlineto
		0 arrowwidth neg rlineto
	closepath fill
	grestore
} bind def

/makearrow {
	currentpoint exch pop sub exch currentpoint pop sub atan
	arrowhead
} bind def


/Box {
	/height exch def
	/width exch def
	/nodename exch def
	currentpoint 2 copy
	newpath
		moveto
		width -2 div
		height -2 div
		rmoveto
		width 0 rlineto
		0 height rlineto
		width neg 0 rlineto
	closepath
	stroke
	moveto 
	nodename width .9 mul height .9 mul daglabel
} bind def

/Box_clip {	% height width x0 y0 x1 y1 -> x1 y1
	6 2 roll
	pop pop pop pop
} bind def

/Square {
	2 copy
	gt {exch pop dup} {pop dup} ifelse
	Box
} bind def

/Square_clip {
	Box_clip
} bind def

/Plaintext {
	daglabel
} bind def

/Plaintext_clip {
	Box_clip
} bind def


/Diamond {
	/height exch def
	/width exch def
	/nodename exch def
	/hh height 2 div def
	/hw width 2 div def
	currentpoint 2 copy
	newpath
		moveto
		0 hh neg rmoveto
		hw hh rlineto
		hw neg hh rlineto
		hw neg hh neg rlineto
	closepath
	stroke
	moveto 
	nodename width .9 mul height .9 mul daglabel
} bind def

/between {
	sub 3 1 roll sub mul 0 ge
} bind def

/seginter { % x2 y2 x3 y3 -> false  OR  xinter yinter true
	% use x0 y0 x1 y1 of current dict
	/y3 exch def
	/x3 exch def
	/y2 exch def
	/x2 exch def
	x0 x1 ne x2 x3 ne or
	{
		x2 x3 eq {	/x2 x0 /x0 x2 def def
				/y2 y0 /y0 y2 def def
				/x1 x3 /x3 x1 def def
				/y1 y3 /y3 y1 def def
		} if

		x0 x1 eq {
			/x x0 def false
		} 
		{
			/m0 y1 y0 sub x1 x0 sub div def
			/b0 y0 m0 x0 mul sub def
			/m1 y3 y2 sub x3 x2 sub div def
			/b1 y2 m1 x2 mul sub def
			m1 m0 eq {
				b0 b1 ne {false} 
				{	/l0lowx x0 x1 min def
				 	/l0highx x0 x1 max def
					/l1lowx x2 x3 min def
					/l1highx x2 x3 max def
					l0lowx l1lowx dup l0highx between
					{/x l1lowx def true}
					{
						l0lowx l1highx dup l0highx between
						{/x l1highx def true}
						{
							l1lowx l0lowx dup l1highx between
							{/x l0lowx def true}
							{false} ifelse
						} ifelse
					} ifelse
				} ifelse
			}
			{
				/x b1 b0 sub m0 m1 sub div def true
			} ifelse
		} ifelse
		{
			x2 x x x3 between
			{
				y2 m1 x mul b1 add dup y3 between
				{
					x
					m1 x mul b1 add 
					true
				}
				{
					false
				} ifelse
			}
			{ false } ifelse
		}
		{false} ifelse
	}
	{false} ifelse
} bind def

/Diamond_clip {
	/y1 exch def
	/x1 exch def
	/y0 exch def
	/x0 exch def
	2 div /height2 exch def
	2 div /width2  exch def
	x0 x1 eq y0 y1 eq and {x1 y1} {
		x0 0 ge y0 0 ge and {
			width2 0 0 height2 seginter
		}
		{
			x0 0 le y0 0 ge and {
				0 height2 width2 neg 0 seginter
			}
			{
				x0 0 le y0 0 le and {
					width2 neg 0 0 height2 neg seginter
				}
				{
					0 height2 neg width2 0 seginter
				} ifelse
			} ifelse
		} ifelse
		not {x1 y1} if
	} ifelse
} bind def

/Triangle {
	/y exch def
	/x exch def
	/nodename exch def
	/x2 x 2 div def
	/y2 y 2 div def
	currentpoint 
	x2 neg y2 2 div neg rmoveto x 0 rlineto x2 neg y 3 mul 4 div rlineto
	closepath stroke
	moveto nodename x y daglabel
} bind def

/Triangle_clip {
	/y1 exch def
	/x1 exch def
	/y0 exch def
	/x0 exch def
	/height exch def
	/width  exch def
	y0 height 4 div neg lt		% base
	{
		x0 x1 eq {
			x1 height 4 div neg
		}
		{
			width 2 div neg height 4 div neg width 2 div height 4 div neg
			seginter not
			{
				x1 0 gt {width 2 div}{width 2 div neg} ifelse
				height 4 div neg
			} if
		} ifelse
	}
	{
		%take one side or the other
		x1 0 gt {width 2 div}{width 2 div neg} ifelse	
		height 4 div neg					
		0 height 2 div			% the apex vertex
		seginter not
		{0 height 2 div} if		% return apex if it missed
	} ifelse
} bind def

/Circle {
	/y exch def
	/x exch def
	/nodename exch def
	currentpoint 2 copy 2 copy
	newpath
	moveto
	/rad x y lt {x} {y} ifelse 2 div def
	rad 0 rmoveto
	rad 0 360 arc stroke
	moveto
	nodename x .85 mul y .85 mul daglabel
} bind def

/Circle_clip {
	Ellipse_clip
} bind def

/Doublecircle {
	/height exch def
	/width exch def
	/nodename exch def
	currentpoint 2 copy 2 copy 2 copy
	newpath
	moveto
	width height lt {width} {height} ifelse
	2 div /rad exch def
	rad 0 rmoveto
	rad 0 360 arc stroke
	rad .9 mul 0 360 arc stroke
	moveto
	nodename width .85 mul height .85 mul daglabel
} bind def

/Doublecircle_clip {
	Circle_clip
} bind def

/Ellipse {
	/height exch def
	/width exch def
	/nodename exch def
	currentpoint			% save for label
	% distort user space
	gsave
		currentpoint translate
		0 0 moveto
		matrix currentmatrix		% save it
		width height div 1 scale	% scale in x
		height 2 div 0 rmoveto
		newpath 0 0 height 2 div 0 360 arc
		setmatrix					% restore
		stroke
	grestore
	moveto nodename width .9 mul height .9 mul daglabel
} bind def

/Ellipse_clip {
	/y1 exch def
	/x1 exch def
	/y0 exch def
	/x0 exch def
	2 div /ry exch def
	2 div /rx exch def
	x0 x1 eq 
	{	% degenerate case
		x1 y1
	} 
	{	% normal case
		{
			/gotanswer false def
			/m y1 y0 sub x1 x0 sub div def	% m = (y1 - y0)/(x1 - x0);
			/b y0 x0 m mul sub def		% b = y0 - m * x0
			% aa = 1/(rx*rx)+ (m*m)/(ry*ry);
			/aa 1 rx rx mul div m m mul ry ry mul div add def
			% bb = (2*m*b)/(ry*ry);
			/bb 2 m b mul mul ry ry mul div def 
			% cc = (b*b)/(ry*ry) - 1;
			/cc b b mul ry ry mul div 1 sub def
			m 0 eq {
				/s0 rx def
				/s1 rx neg def
				/gotanswer true def
			}
			{
				% t = b^2 - 4ac
				/t bb bb mul 4 aa cc mul mul sub def
				t 0 lt {
					x1 y1
					exit
				}
				{
					/s0 bb neg t sqrt add 2 aa mul div def
					/s1 bb neg t sqrt sub 2 aa mul div def
					/gotanswer true def
				} ifelse
			} ifelse
			gotanswer {
				% by here, s0 and s1 are set.
				s0 x0 sub abs s1 x0 sub abs le {s0} {s1} ifelse
				dup m mul b add
				exit
			} if
		} loop
	} ifelse
} bind def

/white		[0 0 1]	def
/black		[1 1 0]	def
/red		[0 1 1]	def
/green		[.333 1 1]	def
/blue		[.667 1 1]	def
/yellow		[.167 1 1]	def
/magenta	[.833 1 1]	def
/cyan		[.500 1 1]	def
save
/DagDict 200 dict def
DagDict begin
0.615 0.615 scale
/arrowlength 7 def
/arrowwidth arrowlength 2 div def
/node-font-family /Courier def
save
57 57 moveto 237 0 rlineto 0 183 rlineto -237 0 rlineto closepath clip newpath
58 58 translate
14 node-font-family set_font
111 162 moveto
(hi-0) 54 36 Ellipse
27 90 moveto
(hi-1) 54 36 Ellipse
201 90 moveto
(hi-2) 54 36 Ellipse
111 18 moveto
(bye-0.2) 79 36 Ellipse
201 18 moveto
(bye-2) 65 36 Ellipse
27 18 moveto
() 54 36 Plaintext
[] 0 setdash
14 edge-font-family set_font
newpath  54 36 0 -126 0 -18 Ellipse_clip
162 add exch 111 add exch
moveto
 111 90 lineto
 79 36 0 126 0 18 Ellipse_clip
18 add exch 111 add exch
lineto currentpoint stroke moveto
111 90 makearrow
stroke
[9 9 idtransform abs ceiling exch abs ceiling exch] 0 setdash
newpath  54 36 -65 -54 -28 -18 Ellipse_clip
162 add exch 111 add exch
moveto
 64 126 lineto
 54 36 56 54 19 18 Ellipse_clip
90 add exch 27 add exch
lineto currentpoint stroke moveto
64 126 makearrow
stroke
newpath  54 36 70 -54 27 -16 Ellipse_clip
162 add exch 111 add exch
moveto
 159 127 lineto
 54 36 -63 56 -20 18 Ellipse_clip
90 add exch 201 add exch
lineto currentpoint stroke moveto
159 127 makearrow
stroke
[1 6 idtransform abs ceiling exch abs ceiling exch] 0 setdash
newpath  54 36 -70 -54 -27 -16 Ellipse_clip
90 add exch 201 add exch
moveto
 152 55 lineto
 79 36 63 56 20 18 Ellipse_clip
18 add exch 111 add exch
lineto currentpoint stroke moveto
152 55 makearrow
stroke
[] 0 setdash
newpath  54 36 0 -54 0 -18 Ellipse_clip
90 add exch 201 add exch
moveto
 201 54 lineto
 65 36 0 54 0 18 Ellipse_clip
18 add exch 201 add exch
lineto currentpoint stroke moveto
201 54 makearrow
stroke
showpage
restore
end
restore
%%EndDocument
 @endspecial 33 1403 a(This)i(e)o(xample)h(also)f(illustrates)f(a)i(v)o(ery)f
(common)g Fr(CML)h Fu(idiom:)k(that)11 b(of)h(synchronizing)f(on)g(a)i
(choice)g(of)e(e)o(v)o(ents.)22 b(T)m(o)33 1463 y(support)11
b(this)h(form,)i Fr(CML)e Fu(pro)o(vides)h(the)f Fp(select)g
Fu(operation)g(for)g(synchronizing)f(on)i(a)g(list)f(of)g(e)o(v)o(ent)h(v)o
(alues.)23 b(It)13 b(is)f(a)33 1523 y(deri)o(v)o(ed)e(form)g(with)f(the)h
(follo)o(wing)e(de\256nition:)95 1622 y Fh(val)18 b(select)g(=)h(sync)f(o)h
(choose)33 1817 y Fm(1.6)57 b(Mor)o(e)14 b(synchr)o(onous)h(operations)33
1940 y Fu(In)7 b(addition)e(to)i(channel)g(communication,)h(the)f(e)o(v)o
(ent)h(frame)o(work)f(supports)f(other)h(synchronous)f(conditions)g(in)g(a)i
(natural)33 2000 y(way)m(.)15 b(A)10 b(thread)h(can)g(synchronize)e(on)h
(another)g(threads)g(termination)f(using)h(the)g(function:)95
2099 y Fh(val)18 b(threadWait)e(:)j(thread_id)d(->)j(unit)f(event)33
2213 y Fu(This)11 b(mechanism)i(is)e(useful)g(for)g(when)h(a)g(serv)o(er)g
(needs)h(to)d(handle)i(the)f(case)i(of)e(premature)h(termination)e(by)i(one)f
(of)g(its)33 2273 y(clients.)33 2378 y Fr(Example)e(1.6)33
2459 y Fu(The)14 b Fp(threadWait)d Fu(e)o(v)o(ent)j(can)g(be)g(used)g(by)f
(serv)o(ers)i(that)d(need)i(to)f(be)h(noti\256ed)f(of)g(the)g(termination)f
(of)h(a)h(client.)25 b(F)o(or)33 2519 y(e)o(xample,)11 b(consider)f(a)h
Fn(token)f(server)i Fu(with)d(the)i(follo)o(wing)c(interface:)912
2799 y(11)p eop
%%Page: 12 18
12 17 bop 253 82 a Fh(signature)16 b(TOKEN_SER)o(VER)g(=)292
128 y(sig)331 174 y(structure)g(CML)j(:)g(CONCUR_ML)331 219
y(type)f(\('a,)g('b\))h(token)331 265 y(val)g(newToken)d(:)j(\('a)g(->)g
('b\))f(->)h(\('a,)f('b\))g(token)331 310 y(exception)e(NotTokenHo)o(lde)o(r)
331 356 y(val)j(getOpera)o(tio)o(n)e(:)i(\('a,)f('b\))g(token)g(->)h(\('a)f
(->)h('b\))331 402 y(val)g(releaseT)o(oke)o(n)e(:)i(\('a,)f('b\))g(token)g
(->)h(unit)331 447 y(val)g(acquireT)o(oke)o(n)e(:)i(\('a,)f('b\))g(token)g
(->)h(unit)f(CML.event)292 493 y(end)g(\(*)h(TOKEN_SERV)o(ER)d(*\))190
602 y Fu(This)d(serv)o(er)g(implements)g(a)g(facility)d(for)j(controlling)c
(access)15 b(to)d(an)h(operation.)21 b(Associated)12 b(with)g(the)g
(operation)g(is)g(a)190 662 y Fn(token)p Fu(.)j(While)9 b(multiple)e(threads)
i(may)h(ha)o(v)o(e)g(access)h(to)e(the)g(token)f(v)o(alue,)h(only)g(one)g
(thread)g(actually)f Fn(possesses)j Fu(it)d(at)h(an)o(y)190
721 y(gi)o(v)o(en)i(time,)h(and)f(only)f(the)h(possessor)g(may)h(do)f(the)f
(operation.)17 b(The)12 b(function)d Fp(newToken)h Fu(produces)h(a)h(ne)o(w)f
(token)f(for)190 781 y(controlling)g(access)k(to)e(a)h(gi)o(v)o(en)f
(operation.)20 b(Gi)o(v)o(en)12 b(a)h(token,)f(the)g(function)f
Fp(getOperation)f Fu(e)o(xtracts)j(the)f(associated)190 841
y(operation.)22 b(If)12 b(an)h(attempt)f(to)g(use)i(this)d(operation)h(is)g
(made)i(by)e(a)i(thread)e(other)g(than)g(the)h(current)f(token)g(holder)n(,)h
(then)190 901 y(the)e(e)o(xception)g Fp(NotTokenHolder)e Fu(will)h(be)h
(raised.)18 b(The)12 b(functions)e Fp(acquireToken)e Fu(and)k
Fp(releaseToken)c Fu(are)k(used)190 961 y(to)e(change)h(token)e(holders.)14
b(Note)c(that)f(a)i(thread)f(can)h(synchronize)e(on)h(recei)o(ving)g
(possession)f(of)h(the)g(token.)k(Figure)c(1.1)190 1020 y(contains)h(the)h
(implementation)e(of)h(this)g(serv)o(er)n(.)20 b(The)12 b(token)f(serv)o(er)h
(can)h(be)f(in)f(one)g(of)h(two)e(states:)18 b(either)11 b(the)g(token)g(is)
190 1080 y(currently)e(held)g(by)h(some)g(thread)g(\()p Fp(heldLoop)p
Fu(\))e(or)h(the)h(token)f(is)g(a)o(v)o(ailable)h(\()p Fp(availLoop)p
Fu(\).)j(If)d(the)f(current)h(token)e(holder)190 1140 y(terminates,)15
b(it)d(is)h(necessary)i(for)e(the)g(token)f(serv)o(er)i(to)f(reclaim)h(the)f
(token.)23 b(The)14 b Fp(threadWait)e Fu(e)o(v)o(ent)h(in)g
Fp(heldLoop)190 1200 y Fu(pro)o(vides)d(noti\256cation)f(of)h(this)f
(situation.)253 1280 y(Another)15 b(kind)h(of)g(synchronous)f(operation)h(is)
g(synchronizing)f(on)h(the)g(clock.)34 b Fr(CML)16 b Fu(supports)g(this)f
(with)h(the)190 1340 y(function)253 1435 y Fh(datatype)g(time)i(=)h(TIME)g
(of)f(sec)h(:)g(int,)f(usec)g(:)h(int)253 1480 y(val)f(timeout)f(:)i(time)f
(->)h(unit)f(event)190 1589 y Fu(which)9 b(produces)h(a)g(v)o(alue)f(for)g
(synchronizing)f(on)h(a)h(real-time)g(delay)m(.)15 b(This)9
b(could)g(be)h(used)g(by)f(the)g(abo)o(v)o(e)h(token)f(serv)o(er)n(,)190
1649 y(for)h(e)o(xample,)i(to)e(reclaim)g(the)h(token)e(after)h(a)h(\256x)o
(ed)g(period)e(during)g(which)h(the)g(token)f(is)h(unused)g(by)g(the)g
(possessor)n(.)253 1729 y Fr(CML)j Fu(also)g(supports)f(I/O)g(operations)g
(as)i(synchronous)e(operations.)23 b(F)o(or)13 b(e)o(xample,)j(the)d(e)o(v)o
(ent)g(v)o(alued)g(function)190 1789 y Fp(CIO.inputLineEvt)g
Fu(allo)o(ws)i(a)i(thread)f(to)f(synchronize)h(on)f(the)h(a)o(v)o(ailability)
e(of)h(a)i(line)e(of)h(input)e(from)i(a)g(stream.)190 1849
y(Chapter)10 b(5)g(describes)h Fr(CML)p Fu(')n(s)f(I/O)g(support)f(in)g
(greater)i(detail.)190 2009 y Fm(1.7)58 b(Building)16 b(new)f(synchr)o(onous)
f(abstractions)190 2132 y Fu(The)e(ke)o(y)e(moti)o(v)o(ation)f(for)h(e)o(v)o
(ents)h(is)f(to)g(pro)o(vide)g(a)h(mechanism)g(for)f(the)h(user)f(to)g(b)o
(uild)g(ne)o(w)g(synchronous)g(abstractions.)190 2192 y(In)h(this)f(section)h
(we)g(describe)h(the)f(implementation)e(of)i(a)h(couple)e(of)h(non-tri)o
(vial)e(abstractions,)h(which)h(ha)o(v)o(e)h(found)e(use)190
2252 y(in)g(real)h(applications.)190 2355 y Fr(Example)f(1.7)g(\(Buffer)o(ed)
h(channels\))190 2435 y Fu(Some)j(concurrent)e(languages,)i(such)f(as)h
Fn(actor)f Fu(languages)1082 2422 y Fo([Agh86)m(])1180 2435
y Fu(,)h(use)f(asynchronous)f(message)j(passing)e(for)f(process)190
2495 y(communication.)30 b(One)16 b(way)f(to)g(support)f(this)g(is)i(by)f
(implementing)f Fn(b)o(uf)o(fer)n(ed)h(c)o(hannels)p Fu(.)31
b(W)m(e)16 b(need)g(operations)e(to)190 2555 y(create)g(ne)o(w)e(channels)g
(and)g(to)g(send)g(and)g(recei)o(v)o(e)h(messages.)23 b(Since)12
b(the)g(channels)g(are)h(b)o(uf)o(fered,)g(the)e(send)i(operation)190
2614 y(is)g(asynchronous.)21 b(The)13 b(recei)o(v)o(e)h(operation)e(is)g
(synchronous,)g(so)h(we)g(pro)o(vide)f(an)h(e)o(v)o(ent-v)o(alued)f
(interface)h(to)f(it.)21 b(The)190 2674 y(follo)o(wing)8 b(signature)i
(de\256nes)h(the)f(interface:)1070 2799 y(12)p eop
%%Page: 13 19
13 18 bop 95 223 a Fh(structure)16 b(TokenServe)o(r)g(:)k(TOKEN_SER)o(VE)o(R)
d(=)134 268 y(struct)173 314 y(structure)g(CML)h(=)h(CML)173
360 y(open)f(CML)173 451 y(datatype)f(\('a,)h('b\))g(token)g(=)h(TOKEN)f(of)h
({)252 497 y(operation)d(:)j('a)g(->)g('b,)313 b(\(*)18 b(the)h(protected)d
(operation)g(*\))252 542 y(acquire_c)o(h)h(:)i(thread_id)d(chan,)155
b(\(*)19 b(the)f(channel)f(for)i(requesti)o(ng)d(the)j(token)e(*\))252
588 y(check)h(:)h(unit)f(->)h(unit,)312 b(\(*)18 b(check)g(for)h(token)e
(possession)f(*\))252 634 y(release)h(:)i(unit)f(->)h(unit)312
b(\(*)19 b(release)e(the)h(token)g(*\))213 679 y(})173 771
y(exception)f(NotToken)o(Hol)o(de)o(r)173 816 y(fun)i(newToken)d(operFn)i(=)h
(let)291 862 y(val)g(acqCh)e(=)i(channel\(\))e(and)h(relCh)g(=)h(channel\(\))
d(and)j(holdCh)e(=)i(channel\(\))291 908 y(fun)g(server)e(\(\))i(=)g(let)409
953 y(val)f(acquireEvt)e(=)j(receive)e(acqCh)409 999 y(val)h(releaseEvt)e(=)j
(receive)e(relCh)409 1045 y(val)h(myId)g(=)h(getTid\(\))409
1090 y(fun)f(heldLoop)f(curHolder)f(=)j(select)e([)566 1136
y(wrap)h(\(choose)f([releaseE)o(vt)o(,)g(threadWai)o(t)f(curHolder])o(,)605
1182 y(fn)j(\(\))g(=>)f(availLoop)f(\(\)\),)566 1227 y(wrap)h(\(transmit)o
(\(h)o(old)o(Ch,)e(curHolder)o(\),)605 1273 y(fn)j(\(\))g(=>)f(heldLoop)f
(curHolder)o(\))526 1319 y(])409 1364 y(and)h(availLoop)e(\(\))j(=)g(select)f
([)566 1410 y(wrap)g(\(acquireE)o(vt)o(,)f(fn)i(id)f(=>)h(heldLoop)e(id\),)
566 1456 y(wrap)h(\(transmit)o(\(h)o(old)o(Ch,)e(myId\),)h(fn)i(\(\))g(=>)g
(availLoo)o(p\(\))o(\))526 1501 y(])409 1547 y(in)448 1593
y(availLoop)d(\(\))409 1638 y(end)291 1684 y(fun)j(checkFn)d(\(\))j(=)g(if)g
(sameThread)o(\(ge)o(tTi)o(d\()o(\),)d(accept)i(holdCh\))448
1730 y(then)g(\(\))h(else)f(raise)g(NotTokenH)o(ol)o(der)291
1775 y(in)330 1821 y(spawn)g(server;)330 1867 y(TOKEN{)409
1912 y(operation)e(=)j(fn)g(x)g(=>)g(\(checkFn\(\))o(;)d(operFn)i(x\),)409
1958 y(acquire_c)o(h)e(=)k(acqCh,)409 2004 y(check)d(=)j(checkFn,)409
2049 y(release)d(=)i(fn)g(\(\))g(=>)f(send\(relCh,)e(\(\)\))370
2095 y(})291 2141 y(end)173 2232 y(fun)j(getOperat)o(ion)d(\(TOKEN{ch)o(eck)o
(,)g(operation,)g(...}\))i(=)h(\(check\(\);)d(operation\))173
2278 y(fun)j(releaseTo)o(ken)d(\(TOKEN{ch)o(eck)o(,)g(release,)h(...}\))h(=)h
(\(check\(\);)d(release\(\))o(\))173 2323 y(fun)j(acquireTo)o(ken)d
(\(TOKEN{ac)o(qui)o(re)o(_ch)o(,)g(...}\))i(=)h(transmit\(ac)o(qu)o(ire)o(_c)
o(h,)d(getTid\(\)\))134 2415 y(end)j(\(*)f(TokenServer)e(*\))592
2547 y Fu(Figure)10 b(1.1:)k(T)m(oken)c(serv)o(er)h(implementation)912
2799 y(13)p eop
%%Page: 14 20
14 19 bop 253 82 a Fh(signature)16 b(BUFFER_CH)o(AN)g(=)292
128 y(sig)331 174 y(structure)g(CML)j(:)g(CONCUR_ML)331 219
y(type)f('a)h(buffer_cha)o(n)331 265 y(val)g(buffer)e(:)i(unit)f(->)h('1a)f
(buffer_chan)331 310 y(val)h(bufferSe)o(nd)d(:)k(\('a)e(buffer_cha)o(n)e(*)k
('a\))e(->)h(unit)331 356 y(val)g(bufferAc)o(cep)o(t)e(:)i('a)g(buffer_ch)o
(an)d(->)j('a)331 402 y(val)g(bufferRe)o(cei)o(ve)d(:)j('a)g(buffer_cha)o(n)e
(->)h('a)h(CML.event)292 447 y(end)f(\(*)h(BUFFER_CHA)o(N)e(*\))190
561 y Fu(T)m(o)d(implement)f(the)g(b)o(uf)o(fer)h(queue,)h(we)f(use)g(an)g
(in\256nitely)d(looping)h(thread.)25 b(This)13 b(thread)g(maintains)h(the)f
(queue)h(as)g(a)190 621 y(pair)f(of)g(stacks)h(\(implemented)f(as)g(lists\).)
23 b(When)13 b(the)g(b)o(uf)o(fer)g(is)g(empty)m(,)i(then)d(the)h(b)o(uf)o
(fer)g(thread)g(only)f(accepts)j(input;)190 681 y(when)e(there)g(is)f(stuf)o
(f)g(in)g(the)g(b)o(uf)o(fer)n(,)i(then)e(it)g(also)g(of)o(fers)h(the)f
(front)g(of)g(the)h(queue)f(as)i(output.)20 b(The)13 b(follo)o(wing)e
(functor)190 741 y(implements)f(this)g(scheme:)253 840 y Fh(functor)17
b(BufferCh)o(an)f(\(CML)i(:)i(CONCUR_ML)o(\))c(:)k(BUFFER_CH)o(AN)c(=)292
886 y(struct)331 931 y(structure)g(CML)j(=)g(CML)331 1023 y(open)f(CML)331
1114 y(datatype)f('a)h(buffer_chan)e(=)j(BC)g(of)g({inch)e(:)j('a)f(chan,)e
(outch)h(:)h('a)g(chan})331 1205 y(fun)g(buffer)e(\(\))i(=)g(let)449
1251 y(val)f(inCh)g(=)i(channel\()o(\))d(and)h(outCh)g(=)h(channel\(\))449
1297 y(fun)f(loop)g(\([],)g([]\))h(=)g(loop\([acce)o(pt)d(inCh],)h([]\))488
1342 y(|)i(loop)f(\(front)g(as)g(\(x::r\),)f(rear\))h(=)h(select)f([)606
1388 y(wrap)g(\(receive)e(inCh,)i(fn)h(y)g(=>)g(loop\(fron)o(t,)d
(y::rear\)\),)606 1434 y(wrap)i(\(transmit)o(\(ou)o(tC)o(h,)e(x\),)j(fn)g
(\(\))f(=>)h(loop\(r,)e(rear\)\))566 1479 y(])488 1525 y(|)i(loop)f(\([],)g
(rear\))g(=)h(loop\(List.)o(rev)d(rear,)i([]\))449 1571 y(in)488
1616 y(spawn)g(\(fn)g(\(\))h(=>)g(loop\([],)d([]\)\);)488 1662
y(BC{inch=in)o(Ch)o(,)h(outch=out)o(Ch)o(})449 1708 y(end)331
1799 y(fun)i(bufferSe)o(nd)d(\(BC{inch,)g(...},)i(x\))h(=)g(send\(inch,)d
(x\))331 1845 y(fun)j(bufferAc)o(cep)o(t)e(\(BC{outc)o(h,)f(...}\))i(=)h
(accept)f(outch)331 1890 y(fun)h(bufferRe)o(cei)o(ve)d(\(BC{outch,)g(...}\))i
(=)h(receive)e(outch)292 1982 y(end)h(\(*)h(functor)e(BufferChan)f(*\))190
2095 y Fu(Asynchronous)10 b(communication)f(can)i(also)f(be)h(implemented)f
(by)g(spa)o(wning)g(a)h(ne)o(w)f(thread)g(to)g(send)h(the)f(message:)253
2195 y Fh(fun)18 b(asyncSend)e(\(ch,)i(msg\))g(=)i(\(spawn)d(\(fn)h(\(\))h
(=>)g(send)f(\(ch,)g(msg\)\);)f(\(\)\))190 2309 y Fu(This)e(essentially)f
(uses)i(the)f(ne)o(w)g(thread)f(as)i(a)f(cell)g(in)g(the)f(b)o(uf)o(fer)h
(queue.)29 b(This)15 b(technique)f(is)h(most)g(often)f(used)h(for)190
2369 y(\252single-shot\272)9 b(communications,)g(since)g(the)g(order)g(of)g
(messages)h(may)g(not)e(be)i(preserv)o(ed.)15 b(When)10 b(using)e(either)g
(of)h(these)190 2428 y(techniques,)j(it)f(is)g(important)f(to)h(a)o(v)o(oid)g
(situations)f(in)g(which)h(messages)j(are)e(produced)f(much)h(more)f(rapidly)
g(than)g(the)o(y)190 2488 y(are)k(consumed.)28 b(If)14 b(such)g(a)h
(discrepanc)o(y)g(occurs)g(for)e(a)i(sustained)f(period,)h(substantial)e
(memory)h(resources)h(will)e(be)190 2548 y(consumed)e(by)f(the)g(b)o(uf)o
(fers,)h(which)e(will)g(de)o(grade)i(performance.)190 2653
y Fr(Example)f(1.8)g(\(Multicast\))1070 2799 y Fu(14)p eop
%%Page: 15 21
15 20 bop 33 82 a Fu(Another)12 b(useful)h(e)o(xample)h(is)f(the)g
(implementation)f(of)h Fn(b)o(uf)o(fer)n(ed)h(multicast)d(c)o(hannels)p
Fu(,)j(which)f(b)o(uild)f(on)h(the)g(b)o(uf)o(fered)33 142
y(channels)g(by)g(pro)o(viding)d Fn(fan-out)p Fu(.)22 b(A)13
b(multicast)f(channel)h(has)h(a)f(number)g(of)g Fn(output)e(ports)p
Fu(.)22 b(When)14 b(a)f(thread)g(sends)g(a)33 202 y(message)e(on)f(a)g
(multicast)f(channel,)i(it)e(is)g(replicated)h(once)g(for)g(each)g(output)f
(port.)14 b(In)9 b(addition)f(to)h(the)h(standard)g(channel)33
262 y(operations)e(\(create,)j(send)f(and)f(accept\),)i(we)f(need)g(an)g
(operation)e(to)h(create)i(ne)o(w)f(ports.)k(The)c(follo)o(wing)d(signature)i
(gi)o(v)o(es)33 321 y(the)h(multicast)f(interface:)95 421 y
Fh(signature)16 b(MULTICAST)g(=)134 467 y(sig)173 512 y(structure)h(CML)h(:)h
(CONCUR_ML)173 558 y(type)f('a)h(mchan)173 604 y(val)g(mChannel)d(:)k(unit)e
(->)g('1a)h(mchan)173 649 y(val)g(newPort)e(:)i('a)g(mchan)e(->)i('a)g
(CML.event)173 695 y(val)g(multicast)d(:)j(\('a)g(mchan)e(*)j('a\))e(->)h
(unit)134 741 y(end)g(\(*)f(MULTICAST)f(*\))33 854 y Fu(Ne)o(w)7
b(multicast)g(channels)g(are)h(created)h(using)d Fp(mChannel)f
Fu(and)j(ne)o(w)f(ports)f(using)h Fp(newPort)p Fu(.)13 b(The)7
b Fp(multicast)f Fu(operation)33 914 y(asynchronously)k(broadcasts)i(a)h
(message)g(to)e(the)h(ports)f(of)g(a)h(multicast)g(channel.)20
b(A)11 b(port)g(is)h(represented)g(by)f(an)h(e)o(v)o(ent)33
974 y(v)o(alue;)d(synchronizing)g(on)h(a)h(port)e(e)o(v)o(ent)i(will)e
(return)g(the)h(ne)o(xt)g(multicast)g(message.)95 1054 y(A)g(multicast)g
(channel)h(consists)f(of)g(a)h(serv)o(er)g(thread,)g(which)f(initiates)f(the)
h(broadcast)h(and)g(creates)g(ne)o(w)g(ports)f(and)g(a)33 1114
y(chain)e(of)h(ports.)k(Each)d(port)e(consists)g(of)g(a)h(b)o(uf)o(fer)f(and)
h(a)g(\252)p Fn(tee)p Fu(\272)h(thread)e(that)g(inserts)g(the)h(incoming)e
(message)k(in)d(the)g(b)o(uf)o(fer)33 1174 y(and)k(propagates)g(it)g(to)g
(the)g(ne)o(xt)g(port.)21 b(The)13 b(port)e(b)o(uf)o(fer)h(is)g(implemented)h
(using)e(the)h(library)g(v)o(ersion)g(of)g(the)g(b)o(uf)o(fered)33
1234 y(channels)h(from)f(Example)h(1.7)g(\(see)g(appendix)f(section)g(B.2\).)
22 b(The)13 b(follo)o(wing)d(picture)i(gi)o(v)o(es)h(a)g(schematic)h(vie)o(w)
e(of)g(a)33 1293 y(multicast)d(channel)i(with)e(four)g(ports:)183
2218 y @beginspecial 36 @llx 36 @lly 414 @urx 252 @ury 3600
@rwi @setspecial
%%BeginDocument: multicast.ps
/setDotted {
    1 setlinewidth
    [1 6 idtransform abs ceiling exch abs ceiling exch] 0 setdash
  } def
/setSolid {
    1 setlinewidth
    [] 0 setdash
  } def
/drawText {		% stack: name x y vertalign
  /textVertAlign exch def
  /textYPos exch def
  /textXPos exch def
  /textName exch def
  gsave
    newpath
    0 0 moveto (X) false charpath flattenpath pathbbox
    exch pop exch sub /myfontht exch def pop
    newpath
    textXPos textYPos moveto
    textName stringwidth pop
    -.5 mul myfontht textVertAlign mul rmoveto
    textName show
  grestore
} def
/drawBox {  % stack: x y wid ht => -
    /ht exch def
    /wid exch def
    newpath
      moveto
      0 ht rlineto
      wid 0 rlineto
      0 ht neg rlineto
      closepath
    stroke
  } def
/drawCircle { % stack: x y radius => -
    newpath
      dup 3 index add   % stack: x y radius x+radius
      2 index moveto    % move to (x+radius, y)
      0 360 arc
      setSolid
    stroke
  } def
/arrowLen 7 def
/arrowWid arrowLen 2 div def
/drawArrowHead { % stack: x y => -
    currentpoint exch pop sub exch currentpoint pop sub atan
    gsave
    rotate
    currentpoint
    newpath
      moveto
      arrowLen arrowWid 2 div rlineto
      0 arrowWid neg rlineto
    closepath fill
    grestore
  } def
/drawEdge {  % stack: x1 y1 x2 y2 => -
    3 index 3 index  % stack: x1 y1 x2 y2 x1 y1
    newpath
      moveto
      lineto
      currentpoint
      0.5 setlinewidth
    stroke
    moveto % reset currentpoint
    drawArrowHead
  } def
save
36 36 translate  % move the origin to (0.5", 0.5")
/bigWid 378 def                   % big box is (5.25" x 1.75")
/bigHt  126 def
/bigLLX   0 def                   % Lower-left corner of big box at (0", 0.5")
/bigLLY  36 def
/bigULX bigLLX def                % Upper-left corner
/bigULY bigLLY bigHt add def
/serverWid 72 def                 % server box is (1" x 0.5")
/serverHt 36 def
/serverURY bigULY 18 sub def      % Upper-right of server box
/serverURX bigULX 18 add serverWid add def
/serverLLX bigULX 18 add def      % Lower-left corner of server
/serverLLY serverURY serverHt sub def
/bufWid 18 def                    % buffer boxes are (0.25" x 0.5")
/bufHt  36 def
/bufLLY bigLLY 18 add def
/teeY serverLLY serverHt 2 idiv add def
/teeRadius bufWid 2 idiv def      % radius of a tee circle
/drawBuffer { % stack: x y
    gsave
      translate  % move origin to (x, y)
      270 rotate
      bufHt neg 0 bufHt bufWid drawBox
      /Times-Roman findfont 9 scalefont setfont
      (Buffer) bufHt -.5 mul bufWid .5 mul -.5 drawText
    grestore
  } def
/drawPort {  % stack: x => -
    /xpos exch def
    /xcenter xpos teeRadius add def  % x-coord of center of port
    /teeX xpos teeRadius add def
    setSolid
    xpos bufLLY drawBuffer
    teeX teeY teeRadius drawCircle
    xpos 36 sub teeY xpos teeY drawEdge  % edge from left to tee
    teeX teeY teeRadius sub teeX teeY 36 sub drawEdge  % edge from tee to buffer
    teeX bufLLY teeX bufLLY 36 sub drawEdge  % edge from buffer to outside
    /Times-Roman findfont 9 scalefont setfont
    (Port) teeX bufLLY 37 sub -1 drawText
  } def
setDotted
bigLLX bigLLY bigWid bigHt drawBox
setSolid
serverLLX serverLLY serverWid serverHt drawBox
/Times-Roman findfont 9 scalefont setfont
(Multicast server)
  serverLLX serverWid .5 mul add
  serverLLY serverHt .5 mul add
  -.5 drawText
/xoffset serverWid 7 div 2 mul def
/ypos serverURY 36 add def
/xpos serverURX xoffset sub def
xpos ypos xpos serverURY drawEdge
(multicast) xpos ypos 1 drawText
/xpos serverLLX xoffset add def
/ypos ypos 12 add def
xpos 2 sub dup ypos exch serverURY drawEdge
xpos 2 add dup serverURY exch ypos drawEdge
/Times-Roman findfont 9 scalefont setfont
(newPort) xpos ypos 1 drawText
serverLLX serverWid add 36 add  % put start x-coord on stack
4 {
    dup drawPort
    54 add  % increment x-coord by 0.75"
  } repeat
/xpos exch def
xpos 36 sub teeY xpos teeY drawEdge
/ht teeRadius 2 sub def
1 setlinewidth
3 {
      newpath
        xpos teeY ht sub moveto
        0 ht 2 mul rlineto
      stroke
    /xpos xpos 3 add def
    /ht ht 3 sub def
  } repeat
showpage
restore
%%EndDocument
 @endspecial 33 2331 a(The)15 b(source)h(code)f(for)f(the)h
Fp(Multicast)e Fu(structure)i(is)f(gi)o(v)o(en)h(in)f(\256gure)h(1.2.)29
b(All)14 b(of)h(the)g(interesting)e(stuf)o(f)h(is)h(in)f(the)33
2391 y(function)8 b Fp(mChannel)p Fu(,)h(which)h(spa)o(wns)h(a)g(ne)o(w)g
(serv)o(er)g(thread.)k(A)10 b(multicast)g(channel)g(v)o(alue)h(is)f(a)g
(request/reply)g(channel)33 2451 y(pair)n(,)15 b(which)e(pro)o(vides)g(an)h
(interface)g(to)f(the)g(serv)o(er)i(thread.)25 b(A)14 b(request)g(is)f
(either)h(a)g(message)i(to)d(be)h(broadcast,)h(or)e(a)33 2511
y(request)c(for)g(a)h(ne)o(w)f(port.)14 b(The)c(interface)g(between)f(the)h
(serv)o(er)g(thread)f(and)g(the)h(\256rst)f(port)f(in)h(the)g(chain)g(and)h
(the)f(interface)33 2571 y(between)i(a)h(tee)f(thread)g(and)g(the)g(ne)o(xt)g
(port)f(is)g(an)i(output)d(function.)16 b(The)11 b(output)f(function)f(at)i
(the)g(end)g(of)g(the)f(chain)h(is)g(a)33 2630 y(sink.)912
2799 y(15)p eop
%%Page: 16 22
16 21 bop 190 82 a Fm(1.8)58 b(Client-ser)o(v)o(er)15 b(pr)o(otocols)190
206 y Fu(The)h(client-serv)o(er)f(paradigm)g(is)g(a)h(v)o(ery)f(important)e
(model)i(for)g(structuring)e Fr(CML)i Fu(programs.)30 b(Serv)o(ers)16
b(pro)o(vide)e(a)190 265 y(mechanism)e(for)f(mediating)f(access)j(to)d
(shared)i(state)f(\(the)f(token)g(serv)o(er)i(in)e(Example)i(1.6)f(is)f(one)h
(e)o(xample)h(of)f(this\).)16 b(In)190 325 y(general,)11 b(clients)e
(communicate)h(with)f(the)g(serv)o(er)i(using)e(a)h(request-reply)f(protocol)
f(\(also)h(called)h(a)g(a)h Fn(r)n(emote)f(pr)n(ocedur)n(e)190
385 y(call)e Fu(\(RPC\),)g(although)f(the)h(serv)o(er)h(and)g(client)e(are)i
(in)f(the)g(same)i(name)f(space\).)16 b(One)9 b(way)f(to)g(implement)g(such)g
(a)h(protocol)190 445 y(was)j(presented)f(on)g(page)g(9,)h(where)g
Fp(transmit)d Fu(was)i(used)h(to)e(send)i(the)e(request)i(and)f(a)g(wrapper)h
(was)f(used)g(to)g(wait)f(for)190 505 y(the)h(reply)m(.)k(This)10
b(approach)h(uses)g(the)f(serv)o(er')n(s)h(willingness)d(to)i(accept)h(a)g
(request)g(as)g(the)f(e)o(v)o(ent)h(to)e(synchronize)h(on,)h(b)o(ut,)190
564 y(for)e(some)h(services,)g(we)f(need)h(to)e(synchronize)h(on)f(the)h
(reply)m(.)15 b(Thus)9 b(we)g(need)h(a)f(way)g(to)f(include)g(communications)
h(to)f(be)190 624 y(done)j(prior)e(to)h(the)h(synchronization)e(point)g(of)h
(an)h(e)o(v)o(ent)g(v)o(alue)g(\(the)f(dual)g(of)g Fp(wrap)p
Fu(,)h(which)f(includes)g(communications)190 684 y(after)h(the)f
(synchronization)e(point\).)253 764 y(The)16 b Fp(guard)e Fu(combinator)h
(pro)o(vides)g(this)f(mechanism.)32 b(It)15 b(is)g(essentially)g(a)h
(\252delay\272)g(operator)n(,)h(which)e(wraps)h(a)190 824 y(e)o(v)o(ent-v)o
(alued)11 b(function)e(\(or)h Fn(thunk)p Fu(\))g(as)i(an)f(e)o(v)o(ent)g(v)o
(alue.)16 b(The)c Fp(sync)e Fu(operator)g(plays)g(the)h(role)f(of)g(force,)i
(e)o(v)o(aluating)e(the)190 884 y(guard)g(prior)f(to)h(synchronizing)f(on)h
(the)g(resulting)e(e)o(v)o(ent)j(v)o(alue.)k(It)10 b(has)h(the)f(type:)253
984 y Fh(val)18 b(guard)g(:)h(\(unit)f(->)h('a)f(event\))g(->)h('a)f(event)
190 1097 y Fu(The)10 b Fp(guard)f Fu(operation)f(allo)o(ws)g(the)h(abstract)h
(implementation)e(of)h(a)g(protocol)f(in)h(which)g(the)g(client)f(\256rst)h
(sends)h(a)g(request)190 1157 y(to)g(the)g(serv)o(er)n(.)190
1263 y Fr(Example)g(1.9)g(\(Clock)g(server\))190 1343 y Fu(As)h(an)f(e)o
(xample,)i(assume)g(that)d(we)i(want)f(to)g(b)o(uild)e(a)j(clock)g(serv)o(er)
g(to)e(implement)h(an)h(e)o(v)o(ent)g(constructor)253 1443
y Fh(val)18 b(waitUntil)e(:)j(time)g(->)f(unit)g(event)190
1556 y Fu(which)11 b(returns)g(an)h(e)o(v)o(ent)g(for)f(synchronizing)e(on)j
(the)f(speci\256ed)h(time)f(\(in)g(fact,)h Fp(waitUntil)e Fu(is)h(pro)o
(vided)f(by)h Fr(CML)h Fu(as)190 1616 y(a)g(b)o(uilt-in)d(operation;)g(see)k
(Chapter)d(3\).)17 b(The)12 b(basic)g(client-serv)o(er)f(protocol)e(is)i(for)
g(the)f(client)h(to)f(send)i(a)f(request)g(to)g(the)190 1676
y(clock)g(serv)o(er)n(,)h(which)e(includes)f(the)i(wake-up)e(time)h(and)h(a)g
(fresh)f(reply)g(channel;)g(when)h(the)f(wake-up)f(time)i(arri)o(v)o(es,)g
(the)190 1736 y(serv)o(er)i(sends)e(a)h(message)h(on)f(the)f(reply)g
(channel.)18 b(The)12 b(reply)f(channel)h(serv)o(es)g(as)h(a)e(unique)g
(identi\256er)f(for)h(the)g(client')n(s)190 1796 y(request.)16
b(The)11 b(client-side)e(code)i(is:)253 1895 y Fh(fun)18 b(waitUntil)e(t)j(=)
h(guard)d(\(fn)i(\(\))g(=>)g(let)370 1941 y(val)g(replyCh)e(=)i(channel\(\))
370 1986 y(in)410 2032 y(spawn)e(\(fn)i(\(\))g(=>)f(send)g(\(timerReqCh)o(,)e
(\(t,)j(replyCh\)\))o(\);)410 2078 y(receive)d(replyCh)370
2123 y(end)190 2237 y Fu(where)11 b Fp(timerReqCh)d Fu(is)i(a)h(global)e
(channel)i(for)f(communicating)f(with)g(the)h(timer)g(serv)o(er)n(.)1529
2222 y Fo(7)1562 2237 y Fu(The)h(serv)o(er)g(is)f(b)o(uilt)f(using)g(a)190
2297 y(couple)g(of)f(functions)f(pro)o(vided)g(by)h(the)g Fr(SML/NJ)g
Fu(structure)g Fp(System.Timer)p Fu(:)j Fp(earlier)p Fu(,)d(for)g(testing)f
(the)h(order)g(of)h(two)190 2357 y(times)h(and)g Fp(sub_time)p
Fu(,)f(for)g(computing)g(the)h(time)f(dif)o(ference)i(between)f(two)f(times.)
15 b(W)m(e)10 b(also)g(assume)h(the)f(e)o(xistence)h(of)190
2417 y(a)j(function)d Fp(gettimeofday)p Fu(,)g(for)h(getting)f(the)h(current)
g(time)h(of)f(day)h(\(this)e(mechanism)j(e)o(xists)f(in)f Fr(SML/NJ)p
Fu(,)g(b)o(ut)g(it)g(is)190 2476 y(not)e(easily)g(accessed\).)17
b(The)11 b(clock)g(serv)o(er)g(is)f(implemented)g(as:)p 190
2512 720 2 v 236 2539 a Fl(7)250 2551 y Fk(Using)e(a)g(top-le)o(vel)f
(channel)f(like)i Fj(timerReqCh)d Fk(introduces)i(some)g(initialization)h
(requirements;)f(see)h(Chapter)f(6)h(for)g(details.)1070 2799
y Fu(16)p eop
%%Page: 17 23
17 22 bop 95 82 a Fh(fun)18 b(server)g([])h(=)g(server)e([accept)g(timerReqC)
o(h])134 128 y(|)i(server)f(\(waitingL)o(is)o(t)f(as)h(\(\(nextTim,)e
(_\)::rest\)\))g(=)j(let)213 174 y(fun)f(insert)f(\(x)i(as)g(\(t,)f(_\),)h
([]\))f(=)i([x])252 219 y(|)f(insert)e(\(x)i(as)g(\(t,)f(_\),)h(\(y)g(as)g
(\(t',)f(_\)\)::r\))f(=)330 265 y(if)i(earlier\(t,)d(t'\))i(then)g(x::y::r)f
(else)h(y::\(insert\()o(x,)e(r\)\))213 310 y(fun)i(wakeup)f(\(\))i(=)g(let)
330 356 y(val)g(now)f(=)h(gettimeofda)o(y\()o(\))330 402 y(fun)g(wake)f([])h
(=)g([])370 447 y(|)g(wake)f(\(waitingL)o(ist)e(as)j(\(\(t,)f(replyCh\):)o
(:r)o(\)\))e(=)448 493 y(if)j(earlier)e(\(now,)g(t\))487 539
y(then)h(waitingLis)o(t)487 584 y(else)g(\(spawn)g(\(fn)g(\(\))h(=>)g(send)f
(\(replyCh,)e(\(\)\)\);)i(wake)g(r\))330 630 y(in)370 676 y(wake)g(waitingL)o
(ist)330 721 y(end)213 767 y(in)252 813 y(select)f([)330 858
y(wrap)h(\(timeout)f(\(sub_time)f(\(nextTim,)g(gettimeofd)o(ay\()o(\)\))o
(\),)370 904 y(fn)i(\(\))h(=>)g(server)e(\(wakeup)g(\(\)\)\),)330
950 y(wrap)h(\(receive)f(timerReqC)o(h,)370 995 y(fn)h(req)h(=>)g(server)e
(\(insert)g(\(req,)h(waitingL)o(ist)o(\)\)\))291 1041 y(])213
1087 y(end)33 1200 y Fu(The)10 b(serv)o(er)g(maintains)f(an)h(ordered)f(list)
g(of)g(pending)f(wake-up)h(requests.)15 b(The)10 b(function)e
Fp(insert)h Fu(adds)g(a)i(request)e(to)g(the)33 1260 y(list.)15
b(When)10 b(it)g(has)h(pending)f(requests)g(in)g(its)g(queue,)h(it)f
(computes)h(the)f(delay)h(to)f(the)g(ne)o(xt)h(wake-up)e(and)i(uses)g
Fp(timeout)33 1320 y Fu(to)f(wait)g(for)h(it.)17 b(The)12 b(function)d
Fp(wakeup)h Fu(remo)o(v)o(es)j(those)d(elements)i(of)f(the)g(list)f(that)g
(are)i(ready)g(for)e(wake-up)g(messages.)33 1380 y(F)o(or)g(each)g(wake-up)f
(message)j(a)e(ne)o(w)g(thread)g(is)f(spa)o(wned)i(to)e(send)h(it;)f(this)g
(a)o(v)o(oids)g(problems)h(in)f(the)g(case)j(that)d(the)g(client)33
1440 y(uses)i Fp(waitUntil)d Fu(as)j(part)f(of)g(a)h(choice)f(and)h(a)g(dif)o
(ferent)e(e)o(v)o(ent)h(is)g(selected.)95 1520 y(The)h(clock)g(serv)o(er)h(e)
o(xample)g(has)f(the)f(property)g(that)g(the)g(serv)o(er)i(is)e
Fn(idempotent)p Fu(;)g(i.e.,)i(that)e(the)g(handling)f(of)i(a)g(gi)o(v)o(en)
33 1580 y(request)j(is)g(independent)f(of)g(other)h(requests.)27
b(Thus,)15 b(using)f(a)g(ne)o(w)g(thread)g(to)g(send)g(a)h(reply)e(is)h(suf)o
(\256cient)g(to)f(protect)33 1640 y(the)g(serv)o(er)h(against)f(the)g
(situation)f(in)g(which)h(the)h(client)e(selects)i(another)f(e)o(v)o(ent)h
(in)f(a)h(selection.)24 b(F)o(or)13 b(some)i(services,)33 1699
y(ho)o(we)o(v)o(er)n(,)h(this)d(is)h(not)f(suf)o(\256cient;)i(the)f(serv)o
(er)h(needs)f(to)g(kno)o(w)f(whether)h(to)f Fn(commit)h Fu(or)f
Fn(abort)g Fu(the)h(transaction.)26 b(The)33 1759 y(follo)o(wing)7
b(combinator)j(pro)o(vides)g(such)g(a)h(mechanism:)95 1859
y Fh(val)18 b(wrapAbort)f(:)i(\('a)f(event)g(*)h(\(unit)f(->)h(unit\)\))e(->)
i('a)g(event)33 1973 y Fu(It)8 b(associates)i(an)g(abort)e(action)h(with)f
(an)h(e)o(v)o(ent.)15 b(If)9 b(the)g(resulting)e(e)o(v)o(ent)j(is)e(in)n(v)o
(olv)o(ed)h(in)f(a)i(selecti)o(v)o(e)f(synchronization)f(and)33
2032 y(another)i(e)o(v)o(ent)g(is)g(chosen,)h(then)f(a)h(thread)f(is)g(spa)o
(wned)h(to)f(e)o(v)o(aluate)g(the)g(abort)g(action.)33 2138
y Fr(Example)f(1.10)h(\(Input)g(line)g(e)o(vent\))33 2218 y
Fu(F)o(or)f(e)o(xample,)h(consider)f(the)g(implementation)f(of)g(a)i(b)o(uf)o
(fered)f(input)e(stream)j(such)f(as)g(is)g(pro)o(vided)f(by)h(the)g
Fp(CIO)f Fu(structure.)33 2278 y(The)i(abstraction)f(should)g(pro)o(vide)h(e)
o(v)o(ent)g(v)o(alued)g(operations)f(for)g(reading)h(both)e(single)i
(characters)h(and)f(complete)g(lines)33 2338 y(of)g(input:)95
2438 y Fh(val)18 b(inputCharEv)o(t)e(:)k(instream)c(->)j(string)e(event)95
2483 y(val)h(inputLineEv)o(t)e(:)k(instream)c(->)j(string)e(event)33
2597 y Fu(The)9 b(basic)h(protocol)d(is)i(that)f(the)h(client)g(sends)g(a)g
(request)g(to)g(the)g(serv)o(er)n(,)h(which)f(then)g(requests)g(input)e(from)
i(the)g(operating)33 2657 y(system.)21 b(Once)12 b(input)f(is)h(a)o(v)o
(ailable,)h(the)e(serv)o(er)i(sends)g(it)e(to)g(the)h(client.)20
b(The)13 b(follo)o(wing)c(code)k(implements)f(the)f(client)912
2799 y(17)p eop
%%Page: 18 24
18 23 bop 190 82 a Fu(side)11 b(of)f(the)g Fp(inputLineEvt)e
Fu(function.)796 67 y Fo(8)253 182 y Fh(datatype)16 b(input_req)g(=)k
(INPUTLN)c(of)j(\(string)e(chan)h(*)i(unit)e(chan\))f(|)i Fc(\001)7
b(\001)f(\001)253 273 y Fh(fun)18 b(inputLineE)o(vt)e(\(INSTRMreq)o(_c)o(h,)g
(...\))i(=)i(guard)d(\(fn)i(\(\))g(=>)f(let)370 319 y(val)h(replyCh)e(=)i
(channel)e(\(\))i(and)f(abortCh)f(=)i(channel)e(\(\))370 364
y(in)410 410 y(spawn)g(\(fn)i(\(\))g(=>)f(send)g(\(req_ch,)f(INPUTLN\(re)o
(pl)o(yCh)o(,)f(abortCh\)\)\);)410 456 y(wrapAbor)o(t)h(\(receive)f(replyCh,)
h(fn)i(\(\))f(=>)h(send)f(\(abortCh,)e(\(\)\)\))370 501 y(end\))190
615 y Fu(The)c(client')n(s)d(request)h(consists)h(of)f(the)g(desired)g
(operation)g(\()p Fp(INPUTLN)p Fu(\),)f(a)i(reply)f(channel)g(and)h(an)g
(abort)f(channel.)16 b(Note)190 675 y(that)d(the)g(request)g(is)g(sent)g
(asynchronously;)g(this)f(is)h(done)g(to)f(a)o(v)o(oid)h(blocking)f(the)h
(client)f(in)h(the)f(case)j(that)e(the)g(serv)o(er)190 735
y(is)i(b)o(usy)m(.)30 b(When)15 b(the)g(serv)o(er)h(has)f(the)g(input)e
(necessary)k(to)d(satisfy)h(the)f(request,)j(it)d(synchronizes)h(on)g(the)f
(choice)i(of)190 795 y(recei)o(ving)10 b(the)g(abort)g(noti\256cation)f(or)h
(ha)o(ving)f(its)h(reply)g(accepted.)16 b(If)10 b(the)g(reply)g(is)g
(accepted,)i(then)e(the)g(serv)o(er)h(commits)190 854 y(the)h(transaction)g
(\(i.e.,)h(discards)f(the)g(input\).)19 b(On)12 b(the)f(other)h(hand,)g(if)g
(an)g(abort)g(message)h(is)f(recei)o(v)o(ed,)i(then)e(the)g(serv)o(er)190
914 y(aborts)e(the)g(transaction)g(and)g(b)o(uf)o(fers)g(the)g(input)f(for)h
(the)g(ne)o(xt)g(request.)p 190 2635 720 2 v 236 2662 a Fl(8)250
2674 y Fk(The)e(server)f(side)h(code)f(is)h(too)g(in)o(v)o(olved)e(to)i
(present)f(here;)h(the)g(interested)f(reader)h(is)g(referred)g(to)g(the)g
(source)f(code)g(of)g(the)h Fj(CIO)g Fk(structure.)1070 2799
y Fu(18)p eop
%%Page: 19 25
19 24 bop 95 338 a Fh(functor)17 b(Multicast)f(\(BC)i(:)i(BUFFER_CH)o(AN)o
(\))d(:)i(MULTICAST)d(=)134 384 y(struct)173 430 y(structure)h(CML)h(=)h
(BC.CML)173 521 y(open)f(CML)173 612 y(datatype)f('a)i(mchan)e(=)j(MChan)d
(of)i(\('a)g(request)e(chan)h(*)h('a)g(event)e(chan\))271 658
y(and)i('a)g(request)e(=)i(Message)e(of)i('a)f(|)i(NewPort)173
749 y(fun)f(mChannel)d(\(\))j(=)g(let)291 795 y(val)g(reqCh)e(=)i
(channel\(\))e(and)h(respCh)f(=)j(channel\()o(\))291 841 y(fun)f(mkPort)e
(outFn)g(=)j(let)409 886 y(val)e(buf)h(=)g(BC.buffer)o(\(\))409
932 y(val)f(inCh)g(=)h(channel\(\))409 978 y(fun)f(tee)h(\(\))f(=)i(let)e
(val)h(m)g(=)g(accept)e(inCh)526 1023 y(in)566 1069 y(BC.buffer)o(Se)o(nd\()o
(bu)o(f,)f(m\);)566 1115 y(outFn)h(m;)566 1160 y(tee\(\))526
1206 y(end)409 1252 y(in)448 1297 y(spawn)h(tee;)448 1343 y(\(fn)g(m)i(=>)e
(send\(inCh,)e(m\),)j(BC.buffer)o(Re)o(cei)o(ve)d(buf\))409
1389 y(end)291 1434 y(fun)j(server)e(outFn)g(=)j(let)409 1480
y(fun)e(handleReq)e(NewPort)h(=)i(let)g(val)f(\(outFn',)f(port\))h(=)h
(mkPort)e(outFn)526 1526 y(in)566 1571 y(send)h(\(respCh,)e(port\);)566
1617 y(outFn')526 1663 y(end)448 1708 y(|)j(handleReq)d(\(Message)h(m\))i(=)g
(\(outFn)e(m;)i(outFn\))409 1754 y(in)448 1800 y(server)e(\(sync)h(\(wrap)g
(\(receive)e(reqCh,)h(handleReq\)\))o(\))409 1845 y(end)291
1891 y(in)330 1937 y(spawn)h(\(fn)g(\(\))h(=>)g(server)e(\(fn)i(_)g(=>)g
(\(\)\)\);)330 1982 y(MChan\(reqC)o(h,)d(respCh\))291 2028
y(end)173 2119 y(fun)j(newPort)e(\(MChan\(re)o(qC)o(h,)f(respCh\)\))h(=)i
(\(send)f(\(reqCh,)f(NewPort\);)f(accept)h(respCh\))173 2211
y(fun)i(multicast)d(\(MChan\(ch)o(,)h(_\),)h(m\))h(=)g(send)f(\(ch,)g
(Message)f(m\))134 2302 y(end)i(\(*)f(Multicast)f(*\))620 2435
y Fu(Figure)10 b(1.2:)k(Multicast)c(implementation)912 2799
y(19)p eop
%%Page: 20 26
20 25 bop 190 414 a Fi(Chapter)20 b(2)190 643 y Fs(Basic)27
b(concurr)n(ency)e(primiti)o(v)o(es)190 889 y Fr(CML)9 b Fu(is)g(based)h(on)f
(a)g(distrib)o(uted-memory)f(model)958 874 y Fo(1)983 889 y
Fu(with)g(synchronous)g(message)j(passing)e(on)g(typed)f(channels.)15
b(These)190 949 y(basic)g(concurrenc)o(y)g(operations)e(are)i(de\256ned)g(in)
f(the)g(structure)g Fp(CML)f Fu(and)i(are)g(described)f(in)g(this)f(chapter)n
(.)28 b(The)15 b(ne)o(xt)190 1009 y(chapter)f(describes)g(the)f(rest)g(of)g
(the)g Fp(CML)g Fu(structure,)h(which)f(e)o(xtends)g(the)g(basic)h
(concurrenc)o(y)g(model)f(with)f(\256rst-class)190 1068 y(synchronous)e
(operations.)190 1229 y Fm(2.1)58 b(Thr)o(eads)190 1353 y Fu(A)14
b Fr(CML)g Fu(program)f(consists)h(of)f(a)h(collection)f(of)g(threads)h
(running)e(\(logically)g(at)i(least\))g(in)f(parallel.)25 b(Scheduling)13
b(of)190 1413 y(threads)j(is)f(preempti)o(v)o(e,)i(so)e(threads)h(should)e
(not)g(share)i(mutable)g(data.)30 b(The)16 b(operations)f(on)g(threads)g(are)
h(gi)o(v)o(en)f(in)190 1472 y(\256gure)10 b(2.1.)15 b(Threads)10
b(are)g(dynamically)f(created)h(by)f(the)g Fp(spawn)g Fu(function,)f(which)h
(returns)g(the)g(unique)f(thread)h(identi\256er)253 1596 y
Fh(type)18 b(thread_id)253 1641 y(val)g(spawn)g(:)h(\(unit)f(->)h(unit\))e
(->)i(thread_id)253 1687 y(val)f(exit)g(:)h(unit)f(->)h('a)253
1733 y(val)f(getTid)f(:)j(unit)e(->)h(thread_i)o(d)253 1778
y(val)f(sameThread)e(:)j(\(thread_id)d(*)j(thread_id\))d(->)j(bool)253
1824 y(val)f(tidLessTha)o(n)e(:)k(\(thread_i)o(d)c(*)k(thread_id)o(\))c(->)j
(bool)253 1870 y(val)f(tidToStrin)o(g)e(:)k(thread_id)c(->)j(string)253
1915 y(val)f(yield)g(:)h(unit)f(->)h(unit)841 2048 y Fu(Figure)10
b(2.1:)15 b(Thread)10 b(operations)190 2158 y(\()p Fp(thread_id)p
Fu(\))15 b(of)h(the)h(ne)o(w)g(thread.)34 b(Thread)18 b(ids)e(can)h(be)g
(tested)g(for)f(equality)g(using)g(the)g Fp(sameThread)f Fu(function)190
2217 y(\()p Fp(thread_id)e Fu(is)h(not)f(an)i(equality)e(type\).)26
b(Certain)14 b(multi-thread)e(protocols)h(\(e.g.,)j([Bor86)o(]\))e(require)g
(some)h(method)190 2277 y(to)e(a)o(v)o(oid)g(c)o(yclic)h(dependencies)g(that)
e(can)i(lead)g(to)e(deadlock.)24 b(F)o(or)13 b(this)g(reason,)i(an)e
(abstract)g(ordering)f(is)h(de\256ned)h(on)190 2337 y Fp(thread_id)e
Fu(v)o(alues;)k(the)d(function)g Fp(tidLessThan)e Fu(tests)j(this)f(order)n
(.)25 b(A)14 b(string)f(representation)g(of)g(a)i(thread)f(id)f(can)190
2397 y(be)g(created)g(using)e Fp(tidToString)p Fu(.)18 b(A)12
b(thread)g(can)h(choose)f(to)f(relinquish)f(the)i(CPU)g(by)g(calling)f(the)h
Fp(yield)f Fu(function,)190 2457 y(which)f(forces)g(a)g(conte)o(xt)f(switch,)
h(b)o(ut,)f(since)h(scheduling)f(is)g(preempti)o(v)o(e,)h(this)f(should)f
(rarely)i(be)g(needed.)1773 2441 y Fo(2)1805 2457 y Fu(A)g(thread)f(id)190
2516 y(can)i(also)g(be)f(used)h(to)e(implement)h(a)h Fn(pr)n(ocess)g(join)e
Fu(using)h(the)g Fp(threadWait)e Fu(function)h(described)h(in)g(the)g(ne)o
(xt)g(chapter)n(.)p 190 2552 720 2 v 236 2579 a Fl(1)250 2591
y Fk(Note,)e(ho)o(we)o(ver)o(,)f(that)h(the)g(implementation)f(is)h(a)g
(shared-memory)e(model.)236 2620 y Fl(2)250 2632 y Fk(The)i
Fj(yield)f Fk(function)g(may)g(go)h(away)e(in)i(a)g(future)g(release.)1070
2799 y Fu(20)p eop
%%Page: 21 27
21 26 bop 33 82 a Fm(2.2)57 b(Channels)33 206 y Fu(Synchronous)11
b(communication)h(of)g(typed)f(channels)i(is)f(the)g(basis)g(of)g
Fr(CML)p Fu(')n(s)g(communication)g(and)g(synchronization)33
265 y(mechanism.)17 b(Figure)10 b(2.2)h(gi)o(v)o(es)f(the)h(basic)g
(operations)e(on)h(channels.)17 b(Ne)o(w)11 b(channels)g(are)g(dynamically)f
(created)i(using)95 389 y Fh(type)18 b('a)h(chan)95 434 y(val)f(channel)96
b(:)19 b(unit)f(->)h('1a)f(channel)95 480 y(val)g(sameChannel)e(:)j(\('a)f
(chan)g(*)i('a)f(chan\))e(->)i(bool)95 526 y(val)f(accept)116
b(:)19 b('a)g(chan)f(->)h('a)95 571 y(val)f(send)156 b(:)19
b(\('a)f(chan)g(*)i('a\))e(->)h(unit)673 704 y Fu(Figure)10
b(2.2:)k(Channel)c(operations)33 814 y(the)f Fp(channel)g Fu(function,)f
(which)h(is)h(a)g(weakly)g(polymorphic)e(function)g(\(like)g(the)i
Fp(ref)f Fu(constructor\).)14 b(T)m(wo)9 b(channels)h(can)33
874 y(be)g(tested)g(to)g(see)i(if)d(the)o(y)h(are)i(the)e(same)h(channel)g
(using)e(the)h(predicate)h Fp(sameChannel)p Fu(.)i(A)d(thread)g(can)h(read)g
(a)g(message)33 933 y(from)h(a)h(channel)g(using)f(the)g Fp(accept)f
Fu(function,)h(and)h(send)g(one)g(using)e Fp(send)p Fu(.)22
b(Message)14 b(passing)e(is)g(synchronous,)h(so)33 993 y(when)f(a)g(thread)g
(sends)g(a)g(message)i(on)e(a)g(channel,)h(it)e(must)h(wait)f(until)f
(another)i(thread)f(is)h(ready)g(to)g(accept)h(a)f(message)33
1053 y(from)e(that)f(channel.)912 2799 y(21)p eop
%%Page: 22 28
22 27 bop 190 414 a Fi(Chapter)20 b(3)190 643 y Fs(Ev)o(ents)190
889 y Fr(CML)f Fu(e)o(xtends)f(the)h(basic)g(synchronous)e(message)j(passing)
e(of)g(the)g(pre)o(vious)g(chapter)g(by)h(making)f(synchronous)190
949 y(operations)9 b(\256rst-class)h(v)o(alues)647 936 y Fo([Rep88)n(])742
949 y Fu(.)15 b(These)c(v)o(alues,)f(called)f Fn(e)o(vents)p
Fu(,)j(are)e(representations)f(of)g(synchronous)f(operations)190
1009 y(\(much)h(the)e(same)j(way)e(that)f(function)f(v)o(alues)i(represent)h
(computations\).)k(There)c(are)g(v)o(arious)e(functions)f(for)i(creating)g
(the)190 1068 y(basic)i(e)o(v)o(ent)g(v)o(alues,)g(as)g(well)f(as)h
(combinators)e(for)h(producing)f(more)i(comple)o(x)f(v)o(alues.)16
b(Figure)8 b(3.1)i(gi)o(v)o(es)f(the)g(signature)190 1128 y(of)h(the)g(e)o(v)
o(ent)h(operations)e(de\256ned)i(in)f(the)g Fp(CML)g Fu(structure.)k(The)d
(rest)f(of)g(this)g(chapter)g(will)f(discuss)i(these)f(operations.)253
1251 y Fh(val)18 b(sync)57 b(:)20 b('a)e(event)g(->)h('a)253
1297 y(val)f(select)f(:)j('a)e(event)g(list)g(->)h('a)253 1343
y(val)f(poll)57 b(:)20 b('a)e(event)g(->)h('a)g(option)253
1434 y(val)f(choose)115 b(:)20 b('a)f(event)e(list)h(->)h('a)g(event)253
1480 y(val)f(wrap)155 b(:)20 b(\('a)e(event)g(*)h(\('a)g(->)f('b\)\))g(->)h
('b)g(event)253 1525 y(val)f(wrapHandle)o(r)e(:)k(\('a)e(event)g(*)h(\(exn)f
(->)h('a\)\))f(->)h('a)g(event)253 1571 y(val)f(guard)135 b(:)20
b(\(unit)d(->)i('a)g(event\))e(->)i('a)g(event)253 1617 y(val)f(wrapAbort)55
b(:)20 b(\('a)e(event)g(*)h(\(unit)f(->)h(unit\)\))e(->)i('a)g(event)253
1708 y(val)f(always)96 b(:)19 b('a)g(->)g('a)g(event)253 1754
y(val)f(transmit)56 b(:)19 b(\('a)g(chan)f(*)h('a\))f(->)h(unit)f(event)253
1799 y(val)g(receive)76 b(:)19 b('a)g(chan)f(->)h('a)g(event)253
1845 y(val)f(threadWait)e(:)j(thread_id)d(->)j(unit)f(event)253
1891 y(val)g(timeout)76 b(:)19 b(time)f(->)h(unit)f(event)253
1936 y(val)g(waitUntil)36 b(:)19 b(time)f(->)h(unit)f(event)852
2069 y Fu(Figure)10 b(3.1:)k(Ev)o(ent)d(operations)190 2280
y Fm(3.1)58 b(Simple)16 b(e)o(v)o(ents)190 2403 y Fu(An)11
b(e)o(v)o(ent)h(v)o(alue)f(describes)h(a)f(potential)f(synchronous)g
(operation.)16 b(A)c(thread)f(can)g(synchronize)g(on)g(an)g(e)o(v)o(ent)h(v)o
(alue)f(by)190 2463 y(applying)h(the)h Fp(sync)f Fu(operation.)23
b(The)14 b(message)g(passing)f(model)g(of)g(the)g(pre)o(vious)f(section)h
(pro)o(vides)f(the)h(core)h(of)f(the)190 2523 y(e)o(v)o(ent)d(mechanism.)16
b(The)9 b(functions)f Fp(receive)f Fu(and)i Fp(transmit)e Fu(are)j(used)f(to)
f(b)o(uild)g(e)o(v)o(ent)h(v)o(alues)g(that)f(describe)h(channel)190
2583 y(I/O)h(operations.)k(These)e(can)f(be)f(used,)h(for)f(e)o(xample,)i(to)
e(de\256ne)g(the)g(operations)g Fp(accept)f Fu(and)h Fp(send)p
Fu(:)1070 2799 y(22)p eop
%%Page: 23 29
23 28 bop 95 82 a Fh(val)18 b(accept)g(=)h(sync)f(o)h(receive)95
128 y(val)f(send)58 b(=)19 b(sync)f(o)h(transmit)33 237 y Fu(The)8
b(e)o(v)o(ent)f(v)o(alues)h(b)o(uilt)d(by)i Fp(receive)f Fu(and)i
Fp(transmit)e Fu(are)i(called)f Fn(base)h(e)o(vent)g Fu(v)o(alues.)15
b(Another)6 b(base)i(e)o(v)o(ent)g(constructor)33 297 y(is)j
Fp(always)p Fu(,)h(which)f(produces)h(an)h(e)o(v)o(ent)f(that)f(is)h(always)f
(immediately)h(a)o(v)o(ailable)g(for)g(synchronization)e(and)i(produces)33
357 y(the)c(ar)o(gument)g(fed)h(to)e Fp(always)p Fu(.)14 b(The)9
b(base)g(e)o(v)o(ent)g(constructor)e Fp(waitUntil)f Fu(pro)o(vides)i(a)h
(mechanism)h(for)d(synchronizing)33 416 y(on)j(the)g(termination)e(of)i
(another)g(thread.)33 576 y Fm(3.2)57 b(Wrappers)33 700 y Fu(One)12
b(method)f(of)g(b)o(uilding)e(ne)o(w)j(e)o(v)o(ent)g(v)o(alues)g(from)f(base)
i(e)o(v)o(ents)f(is)f(to)g(wrap)h(a)g(post-synchronization)d(action)i(around)
33 759 y(the)f(e)o(v)o(ent.)15 b(F)o(or)c(e)o(xample,)h(we)e(can)h(turn)f(a)g
(channel)h(of)f(inte)o(gers)g(into)f(a)i(channel,)g Fp(ch)p
Fu(,)f(of)g(squares)h(by)95 854 y Fh(wrap)18 b(\(receive)f(ch,)h(fn)h(\(x)g
(:)g(int\))f(=>)h(x*x\))33 964 y Fu(When)11 b(synchronization)e(occurs)i(on)f
(this)g(e)o(v)o(ent,)i(the)e(v)o(alue)h(read)g(from)g Fp(ch)f
Fu(will)g(be)h(fed)g(to)f(the)g(function)f(and)i(its)f(square)33
1023 y(will)f(be)h(returned)g(as)h(the)f(synchronization)e(result.)95
1104 y(It)14 b(is)h(also)g(possible)f(to)g(wrap)h(an)h(e)o(xception)e
(handler)h(around)f(an)h(e)o(v)o(ent.)30 b(Building)12 b(on)j(our)f(pre)o
(vious)g(e)o(xample,)33 1164 y(consider)9 b(the)h(situation)d(in)j(which)f
(\252)p Fp(x*x)p Fu(\272)h(causes)h(an)f(inte)o(ger)f(o)o(v)o(er\257o)o(w)m
(.)16 b(The)10 b(follo)o(wing)e(e)o(v)o(ent)i(will)e(return)h(zero)h(in)f
(that)33 1223 y(case:)95 1318 y Fh(wrapHandl)o(er)16 b(\()134
1364 y(wrap)i(\(receive)f(ch,)h(fn)h(\(x)g(:)g(int\))f(=>)h(x*x\),)134
1410 y(fn)g(Overflow)e(=>)h(0\))33 1519 y Fu(The)c(function)e(that)i(is)f
(used)h(as)h(an)f(e)o(xception)g(handler)f(should)g(co)o(v)o(er)i(all)e(of)h
(the)g(possible)f(e)o(xceptions;)i(otherwise)e(a)33 1579 y
Fp(Match)c Fu(e)o(xception)h(can)h(occur)g(when)f(applying)f(the)h(handler)n
(.)33 1738 y Fm(3.3)57 b(Selecti)o(v)o(e)16 b(communication)33
1862 y Fu(Selecti)o(v)o(e)g(communication)f(is)h(necessary)h(for)e(threads)h
(to)f(manage)i(deadlock-free)f(communication)f(with)f(multiple)33
1922 y(partners.)g Fr(CML)9 b Fu(supports)f(selecti)o(v)o(e)h(communication)f
(in)h(an)g(e)o(xtremely)g(general)g(way)g(via)g(the)f Fp(choose)g
Fu(operator)n(.)14 b(This)33 1981 y(constructs)c(the)h(nondeterministic)e
(choice)i(of)g(a)g(list)f(of)h(e)o(v)o(ents.)18 b(F)o(or)11
b(e)o(xample,)h(a)g(thread)e(can)i(monitor)e(input)f(from)i(two)33
2041 y(channels)f(\(of)g(the)g(same)i(type\))e(as)g(follo)o(ws:)95
2136 y Fh(choose)17 b([)173 2182 y(receive)g(ch1,)173 2228
y(receive)g(ch2)134 2273 y(])33 2382 y Fu(Since)10 b(the)g(thread)g(is)g
(probably)f(interested)g(in)h(which)f(channel)i(a)f(message)i(is)e(from,)h
(wrappers)f(can)h(be)f(added)g(to)g(tag)g(the)33 2442 y(v)o(alues:)95
2537 y Fh(choose)17 b([)173 2583 y(wrap)h(\(receive)f(ch1,)h(fn)h(x)g(=>)g
(\(1,)f(x\)\),)173 2628 y(wrap)g(\(receive)f(ch2,)h(fn)h(x)g(=>)g(\(2,)f
(x\)\))134 2674 y(])912 2799 y Fu(23)p eop
%%Page: 24 30
24 29 bop 253 82 a Fu(W)m(e)10 b(can)h(mix)g(both)e(input)g(and)h(output)f
(operations)g(in)h(the)g(same)i Fp(choose)d Fu(e)o(xpression.)15
b(This)c(raises)g(the)f(question)f(of)190 142 y(what)h(happens)g(if)g(a)g
(thread)g(attempts)g(both)f(input)f(and)i(output)e(on)i(the)g(same)h(channel)
f(at)g(the)g(same)i(time?)j(F)o(or)10 b(e)o(xample:)253 242
y Fh(choose)17 b([)331 287 y(wrap)h(\(transmit\()o(ch,)e(1\),)i(fn)h(\(\))g
(=>)g(false\),)331 333 y(wrap)f(\(receive)f(ch,)h(fn)h(_)g(=>)g(true\))292
379 y(])190 492 y Fu(In)10 b Fr(CML)f Fu(synchronizing)g(on)g(this)g(e)o(v)o
(ent)h(v)o(alue)g(will)e(block)h(the)h(thread)f(until)f(another)i(thread)f
(either)g(sends)i(or)e(accepts)i(a)190 552 y(message)i(on)e
Fp(ch)p Fu(.)18 b(The)12 b(thread)f(does)g(not)f(communicate)i(with)e
(itself.)17 b(If)11 b(a)h(thread)f(synchronizes)g(on)g(the)g(empty)g(choice)
190 612 y(\(i.e.,)h Fp(choose[])p Fu(\),)d(then)g(it)h(will)f(block)h(fore)o
(v)o(er)g(\(actually)g(it)f(will)g(be)i(garbage)f(collected\).)253
692 y(The)h(operation)e Fp(select)g Fu(pro)o(vides)h(a)g(useful)g(short-hand)
f(for)h(a)h(common)f Fr(CML)h Fu(idiom.)j(It)c(is)g(de\256ned)g(as)253
792 y Fh(val)18 b(select)f(=)j(sync)e(o)h(choose)190 986 y
Fm(3.4)58 b(Adv)o(anced)16 b(e)o(v)o(ent)f(pr)o(ogramming)190
1110 y Fu(The)g Fp(guard)e Fu(and)h Fp(wrapAbort)e Fu(combinators)i(are)g
(used)g(for)g(implementing)f(comple)o(x)h(client-serv)o(er)g(protocols.)25
b(The)190 1169 y Fp(guard)11 b Fu(function)g(acts)h(as)h(a)f(delay)g
(operator)f(when)h(applied)f(to)h(an)g(e)o(v)o(ent)g(v)o(alued)g(function;)e
(when)i Fp(sync)f Fu(is)h(applied)f(to)190 1229 y(the)h(guarded)f(e)o(v)o
(ent,)i(the)f(delayed)g(function)e(is)h(e)o(v)o(aluated,)i(and)f(its)f
(result)g(is)g(used)h(for)g(synchronization.)17 b(As)12 b(a)h(simple)190
1289 y(e)o(xample)f(of)e Fp(guard)p Fu(,)f(a)i(conditional)d(e)o(v)o(ent)j
(constructor)e(can)i(be)g(implemented:)253 1389 y Fh(fun)18
b(condEvt)f(\(pred,)g(evt\))h(=)i(guard)d(\(fn)i(\(\))g(=>)f(if)h(pred\(\))f
(then)g(evt)g(else)g(choose[]\);)190 1502 y Fu(This)c(takes)f(a)i(boolean)e
(v)o(alued)g(predicate)h(and)f(an)h(e)o(v)o(ent)g(v)o(alue;)h(when)f
Fp(sync)e Fu(is)i(applied)f(to)g(the)g(guarded)h(e)o(v)o(ent,)h(the)190
1562 y(predicate)8 b(is)g(e)o(v)o(aluated)f(and,)i(if)e(true,)h(then)f
Fp(evt)g Fu(is)h(returned,)g(otherwise)f(the)g(null)g(e)o(v)o(ent)g(is)h
(returned.)14 b(A)7 b(more)h(typical)f(use)190 1622 y(of)j
Fp(guard)f Fu(is)h(to)f(initiate)f(a)j(transaction)e(with)g(a)h(serv)o(er)h
(while)f(returning)e(an)i(e)o(v)o(ent)g(to)g(synchronize)f(on)h(the)g
(transaction')n(s)190 1682 y(completion;)f(section)h(1.8)g(gi)o(v)o(es)h(se)o
(v)o(eral)g(e)o(xamples)h(of)d(this.)253 1762 y(Sometimes,)i(when)e
Fp(guard)g Fu(is)h(being)f(used)h(to)f(initiate)g(a)h(transaction,)g(it)f(is)
g(necessary)i(for)f(the)f(serv)o(er)i(to)e(be)i(noti\256ed)190
1822 y(if)h(the)f(transaction)g(will)g(not)g(complete)h(\(i.e.,)h(because)h
(a)e(dif)o(ferent)f(e)o(v)o(ent)h(in)f(a)i(select)f(communication)f(was)h
(selected\).)190 1882 y(The)j Fp(wrapAbort)d Fu(combinator)i(pro)o(vides)f
(this)g(mechanism.)28 b(It)13 b(associates)i(a)g Fn(abort)e
Fu(function)g(with)f(an)j(e)o(v)o(ent)f(v)o(alue.)190 1941
y(When)d(the)e(e)o(v)o(ent)i(v)o(alue)f(is)f(in)n(v)o(olv)o(ed)h(in)f(a)i
(selecti)o(v)o(e)f(communication,)g(if)f(a)i(dif)o(ferent)e(e)o(v)o(ent)h(is)
g(chosen,)h(then)e(a)i(thread)f(is)190 2001 y(spa)o(wned)h(to)f(e)o(v)o
(aluate)h(the)f(abort)f(function.)190 2107 y Fr(Example)h(3.1)190
2187 y Fu(W)m(e)h(can)g(illustrate)e(the)h(semantics)h(of)f
Fp(guard)f Fu(and)i Fp(wrapAbort)d Fu(with)h(the)h(follo)o(wing)e(v)o
(ariation)h(of)h(Example)h(1.5.)1070 2799 y(24)p eop
%%Page: 25 31
25 30 bop 95 82 a Fh(fun)18 b(simple_comm)o(3)e(\(\))j(=)g(let)213
128 y(val)f(ch1)h(=)g(channel\(\))d(and)i(ch2)h(=)g(channel\(\))213
174 y(val)f(pr)h(=)g(CIO.print)213 219 y(in)252 265 y(pr)g("hi-0\\n";)252
310 y(spawn)f(\(fn)g(\(\))h(=>)g(\(pr)f("hi-1\\n";)36 b(send\(ch1,)16
b(17\);)38 b(pr)19 b("bye-1\\n)o("\)\))o(;)252 356 y(spawn)f(\(fn)g(\(\))h
(=>)g(\(pr)f("hi-2\\n";)36 b(send\(ch2,)16 b(37\);)38 b(pr)19
b("bye-2\\n)o("\)\))o(;)252 402 y(select)e([)291 447 y(guard)h(\(fn)g(\(\))h
(=>)g(\()330 493 y(pr)g("guard-0.1)o(\\n)o(";)330 539 y(wrapAbort)d(\(wrap)i
(\(receive)f(ch1,)h(fn)h(_)g(=>)g(pr)f("bye-0.1\\n")o(\),)370
584 y(fn)g(\(\))h(=>)g(pr)g("abort-0.)o(1\\n)o("\))o(\)\),)291
630 y(guard)f(\(fn)g(\(\))h(=>)g(\()330 676 y(pr)g("guard-0.2)o(\\n)o(";)330
721 y(wrapAbort)d(\(wrap)i(\(receive)f(ch2,)h(fn)h(_)g(=>)g(pr)f
("bye-0.2\\n")o(\),)370 767 y(fn)g(\(\))h(=>)g(pr)g("abort-0.)o(2\\n)o("\))o
(\)\))252 813 y(])213 858 y(end)33 965 y Fu(The)9 b(observ)o(ational)f(beha)o
(vior)h(of)g(this)f(program)h(\256ts)g(one)g(of)g(two)f(graphs,)h(depending)g
(on)f(the)h(non-deterministic)e(choice)33 1024 y(made)k(by)f(the)g(parent)g
(thread:)172 1664 y @beginspecial 35 @llx 35 @lly 199 @urx
176 @ury 1620 @rwi @setspecial
%%BeginDocument: simple-comm3a.ps
/coord-font-family /Times-Roman def
/node-font-family /Times-Roman def
/edge-font-family /Times-Roman def
/coordfont coord-font-family findfont 6 scalefont def

/set_font {
	findfont exch
	dup /dag_font_size exch def
	dup .8 mul /hack_font_size exch def
	scalefont setfont
} def

/setdagcolor {aload pop sethsbcolor} bind def

/dagalignedlabel {		% alignfactor height width name
	/alignfactor exch def
	/height exch def
	/width exch def
	/nodename exch def
	gsave
		currentpoint newpath moveto
		nodename stringwidth pop
		alignfactor mul hack_font_size  -.5 mul rmoveto
		nodename show
	grestore
} bind def

/daglabel {
	-.5 dagalignedlabel
} bind def

/midpoint {
	exch 4 -1 roll add 2 div
	3 1 roll add 2 div
} bind def

/arrowhead {
	gsave
	rotate
	currentpoint
	newpath
		moveto
		arrowlength arrowwidth 2 div rlineto
		0 arrowwidth neg rlineto
	closepath fill
	grestore
} bind def

/makearrow {
	currentpoint exch pop sub exch currentpoint pop sub atan
	arrowhead
} bind def


/Box {
	/height exch def
	/width exch def
	/nodename exch def
	currentpoint 2 copy
	newpath
		moveto
		width -2 div
		height -2 div
		rmoveto
		width 0 rlineto
		0 height rlineto
		width neg 0 rlineto
	closepath
	stroke
	moveto 
	nodename width .9 mul height .9 mul daglabel
} bind def

/Box_clip {	% height width x0 y0 x1 y1 -> x1 y1
	6 2 roll
	pop pop pop pop
} bind def

/Square {
	2 copy
	gt {exch pop dup} {pop dup} ifelse
	Box
} bind def

/Square_clip {
	Box_clip
} bind def

/Plaintext {
	daglabel
} bind def

/Plaintext_clip {
	Box_clip
} bind def


/Diamond {
	/height exch def
	/width exch def
	/nodename exch def
	/hh height 2 div def
	/hw width 2 div def
	currentpoint 2 copy
	newpath
		moveto
		0 hh neg rmoveto
		hw hh rlineto
		hw neg hh rlineto
		hw neg hh neg rlineto
	closepath
	stroke
	moveto 
	nodename width .9 mul height .9 mul daglabel
} bind def

/between {
	sub 3 1 roll sub mul 0 ge
} bind def

/seginter { % x2 y2 x3 y3 -> false  OR  xinter yinter true
	% use x0 y0 x1 y1 of current dict
	/y3 exch def
	/x3 exch def
	/y2 exch def
	/x2 exch def
	x0 x1 ne x2 x3 ne or
	{
		x2 x3 eq {	/x2 x0 /x0 x2 def def
				/y2 y0 /y0 y2 def def
				/x1 x3 /x3 x1 def def
				/y1 y3 /y3 y1 def def
		} if

		x0 x1 eq {
			/x x0 def false
		} 
		{
			/m0 y1 y0 sub x1 x0 sub div def
			/b0 y0 m0 x0 mul sub def
			/m1 y3 y2 sub x3 x2 sub div def
			/b1 y2 m1 x2 mul sub def
			m1 m0 eq {
				b0 b1 ne {false} 
				{	/l0lowx x0 x1 min def
				 	/l0highx x0 x1 max def
					/l1lowx x2 x3 min def
					/l1highx x2 x3 max def
					l0lowx l1lowx dup l0highx between
					{/x l1lowx def true}
					{
						l0lowx l1highx dup l0highx between
						{/x l1highx def true}
						{
							l1lowx l0lowx dup l1highx between
							{/x l0lowx def true}
							{false} ifelse
						} ifelse
					} ifelse
				} ifelse
			}
			{
				/x b1 b0 sub m0 m1 sub div def true
			} ifelse
		} ifelse
		{
			x2 x x x3 between
			{
				y2 m1 x mul b1 add dup y3 between
				{
					x
					m1 x mul b1 add 
					true
				}
				{
					false
				} ifelse
			}
			{ false } ifelse
		}
		{false} ifelse
	}
	{false} ifelse
} bind def

/Diamond_clip {
	/y1 exch def
	/x1 exch def
	/y0 exch def
	/x0 exch def
	2 div /height2 exch def
	2 div /width2  exch def
	x0 x1 eq y0 y1 eq and {x1 y1} {
		x0 0 ge y0 0 ge and {
			width2 0 0 height2 seginter
		}
		{
			x0 0 le y0 0 ge and {
				0 height2 width2 neg 0 seginter
			}
			{
				x0 0 le y0 0 le and {
					width2 neg 0 0 height2 neg seginter
				}
				{
					0 height2 neg width2 0 seginter
				} ifelse
			} ifelse
		} ifelse
		not {x1 y1} if
	} ifelse
} bind def

/Triangle {
	/y exch def
	/x exch def
	/nodename exch def
	/x2 x 2 div def
	/y2 y 2 div def
	currentpoint 
	x2 neg y2 2 div neg rmoveto x 0 rlineto x2 neg y 3 mul 4 div rlineto
	closepath stroke
	moveto nodename x y daglabel
} bind def

/Triangle_clip {
	/y1 exch def
	/x1 exch def
	/y0 exch def
	/x0 exch def
	/height exch def
	/width  exch def
	y0 height 4 div neg lt		% base
	{
		x0 x1 eq {
			x1 height 4 div neg
		}
		{
			width 2 div neg height 4 div neg width 2 div height 4 div neg
			seginter not
			{
				x1 0 gt {width 2 div}{width 2 div neg} ifelse
				height 4 div neg
			} if
		} ifelse
	}
	{
		%take one side or the other
		x1 0 gt {width 2 div}{width 2 div neg} ifelse	
		height 4 div neg					
		0 height 2 div			% the apex vertex
		seginter not
		{0 height 2 div} if		% return apex if it missed
	} ifelse
} bind def

/Circle {
	/y exch def
	/x exch def
	/nodename exch def
	currentpoint 2 copy 2 copy
	newpath
	moveto
	/rad x y lt {x} {y} ifelse 2 div def
	rad 0 rmoveto
	rad 0 360 arc stroke
	moveto
	nodename x .85 mul y .85 mul daglabel
} bind def

/Circle_clip {
	Ellipse_clip
} bind def

/Doublecircle {
	/height exch def
	/width exch def
	/nodename exch def
	currentpoint 2 copy 2 copy 2 copy
	newpath
	moveto
	width height lt {width} {height} ifelse
	2 div /rad exch def
	rad 0 rmoveto
	rad 0 360 arc stroke
	rad .9 mul 0 360 arc stroke
	moveto
	nodename width .85 mul height .85 mul daglabel
} bind def

/Doublecircle_clip {
	Circle_clip
} bind def

/Ellipse {
	/height exch def
	/width exch def
	/nodename exch def
	currentpoint			% save for label
	% distort user space
	gsave
		currentpoint translate
		0 0 moveto
		matrix currentmatrix		% save it
		width height div 1 scale	% scale in x
		height 2 div 0 rmoveto
		newpath 0 0 height 2 div 0 360 arc
		setmatrix					% restore
		stroke
	grestore
	moveto nodename width .9 mul height .9 mul daglabel
} bind def

/Ellipse_clip {
	/y1 exch def
	/x1 exch def
	/y0 exch def
	/x0 exch def
	2 div /ry exch def
	2 div /rx exch def
	x0 x1 eq 
	{	% degenerate case
		x1 y1
	} 
	{	% normal case
		{
			/gotanswer false def
			/m y1 y0 sub x1 x0 sub div def	% m = (y1 - y0)/(x1 - x0);
			/b y0 x0 m mul sub def		% b = y0 - m * x0
			% aa = 1/(rx*rx)+ (m*m)/(ry*ry);
			/aa 1 rx rx mul div m m mul ry ry mul div add def
			% bb = (2*m*b)/(ry*ry);
			/bb 2 m b mul mul ry ry mul div def 
			% cc = (b*b)/(ry*ry) - 1;
			/cc b b mul ry ry mul div 1 sub def
			m 0 eq {
				/s0 rx def
				/s1 rx neg def
				/gotanswer true def
			}
			{
				% t = b^2 - 4ac
				/t bb bb mul 4 aa cc mul mul sub def
				t 0 lt {
					x1 y1
					exit
				}
				{
					/s0 bb neg t sqrt add 2 aa mul div def
					/s1 bb neg t sqrt sub 2 aa mul div def
					/gotanswer true def
				} ifelse
			} ifelse
			gotanswer {
				% by here, s0 and s1 are set.
				s0 x0 sub abs s1 x0 sub abs le {s0} {s1} ifelse
				dup m mul b add
				exit
			} if
		} loop
	} ifelse
} bind def

/white		[0 0 1]	def
/black		[1 1 0]	def
/red		[0 1 1]	def
/green		[.333 1 1]	def
/blue		[.667 1 1]	def
/yellow		[.167 1 1]	def
/magenta	[.833 1 1]	def
/cyan		[.500 1 1]	def
save
/DagDict 200 dict def
DagDict begin
0.553 0.553 scale
/arrowlength 7 def
/arrowwidth arrowlength 2 div def
/node-font-family /Courier def
save
64 64 moveto 296 0 rlineto 0 255 rlineto -296 0 rlineto closepath clip newpath
65 65 translate
14 node-font-family set_font
144 234 moveto
(hi-0) 54 36 Ellipse
33 162 moveto
(hi-1) 54 36 Ellipse
144 162 moveto
(guard-0.1) 96 36 Ellipse
237 162 moveto
(hi-2) 54 36 Ellipse
33 18 moveto
(bye-1) 65 36 Ellipse
144 18 moveto
(bye-0.1) 79 36 Ellipse
144 90 moveto
(guard-0.2) 96 36 Ellipse
247 18 moveto
(abort-0.2) 92 36 Ellipse
237 90 moveto
() 54 36 Plaintext
[] 0 setdash
14 edge-font-family set_font
[9 9 idtransform abs ceiling exch abs ceiling exch] 0 setdash
newpath  54 36 -85 -54 -27 -13 Ellipse_clip
234 add exch 144 add exch
moveto
 88 200 lineto
 54 36 84 59 26 18 Ellipse_clip
162 add exch 33 add exch
lineto currentpoint stroke moveto
88 200 makearrow
stroke
[] 0 setdash
newpath  54 36 0 -54 0 -18 Ellipse_clip
234 add exch 144 add exch
moveto
 144 198 lineto
 96 36 0 54 0 18 Ellipse_clip
162 add exch 144 add exch
lineto currentpoint stroke moveto
144 198 makearrow
stroke
[9 9 idtransform abs ceiling exch abs ceiling exch] 0 setdash
newpath  54 36 72 -54 27 -16 Ellipse_clip
234 add exch 144 add exch
moveto
 193 199 lineto
 54 36 -66 56 -21 18 Ellipse_clip
162 add exch 237 add exch
lineto currentpoint stroke moveto
193 199 makearrow
stroke
[] 0 setdash
newpath  54 36 0 -126 0 -18 Ellipse_clip
162 add exch 33 add exch
moveto
 33 90 lineto
 65 36 0 126 0 18 Ellipse_clip
18 add exch 33 add exch
lineto currentpoint stroke moveto
33 90 makearrow
stroke
[1 6 idtransform abs ceiling exch abs ceiling exch] 0 setdash
newpath  54 36 28 -54 12 -18 Ellipse_clip
162 add exch 33 add exch
moveto
 53 126 lineto
61 108 2 copy 64 99 curveto
68 91 2 copy 71 83 curveto
74 75 2 copy 85 69 curveto
96 63 2 copy 110 49 curveto
 79 36 -48 45 -19 18 Ellipse_clip
18 add exch 144 add exch
lineto currentpoint stroke moveto
110 49 makearrow
stroke
[] 0 setdash
newpath  96 36 0 -54 0 -18 Ellipse_clip
162 add exch 144 add exch
moveto
 144 126 lineto
 96 36 0 54 0 18 Ellipse_clip
90 add exch 144 add exch
lineto currentpoint stroke moveto
144 126 makearrow
stroke
[9 9 idtransform abs ceiling exch abs ceiling exch] 0 setdash
newpath  96 36 80 -54 34 -18 Ellipse_clip
90 add exch 144 add exch
moveto
 201 54 lineto
 92 36 -69 54 -23 18 Ellipse_clip
18 add exch 247 add exch
lineto currentpoint stroke moveto
201 54 makearrow
stroke
[] 0 setdash
newpath  96 36 0 -54 0 -18 Ellipse_clip
90 add exch 144 add exch
moveto
 144 54 lineto
 79 36 0 54 0 18 Ellipse_clip
18 add exch 144 add exch
lineto currentpoint stroke moveto
144 54 makearrow
stroke
showpage
restore
end
restore
%%EndDocument
 @endspecial 846 w @beginspecial 35 @llx 35 @lly 199 @urx 176
@ury 1620 @rwi @setspecial
%%BeginDocument: simple-comm3b.ps
/coord-font-family /Times-Roman def
/node-font-family /Times-Roman def
/edge-font-family /Times-Roman def
/coordfont coord-font-family findfont 6 scalefont def

/set_font {
	findfont exch
	dup /dag_font_size exch def
	dup .8 mul /hack_font_size exch def
	scalefont setfont
} def

/setdagcolor {aload pop sethsbcolor} bind def

/dagalignedlabel {		% alignfactor height width name
	/alignfactor exch def
	/height exch def
	/width exch def
	/nodename exch def
	gsave
		currentpoint newpath moveto
		nodename stringwidth pop
		alignfactor mul hack_font_size  -.5 mul rmoveto
		nodename show
	grestore
} bind def

/daglabel {
	-.5 dagalignedlabel
} bind def

/midpoint {
	exch 4 -1 roll add 2 div
	3 1 roll add 2 div
} bind def

/arrowhead {
	gsave
	rotate
	currentpoint
	newpath
		moveto
		arrowlength arrowwidth 2 div rlineto
		0 arrowwidth neg rlineto
	closepath fill
	grestore
} bind def

/makearrow {
	currentpoint exch pop sub exch currentpoint pop sub atan
	arrowhead
} bind def


/Box {
	/height exch def
	/width exch def
	/nodename exch def
	currentpoint 2 copy
	newpath
		moveto
		width -2 div
		height -2 div
		rmoveto
		width 0 rlineto
		0 height rlineto
		width neg 0 rlineto
	closepath
	stroke
	moveto 
	nodename width .9 mul height .9 mul daglabel
} bind def

/Box_clip {	% height width x0 y0 x1 y1 -> x1 y1
	6 2 roll
	pop pop pop pop
} bind def

/Square {
	2 copy
	gt {exch pop dup} {pop dup} ifelse
	Box
} bind def

/Square_clip {
	Box_clip
} bind def

/Plaintext {
	daglabel
} bind def

/Plaintext_clip {
	Box_clip
} bind def


/Diamond {
	/height exch def
	/width exch def
	/nodename exch def
	/hh height 2 div def
	/hw width 2 div def
	currentpoint 2 copy
	newpath
		moveto
		0 hh neg rmoveto
		hw hh rlineto
		hw neg hh rlineto
		hw neg hh neg rlineto
	closepath
	stroke
	moveto 
	nodename width .9 mul height .9 mul daglabel
} bind def

/between {
	sub 3 1 roll sub mul 0 ge
} bind def

/seginter { % x2 y2 x3 y3 -> false  OR  xinter yinter true
	% use x0 y0 x1 y1 of current dict
	/y3 exch def
	/x3 exch def
	/y2 exch def
	/x2 exch def
	x0 x1 ne x2 x3 ne or
	{
		x2 x3 eq {	/x2 x0 /x0 x2 def def
				/y2 y0 /y0 y2 def def
				/x1 x3 /x3 x1 def def
				/y1 y3 /y3 y1 def def
		} if

		x0 x1 eq {
			/x x0 def false
		} 
		{
			/m0 y1 y0 sub x1 x0 sub div def
			/b0 y0 m0 x0 mul sub def
			/m1 y3 y2 sub x3 x2 sub div def
			/b1 y2 m1 x2 mul sub def
			m1 m0 eq {
				b0 b1 ne {false} 
				{	/l0lowx x0 x1 min def
				 	/l0highx x0 x1 max def
					/l1lowx x2 x3 min def
					/l1highx x2 x3 max def
					l0lowx l1lowx dup l0highx between
					{/x l1lowx def true}
					{
						l0lowx l1highx dup l0highx between
						{/x l1highx def true}
						{
							l1lowx l0lowx dup l1highx between
							{/x l0lowx def true}
							{false} ifelse
						} ifelse
					} ifelse
				} ifelse
			}
			{
				/x b1 b0 sub m0 m1 sub div def true
			} ifelse
		} ifelse
		{
			x2 x x x3 between
			{
				y2 m1 x mul b1 add dup y3 between
				{
					x
					m1 x mul b1 add 
					true
				}
				{
					false
				} ifelse
			}
			{ false } ifelse
		}
		{false} ifelse
	}
	{false} ifelse
} bind def

/Diamond_clip {
	/y1 exch def
	/x1 exch def
	/y0 exch def
	/x0 exch def
	2 div /height2 exch def
	2 div /width2  exch def
	x0 x1 eq y0 y1 eq and {x1 y1} {
		x0 0 ge y0 0 ge and {
			width2 0 0 height2 seginter
		}
		{
			x0 0 le y0 0 ge and {
				0 height2 width2 neg 0 seginter
			}
			{
				x0 0 le y0 0 le and {
					width2 neg 0 0 height2 neg seginter
				}
				{
					0 height2 neg width2 0 seginter
				} ifelse
			} ifelse
		} ifelse
		not {x1 y1} if
	} ifelse
} bind def

/Triangle {
	/y exch def
	/x exch def
	/nodename exch def
	/x2 x 2 div def
	/y2 y 2 div def
	currentpoint 
	x2 neg y2 2 div neg rmoveto x 0 rlineto x2 neg y 3 mul 4 div rlineto
	closepath stroke
	moveto nodename x y daglabel
} bind def

/Triangle_clip {
	/y1 exch def
	/x1 exch def
	/y0 exch def
	/x0 exch def
	/height exch def
	/width  exch def
	y0 height 4 div neg lt		% base
	{
		x0 x1 eq {
			x1 height 4 div neg
		}
		{
			width 2 div neg height 4 div neg width 2 div height 4 div neg
			seginter not
			{
				x1 0 gt {width 2 div}{width 2 div neg} ifelse
				height 4 div neg
			} if
		} ifelse
	}
	{
		%take one side or the other
		x1 0 gt {width 2 div}{width 2 div neg} ifelse	
		height 4 div neg					
		0 height 2 div			% the apex vertex
		seginter not
		{0 height 2 div} if		% return apex if it missed
	} ifelse
} bind def

/Circle {
	/y exch def
	/x exch def
	/nodename exch def
	currentpoint 2 copy 2 copy
	newpath
	moveto
	/rad x y lt {x} {y} ifelse 2 div def
	rad 0 rmoveto
	rad 0 360 arc stroke
	moveto
	nodename x .85 mul y .85 mul daglabel
} bind def

/Circle_clip {
	Ellipse_clip
} bind def

/Doublecircle {
	/height exch def
	/width exch def
	/nodename exch def
	currentpoint 2 copy 2 copy 2 copy
	newpath
	moveto
	width height lt {width} {height} ifelse
	2 div /rad exch def
	rad 0 rmoveto
	rad 0 360 arc stroke
	rad .9 mul 0 360 arc stroke
	moveto
	nodename width .85 mul height .85 mul daglabel
} bind def

/Doublecircle_clip {
	Circle_clip
} bind def

/Ellipse {
	/height exch def
	/width exch def
	/nodename exch def
	currentpoint			% save for label
	% distort user space
	gsave
		currentpoint translate
		0 0 moveto
		matrix currentmatrix		% save it
		width height div 1 scale	% scale in x
		height 2 div 0 rmoveto
		newpath 0 0 height 2 div 0 360 arc
		setmatrix					% restore
		stroke
	grestore
	moveto nodename width .9 mul height .9 mul daglabel
} bind def

/Ellipse_clip {
	/y1 exch def
	/x1 exch def
	/y0 exch def
	/x0 exch def
	2 div /ry exch def
	2 div /rx exch def
	x0 x1 eq 
	{	% degenerate case
		x1 y1
	} 
	{	% normal case
		{
			/gotanswer false def
			/m y1 y0 sub x1 x0 sub div def	% m = (y1 - y0)/(x1 - x0);
			/b y0 x0 m mul sub def		% b = y0 - m * x0
			% aa = 1/(rx*rx)+ (m*m)/(ry*ry);
			/aa 1 rx rx mul div m m mul ry ry mul div add def
			% bb = (2*m*b)/(ry*ry);
			/bb 2 m b mul mul ry ry mul div def 
			% cc = (b*b)/(ry*ry) - 1;
			/cc b b mul ry ry mul div 1 sub def
			m 0 eq {
				/s0 rx def
				/s1 rx neg def
				/gotanswer true def
			}
			{
				% t = b^2 - 4ac
				/t bb bb mul 4 aa cc mul mul sub def
				t 0 lt {
					x1 y1
					exit
				}
				{
					/s0 bb neg t sqrt add 2 aa mul div def
					/s1 bb neg t sqrt sub 2 aa mul div def
					/gotanswer true def
				} ifelse
			} ifelse
			gotanswer {
				% by here, s0 and s1 are set.
				s0 x0 sub abs s1 x0 sub abs le {s0} {s1} ifelse
				dup m mul b add
				exit
			} if
		} loop
	} ifelse
} bind def

/white		[0 0 1]	def
/black		[1 1 0]	def
/red		[0 1 1]	def
/green		[.333 1 1]	def
/blue		[.667 1 1]	def
/yellow		[.167 1 1]	def
/magenta	[.833 1 1]	def
/cyan		[.500 1 1]	def
save
/DagDict 200 dict def
DagDict begin
0.553 0.553 scale
/arrowlength 7 def
/arrowwidth arrowlength 2 div def
/node-font-family /Courier def
save
64 64 moveto 296 0 rlineto 0 255 rlineto -296 0 rlineto closepath clip newpath
65 65 translate
14 node-font-family set_font
149 234 moveto
(hi-0) 54 36 Ellipse
56 162 moveto
(hi-1) 54 36 Ellipse
149 162 moveto
(guard-0.1) 96 36 Ellipse
260 162 moveto
(hi-2) 54 36 Ellipse
149 18 moveto
(bye-0.2) 79 36 Ellipse
260 18 moveto
(bye-2) 65 36 Ellipse
149 90 moveto
(guard-0.2) 96 36 Ellipse
46 18 moveto
(abort-0.1) 92 36 Ellipse
56 90 moveto
() 54 36 Plaintext
[] 0 setdash
14 edge-font-family set_font
[9 9 idtransform abs ceiling exch abs ceiling exch] 0 setdash
newpath  54 36 -72 -54 -27 -16 Ellipse_clip
234 add exch 149 add exch
moveto
 99 199 lineto
 54 36 66 56 21 18 Ellipse_clip
162 add exch 56 add exch
lineto currentpoint stroke moveto
99 199 makearrow
stroke
[] 0 setdash
newpath  54 36 0 -54 0 -18 Ellipse_clip
234 add exch 149 add exch
moveto
 149 198 lineto
 96 36 0 54 0 18 Ellipse_clip
162 add exch 149 add exch
lineto currentpoint stroke moveto
149 198 makearrow
stroke
[9 9 idtransform abs ceiling exch abs ceiling exch] 0 setdash
newpath  54 36 85 -54 27 -13 Ellipse_clip
234 add exch 149 add exch
moveto
 205 200 lineto
 54 36 -84 59 -26 18 Ellipse_clip
162 add exch 260 add exch
lineto currentpoint stroke moveto
205 200 makearrow
stroke
[] 0 setdash
newpath  96 36 0 -54 0 -18 Ellipse_clip
162 add exch 149 add exch
moveto
 149 126 lineto
 96 36 0 54 0 18 Ellipse_clip
90 add exch 149 add exch
lineto currentpoint stroke moveto
149 126 makearrow
stroke
[1 6 idtransform abs ceiling exch abs ceiling exch] 0 setdash
newpath  54 36 -25 -54 -12 -18 Ellipse_clip
162 add exch 260 add exch
moveto
 241 126 lineto
235 108 2 copy 231 99 curveto
227 91 2 copy 223 83 curveto
219 75 2 copy 195 55 curveto
 79 36 70 57 22 18 Ellipse_clip
18 add exch 149 add exch
lineto currentpoint stroke moveto
195 55 makearrow
stroke
[] 0 setdash
newpath  54 36 0 -126 0 -18 Ellipse_clip
162 add exch 260 add exch
moveto
 260 90 lineto
 65 36 0 126 0 18 Ellipse_clip
18 add exch 260 add exch
lineto currentpoint stroke moveto
260 90 makearrow
stroke
[9 9 idtransform abs ceiling exch abs ceiling exch] 0 setdash
newpath  96 36 -80 -54 -34 -18 Ellipse_clip
90 add exch 149 add exch
moveto
 92 54 lineto
 92 36 69 54 23 18 Ellipse_clip
18 add exch 46 add exch
lineto currentpoint stroke moveto
92 54 makearrow
stroke
[] 0 setdash
newpath  96 36 0 -54 0 -18 Ellipse_clip
90 add exch 149 add exch
moveto
 149 54 lineto
 79 36 0 54 0 18 Ellipse_clip
18 add exch 149 add exch
lineto currentpoint stroke moveto
149 54 makearrow
stroke
showpage
restore
end
restore
%%EndDocument
 @endspecial 33 1771 a(These)16 b(graphs)g(illustrate)e(the)h(complementary)h
(relationship)d(between)j(the)g(abort)e(actions)i(and)f(wrapper)h(functions.)
33 1830 y(Note)10 b(that)f(the)h(guards)h(are)g(always)e(e)o(v)o(aluated)i
(in)e(left-to-right)f(order)n(,)i(although)f(depending)g(on)h(this)f(is)h
(bad)h(style.)33 1990 y Fm(3.5)57 b(P)o(olling)15 b(and)g(timeouts)33
2113 y Fu(While)10 b(selecti)o(v)o(e)i(communication)e(pro)o(vides)g(a)h
(great)g(deal)g(of)g(\257e)o(xibility)e(in)h(scheduling)g(thread)g
(communication,)h(it)f(is)33 2173 y(sometimes)h(useful)e(to)h(use)h(polling.)
i Fr(CML)d Fu(pro)o(vides)g(two)f(mechanisms)j(for)d(polling)f(e)o(v)o(ent)j
(v)o(alues.)95 2253 y(The)h(operation)e Fp(poll)h Fu(is)g(a)h(non-blocking)d
(form)i(of)g Fp(sync)p Fu(;)f(it)h(returns)g Fp(NONE)f Fu(instead)h(of)g
(blocking.)1580 2238 y Fo(1)1614 2253 y Fu(F)o(or)g(e)o(xample,)33
2313 y(the)f(e)o(xpression)95 2405 y Fh(poll)18 b(\(receive)f(ch\))33
2512 y Fu(will)6 b(return)h Fp(SOME)21 b Fq(msg)q Fu(,)10 b(if)d(a)h(message)
h Fq(msg)h Fu(is)d(a)o(v)o(ailable)h(on)f(the)h(channel,)g(otherwise)f(it)g
(returns)g Fp(NONE)p Fu(.)g(The)i(e)o(xpression)95 2604 y Fh(poll)18
b(\(transmit)e(\(ch,)i(msg\)\))p 33 2635 720 2 v 78 2662 a
Fl(1)92 2674 y Fk(In)8 b(version)f(0.9.3)h(and)f(earlier)o(,)h
Fj(poll)f Fk(was)h(an)f(e)o(vent)g(v)o(alue)g(constructor)n(.)912
2799 y Fu(25)p eop
%%Page: 26 32
26 31 bop 190 82 a Fu(is)10 b(a)h Fn(conditional)d Fu(send,)j(which)e
(returns)h Fp(SOME\(\))f Fu(if)h(successful.)16 b(It)10 b(is)g(similar)f(to)h
Fr(Ada)p Fu(')n(s)g(conditional)e(entry)i(call.)253 163 y(Another)f(way)h(to)
f(implement)h(polling)e(beha)o(vior)h(is)h(by)g(using)f(timeouts.)14
b(This)c(is)g(most)g(often)f(useful)h(when)g(dealing)190 222
y(with)e(the)g(e)o(xternal)h(world.)k(The)c(e)o(xpression)g
Fp(timeout)20 b Fq(t)8 b Fu(returns)g(an)h(e)o(v)o(ent)g(that)f(will)f(be)i
(a)o(v)o(ailable)f(for)g(synchronization)190 282 y(approximately)i
Fq(t)g Fu(time)g(units)f(after)i Fp(sync)e Fu(is)h(called.)16
b(The)11 b(ar)o(gument)f(to)g Fp(timeout)f Fu(is)h(a)h(v)o(alue)f(of)g(the)g
(type)253 382 y Fh(datatype)16 b(time)i(=)h(TIME)g(of)f({sec)g(:)i(int,)e
(usec)g(:)h(int})190 496 y Fu(Note)9 b(that)e(timeouts)h(are)h(measured)h(in)
e(real-time)g(\(not)g(cpu-time\).)1176 481 y Fo(2)1206 496
y Fu(There)i(is)e(also)g(a)h(mechanism)h(for)e(synchronizing)f(on)190
555 y(an)12 b(absolute)f(time.)19 b(The)12 b(function)e Fp(waitUntil)f
Fu(returns)i(an)h(e)o(v)o(ent)g(v)o(alue)f(that)g(will)f(be)i(a)o(v)o
(ailable)f(for)g(synchronization)190 615 y(at)g(the)f(speci\256ed)h(time.)k
(The)c Fp(timeout)e Fu(function)g(can)i(be)f(implemented)g(as)253
715 y Fh(fun)18 b(timeout)f(t)i(=)g(guard)f(\(fn)h(\(\))f(=>)h(waitUntil)d
(\(addTime)h(\(t,)h(currentTime)o(\(\))o(\)\)\))190 829 y Fu(where)11
b Fp(currentTime)d Fu(returns)i(the)g(current)g(time)g(of)g(day)m(.)253
909 y(It)j(is)i(worth)d(comparing)i(the)h(semantics)g(of)f
Fp(poll)f Fu(and)i Fp(timeout)e Fu(because)i(there)g(are)g(some)g(subtle)f
(dif)o(ferences.)190 969 y(Consider)n(,)c(for)g(e)o(xample)i(the)e(function)
253 1068 y Fh(fun)18 b(poll')g(evt)g(=)h(select)f([)410 1114
y(wrap)g(\(timeout\()o(TI)o(ME{)o(se)o(c=0)o(,)f(usec=0}\))o(,)g(fn)i(\(\))f
(=>)h(NONE\),)410 1160 y(wrap)f(\(evt,)f(SOME\))370 1205 y(])190
1319 y Fu(one)c(might)e(consider)h(it)f(equi)o(v)o(alent)g(to)h
Fp(poll)p Fu(,)g(b)o(ut)g(there)g(is)g(a)h(dif)o(ference)g(when)f(the)g(ar)o
(gument)g(e)o(v)o(ent)h(is)f(immediately)190 1379 y(a)o(v)o(ailable)e(for)g
(synchronization.)j(In)d(the)f(case)j(of)d Fp(poll)p Fu(,)h(the)g(answer)g
(will)f(always)g(be)i Fp(\(SOME)20 b Fq(v)q Fp(\))11 b Fu(\(assuming)e(the)h
(result)190 1439 y(of)h Fp(evt)g Fu(is)f Fq(v)q Fu(\),)j(while)d(in)g(the)h
(case)i(of)d Fp(poll')p Fu(,)h(the)g(answer)h(is)e(the)h(non-deterministic)e
(choice)j(of)e Fp(NONE)h Fu(and)g Fp(\(SOME)21 b Fq(v)q Fp(\))p
Fu(.)190 1499 y(While)12 b(the)g Fp(poll)g Fu(operation)f(guarantees)h(that)g
(an)g(immediately)g(a)o(v)o(ailable)g(synchronization)f(result)g(will)g(be)i
(returned,)190 1558 y(it)i(may)i(be)f(less)g(useful)g(than)f(non-zero)h
(timeouts)f(in)g(practice.)32 b(When)17 b(the)e(e)o(v)o(ent)h(v)o(alue)g(in)n
(v)o(olv)o(es)g(guards)f(\(e.g.,)k(a)190 1618 y(request/reply)9
b(protocol\),)g(then)h(a)h(poll)e(result)h(of)g Fp(NONE)f Fu(is)h(not)g(be)g
(v)o(ery)h(informati)o(v)o(e.)p 190 2635 720 2 v 236 2662 a
Fl(2)250 2674 y Fk(Because)c(of)h(scheduling)e(uncertainties)h(and)h(garbage)
e(collection,)h(timeouts)h(may)g(delay)f(for)h(more)f(than)h(the)g(requested)
e(amount)h(of)h(time.)1070 2799 y Fu(26)p eop
%%Page: 27 33
27 32 bop 33 414 a Fi(Chapter)20 b(4)33 643 y Fs(Condition)k(v)o(ariables)33
889 y Fu(Although)13 b Fr(CML)i Fu(is)g(currently)f(only)h(implemented)g(on)g
(single)f(processor)i(machines,)i(we)e(hope)f(to)f(ha)o(v)o(e)j(a)e(shared-)
33 949 y(memory)9 b(multi-processor)e(implementation)g(a)o(v)o(ailable)i(in)f
(the)g(future,)h(which)f(raises)h(the)g(question)e(of)h(the)h(ef)o(fecti)o(v)
o(eness)33 1009 y(of)g Fr(CML)h Fu(as)g(a)g(parallel)g(programming)f
(language.)15 b(Condition)7 b(v)o(ariables)i(are)i(an)f(e)o(xperimental)g
(feature)g(for)f(supporting)33 1068 y(parallel)15 b(programming.)33
b(Figure)15 b(4.1)i(gi)o(v)o(es)f(the)g(signature)f(of)h(the)g(condition)e(v)
o(ariable)i(operations.)33 b(A)16 b(condition)95 1192 y Fh(type)i('a)h
(cond_var)95 1283 y(val)f(condVar)f(:)j(unit)e(->)g('1a)h(cond_var)95
1374 y(val)f(writeVar)f(:)i(\('a)g(cond_var)d(*)j('a\))g(->)g(unit)95
1420 y(exception)d(WriteTwice)95 1511 y(val)i(readVar)f(:)j('a)e(cond_var)f
(->)i('a)95 1557 y(val)f(readVarEvt)e(:)j('a)g(cond_var)e(->)i('a)f(event)588
1690 y Fu(Figure)10 b(4.1:)k(Condition)7 b(v)o(ariable)k(operations)33
1799 y(v)o(ariable)16 b(is)g(essentially)f(a)i(\252write-once\272)f(shared)h
(v)o(ariable,)h(which)e(one)g(can)h(synchronize)f(on.)32 b(The)17
b(semantics)g(of)33 1859 y(condition)11 b(v)o(ariables)i(are)h(de\256ned)g
(in)f(terms)g(of)g(an)h(implementation)e(using)g(channels)i(\(see)g(Figure)f
(4.2\).)25 b(The)14 b(actual)33 1919 y(implementation)9 b(is)h(more)g(ef)o
(\256cient.)33 2024 y Fr(Example)f(4.1)h(\(Futur)o(es\))33
2105 y Fu(As)i(an)g(e)o(xample)g(of)g(ho)o(w)f(condition)f(v)o(ariables)i
(can)g(be)g(used)g(to)f(support)f(parallel)i(programming,)f(we)i(can)f
(implement)33 2165 y(futures)d(with)g(them)i(\(also)f(see)h(Example)g(1.4\).)
95 2264 y Fh(fun)18 b(future)g(f)h(x)g(=)g(let)213 2310 y(datatype)d('a)j
(msg_t)f(=)h(RESULT)e(of)i('a)g(|)g(EXN)g(of)f(exn)213 2356
y(val)g(result)f(=)j(condVar\()o(\))213 2401 y(in)252 2447
y(spawn)e(\(fn)g(\(\))h(=>)g(writeVar)d(\(result,)h(RESULT\(f)f(x\))j(handle)
e(ex)i(=>)g(EXN)f(ex\)\);)252 2493 y(wrap)g(\()291 2538 y(readVarEvt)e
(result,)291 2584 y(fn)j(\(RESULT)e(x\))i(=>)f(x)i(|)f(\(EXN)f(ex\))g(=>)h
(raise)f(ex\))213 2630 y(end)912 2799 y Fu(27)p eop
%%Page: 28 34
28 33 bop 253 108 a Fh(abstype)17 b('a)h(cond_var)f(=)i(CV)g(of)g({req_ch)e
(:)i('a)g(chan,)f(reply_ch)e(:)j('a)g(chan})253 154 y(with)292
199 y(fun)f(condVar)f(\(\))i(=)g(let)410 245 y(val)f(reqCh)g(=)h(channel\(\))
d(and)j(replyCh)d(=)k(channel\(\))410 291 y(fun)e(condvar)f(\(\))i(=)g(let)
527 336 y(val)g(v)g(=)g(accept)e(reqCh)527 382 y(fun)i(loop)f(\(\))h(=)g
(\(send\(rep)o(lyC)o(h,)d(v\);)38 b(loop\(\)\))527 428 y(in)566
473 y(loop)19 b(\(\))527 519 y(end)410 565 y(in)449 610 y(spawn)e(condvar;)
449 656 y(CV{req_ch)f(=)j(reqCh,)e(reply_ch)g(=)i(replyCh})410
702 y(end)292 793 y(exception)d(WriteTwice)292 839 y(fun)i(writeVar)f
(\(CV{req_c)o(h,)f(reply_ch},)g(v\))j(=)g(select)e([)449 884
y(transmit\()o(req)o(_c)o(h,)f(v\),)449 930 y(wrap)i(\(receive)e(reply_ch,)h
(fn)h(_)i(=>)e(raise)g(WriteTwice)o(\))410 976 y(])292 1067
y(fun)g(readVar)f(\(CV{reply_)o(ch,)f(...}\))i(=)h(accept)e(reply_ch)292
1113 y(fun)h(readVarEvt)e(\(CV{reply_)o(ch)o(,)h(...}\))g(=)j(receive)d
(reply_ch)253 1158 y(end)702 1291 y Fu(Figure)10 b(4.2:)k(Condition)7
b(v)o(ariable)j(implementation)190 1425 y(The)f(major)g(adv)o(antage)f(of)g
(this)g(implementation)f(of)h(futures)g(o)o(v)o(er)h(the)f(one)g(gi)o(v)o(en)
g(in)g(Chapter)g(1,)h(is)f(that)g(once)h(the)f(answer)190 1485
y(is)i(a)o(v)o(ailable,)h(no)f(message-passing)h(or)f(conte)o(xt)g(switches)h
(are)g(in)n(v)o(olv)o(ed)e(in)h(reading)g(the)g(result.)253
1565 y(Condition)e(v)o(ariables)j(can)h(also)f(be)g(used)g(where)o(v)o(er)h
(\252single-shot\272)e(communication)g(is)h(required.)17 b(F)o(or)11
b(e)o(xample,)i(a)190 1625 y(common)e(style)e(of)h(implementing)f
(request-reply)g(\(RPC-style\))g(protocols)f(in)n(v)o(olv)o(es)i(allocating)f
(a)i(fresh)f(reply)f(channel)190 1685 y(for)h(each)h(request)e(\(e.g.,)i
(Example)g(1.9\).)k(Condition)7 b(v)o(ariables)i(pro)o(vide)g(a)i(cheaper)f
(reply)g(mechanism)h(in)e(these)h(cases.)1972 1670 y Fo(1)190
1744 y Fu(Note,)h(ho)o(we)o(v)o(er)n(,)h(that)e(condition)f(v)o(ariables)h
(are)i(asynchronous)e(on)g(their)g(output.)15 b(Thus,)c(in)f(the)h(case)h
(where)f(the)g(serv)o(er)190 1804 y(needs)g(to)f(kno)o(w)g(if)f(the)h(reply)g
(has)h(been)g(accepted)g(\(e.g.,)h(see)f(Example)g(1.10\))f(the)o(y)g(are)h
(unsuitable.)p 190 2595 720 2 v 236 2623 a Fl(1)250 2635 y
Fk(In)e(fact,)h(experimental)e(e)o(vidence)g(suggests)g(that)h(allocating)g
(a)g(fresh)g(condition)f(v)o(ariable)h(for)g(each)g(reply)g(is)h
(substantially)e(faster)h(than)g(using)g(a)190 2674 y(dedicated)e(reply)g
(channel.)1070 2799 y Fu(28)p eop
%%Page: 29 35
29 34 bop 33 414 a Fi(Chapter)20 b(5)33 643 y Fs(Multi-thr)n(eaded)j(I/O)33
889 y Fu(I/O)11 b(poses)h(two)e(problems)h(for)g(concurrent)g(programs:)17
b(\256rst,)12 b(concurrenc)o(y)h(control)d(is)h(required)g(on)g(access)j(to)d
(the)g(I/O)33 949 y(state)e(and,)g(second,)h(I/O)e(operations,)g(which)g(are)
i(potentially)c(blocking,)i(need)h(to)f(be)h(supported)f(by)g(the)g
(synchronization)33 1009 y(primiti)o(v)o(es.)14 b Fr(CML)c
Fu(supports)f(I/O)h(both)f(at)h(the)g(stream)h(le)o(v)o(el)g(and)f(at)g(the)g
(\256le)h(descriptor)e(le)o(v)o(el.)15 b(The)c(stream)g(I/O)f(library)33
1068 y(includes)f(most)h(of)g(the)g Fr(SML/NJ)g Fu(stream)g(I/O)g(operations)
f(as)i(well)f(as)h(e)o(v)o(ent)f(v)o(alued)g(v)o(ersions)g(of)g(the)g(input)e
(operations.)33 1229 y Fm(5.1)57 b(Str)o(eam)16 b(I/O)33 1353
y Fu(The)10 b(structure)g Fp(CIO)f Fu(is)h(a)g(\256rst-pass)g(at)g(support)f
(for)g(multi-threaded)g(streams)i(\()1207 1352 y Fn(\301)1203
1353 y(a)e(la)h Fr(SML/NJ)p Fu(')n(s)f(in)g(and)h(out)f(streams\).)16
b(It)33 1413 y(includes)9 b(a)h(lar)o(ge)g(subset)f(of)h(the)f
Fp(IO)h Fu(structure)f(pro)o(vided)f(by)h Fr(SML/NJ)p Fu(,)h(as)g(well)f(as)i
(e)o(v)o(ent)f(v)o(alued)f(v)o(ersions)h(of)f(the)g(input)33
1472 y(stream)i(functions:)95 1572 y Fh(val)18 b(lookaheadEv)o(t)e(:)k
(instream)c(->)j(string)95 1618 y(val)f(inputEvt)95 b(:)20
b(instream)c(*)j(int)g(->)g(string)e(event)95 1663 y(val)h(inputcEvt)75
b(:)20 b(instream)c(->)j(int)f(->)h(string)f(event)95 1709
y(val)g(inputLineEv)o(t)e(:)k(instream)c(->)j(string)e(event)33
1823 y Fu(The)11 b(e)o(v)o(ent)h(v)o(alues)f(produced)g(by)g(these)g
(functions)f(ha)o(v)o(e)j(the)e(same)h(semantics)g(as)g(the)f(corresponding)f
Fr(SML/NJ)g Fu(input)33 1883 y(operations.)k(Output)8 b(operations)g(are)j
(assumed)f(to)f(be)h(nonblocking,)e(and)h(thus)g(e)o(v)o(ent)h(v)o(alued)f(v)
o(ersions)g(of)h(them)f(are)i(not)33 1942 y(pro)o(vided.)j(Appendix)9
b(A)h(gi)o(v)o(es)h(the)f(complete)g(signature)g(of)g(the)g
Fp(CIO)g Fu(structure.)33 2048 y Fr(Example)f(5.1)33 2128 y
Fu(Consider)i(a)j(game)f(program)g(in)f(which)g(the)h(player)f(is)h(gi)o(v)o
(en)f(a)h(limited)f(time)h(to)f(answer)h(a)g(question.)22 b(The)13
b(follo)o(wing)33 2188 y(function)8 b(could)i(be)h(used)f(to)g(implement)g(a)
g(question/response)f(interaction)g(with)g(the)i(player:)95
2288 y Fh(fun)18 b(getAnswer)f(\(questio)o(n,)f(t\))j(=)g(let)g(open)f(CML)g
(CIO)213 2333 y(in)252 2379 y(print)g(question)o(;)f(flush_out)f(std_out;)252
2425 y(select)h([)330 2470 y(wrap)h(\(inputLine)o(Evt)e(std_in,)h(SOME\),)330
2516 y(wrap)h(\(timeout)f(t,)i(fn)g(\(\))f(=>)h(NONE\))291
2562 y(])213 2607 y(end)912 2799 y Fu(29)p eop
%%Page: 30 36
30 35 bop 190 82 a Fu(This)11 b(function)d(prints)h(the)h(question)f
(\(\257ushing)g Fp(std_out)g Fu(in)h(case)h(there)g(is)f(no)f(terminating)g
(ne)o(wline\))h(and)g(waits)f(for)h(an)190 142 y(answer)n(.)16
b(If)10 b(the)g(user)h(does)f(not)g(respond)f(before)i(the)f(time)g
(speci\256ed)h(by)f Fp(t)g Fu(has)h(elapsed,)g(then)f Fp(NONE)f
Fu(is)i(returned.)253 222 y(There)f(is)f(a)g(strong)f(similarity)g(between)h
(channel)h(I/O)e(and)h(stream)h(I/O.)f(The)h Fp(CIO)f Fu(structure)f(pro)o
(vides)h(a)g(mechanism)190 282 y(for)h(creating)g(streams)h(with)f(a)g
(channel)h(style)f(interface)g(at)g(the)g(other)g(end:)253
382 y Fh(exception)16 b(ClosedStr)o(eam)253 428 y(val)i(openChanIn)35
b(:)20 b(unit)e(->)h(\(\(string)d(->)j(unit\))f(*)h(instream\))253
473 y(val)f(openChanOu)o(t)e(:)k(unit)e(->)h(\(string)e(event)g(*)i
(outstream\))190 587 y Fu(These)14 b(function)e(return)f(a)j(pair)e
(representing)g(the)h(two)e(sides)i(of)g(a)g(stream;)h(one)f(side)g(with)e(a)
i(channel-style)g(interface)190 647 y(and)e(the)f(other)f(with)g(a)i(stream)g
(interface.)k(This)10 b(mechanism)i(is)e(useful)g(for)f(hooking)g(e)o
(xisting)g(stream)i(based)g(code)f(\(i.e.,)190 707 y(sequential)i(code\))h
(into)e(a)i(concurrent)f(frame)o(work.)22 b(Note)12 b(that)g(the)g(instreams)
h(are)g(b)o(uf)o(fered)f(and)h(thus)f(the)g(send-style)190
766 y(operation)e(at)g(the)g(other)g(end)g(is)g(asynchronous.)190
927 y Fm(5.2)58 b(Lo)o(w-le)o(v)o(el)16 b(I/O)190 1051 y Fu(The)11
b Fp(CML)f Fu(structure)g(includes)f(the)i(functions)253 1150
y Fh(exception)16 b(InvalidFi)o(leD)o(es)o(c)h(of)h(int)253
1196 y(val)g(syncOnInpu)o(t)36 b(:)19 b(int)g(->)g(unit)253
1242 y(val)f(syncOnOutp)o(ut)e(:)j(int)g(->)g(unit)253 1287
y(val)f(syncOnExce)o(pt)e(:)j(int)g(->)g(unit)190 1401 y Fu(which)e(pro)o
(vide)g(an)h(e)o(v)o(ent-v)o(alued)f(interface)g(to)g(the)g(U)p
Fk(NIX)h Fp(select)p Fu(\(2\))d(system)j(call.)37 b(If)17 b(an)h(attempt)f
(is)g(made)h(to)190 1461 y(synchronize)10 b(on)g(a)g(closed)g(\256le)h
(descriptor)n(,)e(then)h(the)g(e)o(xception)g Fp(InvalidFileDesc)d
Fu(will)i(be)h(raised.)15 b(These)c(are)g(used)190 1521 y(by)h(the)f
Fp(CIO)g Fu(structure)g(to)g(a)o(v)o(oid)h(blocking)e(the)h(system)h(while)f
(waiting)f(for)h(I/O,)g(and)h(can)g(also)g(be)g(used)g(to)f(implement)190
1580 y(I/O)f(on)g(sockets.)1070 2799 y(30)p eop
%%Page: 31 37
31 36 bop 33 414 a Fi(Chapter)20 b(6)33 643 y Fs(Initialization)j(and)j
(termination)33 889 y Fu(The)11 b(structure)g Fp(RunCML)f Fu(pro)o(vides)g(a)
i(collection)d(of)i(facilities)f(to)g(support)g(the)h(initialization)d(and)j
(clean)h(termination)d(of)33 949 y Fr(CML)h Fu(programs.)15
b(This)10 b(chapter)h(describes)g(ho)o(w)e(to)h(use)h(these)f(facilities)f
(and)i(when)f(the)o(y)g(are)h(necessary)m(.)33 1107 y Fm(6.1)57
b(Ser)o(v)o(ers)15 b(and)g(top-le)o(v)o(el)h(channels)33 1230
y Fr(CML)d Fu(pro)o(vides)g(a)h(mechanism)g(for)f(the)g(automatic)h
(initialization)c(and)k(termination)d(of)j(services.)25 b(This)13
b(is)g(used,)i(for)33 1290 y(e)o(xample,)i(by)d(the)g Fp(CIO)g
Fu(structure)f(to)h(spa)o(wn)h(the)f(threads)h(for)f(the)g(standard)g
(streams)h(on)f(initialization)e(and)i(to)g(\257ush)33 1350
y(output)8 b(b)o(uf)o(fers)i(on)g(termination.)k(The)d(function)95
1437 y Fh(val)18 b(logServer)f(:)i(\(string)e(*)i(\(unit)f(->)g(unit\))g(*)h
(\(unit)f(->)h(unit\)\))e(->)i(unit)33 1539 y Fu(is)10 b(used)h(to)f(re)o
(gister)h(initialization)d(and)i(termination)g(functions)f(for)h(a)i
(service.)17 b(This)11 b(function)e(is)h(usually)g(called)h(at)g(the)33
1598 y(top-le)o(v)o(el)f(of)h(the)g(structure)f(that)h(implements)g(the)g
(service.)19 b(The)11 b(\256rst)g(ar)o(gument)h(is)f(a)g(string)f(for)h
(uniquely)e(identifying)33 1658 y(the)h(service;)223 1643 y
Fo(1)251 1658 y Fu(the)h(second)h(ar)o(gument)f(is)f(the)h(initialization)d
(function)h(and)i(the)g(third)f(is)g(the)h(termination)e(function.)16
b(The)33 1718 y(initialization)t(functions)6 b(are)i(called)g(in)f(the)g
(order)g(that)g(the)o(y)g(were)h(re)o(gistered,)h(and)e(termination)f
(functions)g(in)h(the)g(re)o(v)o(erse)33 1778 y(order)n(.)25
b(The)15 b(\256rst)f(service)g(to)g(be)g(initialized)e(\(and)i(last)f(to)h
(be)g(terminated\))f(is)h(the)g Fp(CIO)f Fu(service,)j(thus)e(other)f
(services)33 1837 y(may)h(safely)g(use)g(I/O)f(in)h(their)f(initialization)d
(and)k(termination.)24 b(Note,)15 b(ho)o(we)o(v)o(er)n(,)h(that)d(if)g(a)h
(termination)f(protocol)f(is)33 1897 y(implemented)g(using)f(multiple)g
(threads,)i(then)f(the)g(termination)f(function)g(should)g(not)h(return)f
(until)g(all)h(of)g(the)g(threads)33 1957 y(ha)o(v)o(e)17 b(terminated)e
(\(or)h(timed)g(out\);)h(otherwise,)h(a)e(race)i(condition)c(e)o(xists.)32
b(A)16 b(serv)o(er)h(can)g(be)f(unre)o(gistered)g(by)g(the)33
2017 y(function:)95 2104 y Fh(val)i(unlogServer)e(:)j(string)e(->)i(unit)95
2226 y Fu(F)o(or)g(a)g(complete)f(application,)i(this)e(mechanism)h(pro)o
(vides)f(a)h(con)n(v)o(enient)g(way)f(to)g(handle)g(initialization)e(and)33
2286 y(termination.)k(But,)12 b(it)f(is)i(most)f(useful)g(in)f(the)i(de)o(v)o
(elopment)f(c)o(ycle,)i(where)f(a)g(program)f(is)g(going)f(to)h(be)g(run,)h
(modi\256ed)33 2346 y(and)d(then)g(run)f(again.)15 b(The)c
(auto-initializatio)o(n)d(mechanism)j(helps)f(insure)f(that)h(each)h(run)f
(will)f(start)h(with)f(a)h(clean)h(slate.)95 2426 y(Services)g(usually)e
(employ)h(one)g(or)g(more)h(channels)f(bound)f(at)i(top-le)o(v)o(el)e(for)h
(communication)g(with)f(clients.)15 b(These)33 2486 y(can)d(cause)h(problems)
e(in)g(the)h(de)o(v)o(elopment)f(c)o(ycle,)j(since)e(the)f(channels)h(may)g
(ha)o(v)o(e)h(blocked)e(threads)g(in)g(their)g(queues.)33 2546
y(If)e(the)h(channel)h(is)e(not)h(cleaned)h(between)f(runs,)g(then)g(the)g
(threads)g(will)f(be)h(carried)g(o)o(v)o(er)n(.)16 b(T)m(o)10
b(a)o(v)o(oid)g(this)f(problem,)h(there)33 2605 y(is)g(a)h(mechanism)g(for)f
(re)o(gistering)f(top-le)o(v)o(el)g(channels:)p 33 2635 720
2 v 78 2662 a Fl(1)92 2674 y Fk(If)g(the)f(same)f(string)h(is)h(used)e
(twice,)h(then)g(the)g(second)e(call)j(will)g(replace)e(the)h(\256rst.)912
2799 y Fu(31)p eop
%%Page: 32 38
32 37 bop 253 82 a Fh(val)18 b(logChannel)e(:)j(\(string)e(*)i('a)g(chan\))f
(->)h(unit)253 128 y(val)f(unlogChann)o(el)e(:)j(string)f(->)g(unit)190
240 y Fu(Re)o(gistered)11 b(channels)f(will)f(ha)o(v)o(e)j(their)d(queues)i
(cleared)g(at)f(initialization.)253 321 y(A)g(simple)g(e)o(xample)h(will)e
(illustrate)g(the)h(use)h(of)f(this)f(mechanism:)190 426 y
Fr(Example)h(6.1)g(\(Unique)g(Ids\))190 506 y Fu(Consider)g(a)g(service)h
(for)f(generating)g(system-wide)g(unique)f(identi\256ers)h(with)f(the)h
(signature:)253 605 y Fh(signature)16 b(UNIQUE_ID)g(=)292 650
y(sig)331 696 y(eqtype)h(id)331 742 y(val)i(nextId)e(:)i(unit)f(->)h(id)292
787 y(end)f(\(*)h(UNIQUE_ID)d(*\))253 918 y(structure)g(UniqueId)g(:)k
(UNIQUE_I)o(D)d(=)292 963 y(struct)331 1009 y(datatype)g(id)h(=)i(ID)f(of)f
(int)331 1100 y(val)h(idCh)f(:)h(id)g(CML.chan)d(=)j(CML.channel)d(\(\))331
1192 y(fun)j(server)e(i)i(=)g(\(CML.send)d(\(idCh,)i(ID)h(i\);)38
b(server)17 b(\(i+1\)\))331 1283 y(fun)i(nextId)e(\(\))i(=)g(CML.accep)o(t)e
(idCh)331 1374 y(val)i(_)g(=)g(RunCML.log)o(Ch)o(ann)o(el)d(\("UniqueId)o(.i)
o(dCh)o(",)g(idCh\))331 1466 y(val)j(_)g(=)g(RunCML.log)o(Se)o(rve)o(r)d
(\("UniqueId")o(,)527 1511 y(fn)j(\(\))g(=>)g(\(CML.spaw)o(n)e(\(fn)h(\(\))h
(=>)g(server)e(0\);)h(\(\)\),)527 1557 y(fn)h(\(\))g(=>)g(\(\)\))292
1648 y(end)f(\(*)h(structure)d(UniqueId)h(*\))190 1761 y Fu(The)10
b(initialization)c(function)i(spa)o(wns)i(the)f(serv)o(er)h(thread.)k(The)c
(termination)e(function)f(does)j(not)e(do)h(an)o(ything,)f(although)190
1821 y(we)j(could)e(ha)o(v)o(e)h(implemented)g(a)g(termination)e(protocol.)14
b(Upon)9 b(termination,)f(the)i(serv)o(er)h(will)d(most)h(likely)f(be)i
(blocked)190 1880 y(on)g Fp(idCh)p Fu(;)f(b)o(ut)h(since)h(it)e(is)h(re)o
(gistered,)h(this)e(will)g(not)h(pose)g(an)o(y)h(problems.)190
2041 y Fm(6.2)58 b(Starting)16 b(and)f(stopping)h(a)f(CML)f(pr)o(ogram)190
2164 y Fu(Before)c(a)h Fr(CML)f Fu(program)f(can)i(run)f(there)g(are)g(a)h
(number)f(of)f(things)g(that)g(must)h(be)g(done,)g(such)h(as)f(enabling)f
(preempti)o(v)o(e)190 2224 y(scheduling)h(and)g(initializing)d(the)j(top-le)o
(v)o(el)g(channels)g(and)h(re)o(gistered)f(services.)16 b(This)10
b(is)g(all)g(handled)g(by)g(the)g(function)253 2323 y Fh(val)18
b(doit)g(:)h(\(\(unit)f(->)h(unit\))e(*)i(int)g(option\))e(->)i(unit)190
2435 y Fu(in)9 b(the)f(structure)g Fp(RunCML)p Fu(.)g(The)h(\256rst)g(ar)o
(gument)g(is)f(the)h(root)f(thread)g(and)h(the)f(second)i(is)e(the)h(time)f
(quantum)g(\(measured)i(in)190 2495 y(milliseconds\))e(for)h(thread)f
(preemption.)14 b(Specifying)8 b(the)h(v)o(alue)g Fp(NONE)f
Fu(for)h(the)g(time)g(quantum)f(will)g(disable)g(preempti)o(v)o(e)190
2555 y(scheduling,)i(b)o(ut)f(this)g(can)i(cause)g(a)g(program)e(to)h(block)f
(inde\256nitely)f(if)h(it)h(uses)g(timeouts.)k(Preemption)c(is)g(implemented)
190 2614 y(using)g(the)g(interv)o(al)f(timer)h(pro)o(vided)f(by)h(the)g
(operating)g(system)g(and)h(the)f Fr(SML/NJ)g Fu(signals)f(facility)1688
2601 y Fo([Rep90)m(])1782 2614 y Fu(.)15 b(The)c(choice)190
2674 y(of)d(a)g(good)g(time)f(quantum)h(is)f(application)g(dependent:)13
b(for)7 b(programs)h(with)f(\252real-time\272)i(responsi)o(v)o(eness)f
(requirements,)1070 2799 y(32)p eop
%%Page: 33 39
33 38 bop 33 82 a Fu(small)10 b(v)o(alues)h(\(between)g(10)g(and)g(40)f
(ms.\))17 b(are)11 b(better;)g(for)f(other)g(applications,)g(lar)o(ger)h(v)o
(alues)g(will)e(reduce)j(scheduling)33 142 y(o)o(v)o(erhead.)193
127 y Fo(2)225 142 y Fu(Of)c(course,)i(dif)o(ferent)d(hardware/OS)h
(platforms)g(support)f(dif)o(ferent)g(timer)i(granularities,)e(b)o(ut)h(most)
g(pro)o(vide)33 202 y(50)i(Hz.)15 b(or)10 b(\256ner)n(.)95
282 y(Once)i(you)f(ha)o(v)o(e)h(b)o(uilt)e(an)i(application)e(using)g
Fr(CML)p Fu(,)i(you)f(may)h(want)f(to)g(b)o(uild)f(an)i(e)o(x)o(ecutable)g
(image)g(that)f(can)h(be)33 342 y(run)d(from)h(shell)g(command)h(line.)k(The)
c(function)95 442 y Fh(val)18 b(exportFn)f(:)i(\(string)e(*)i(\(\(string)e
(list)h(*)h(string)e(list\))h(->)h(unit\))f(*)h(int)f(option\))213
487 y(->)g(unit)33 601 y Fu(pro)o(vides)11 b(this)f(service.)20
b(It)11 b(is)h(essentially)f(the)g(same)i(as)g(the)e(function)f
Fp(IO.exportFn)g Fu(pro)o(vided)g(by)i Fr(SML/NJ)p Fu(,)f(e)o(xcept)33
661 y(that)k(it)f(has)i(an)g(e)o(xtra)g(third)e(ar)o(gument)i(for)f
(specifying)g(the)g(timer)h(quantum)f(and)g(it)g(binds)g(in)g(the)g(code)h
(for)f(service)33 721 y(initialization)7 b(and)j(termination.)526
706 y Fo(3)95 801 y Fu(There)h(is)f(also)g(a)h(mechanism)h(for)d(forcing)h
(termination)f(of)g Fr(CML)i Fu(programs.)k(The)c(function)95
901 y Fh(val)18 b(shutdown)f(:)i(unit)f(->)h('a)33 1015 y Fu(in)8
b(the)h(structure)f Fp(RunCML)g Fu(terminates)h(the)f(system.)15
b(This)9 b(includes)g(terminating)e(the)i(re)o(gistered)g(services.)15
b(T)m(ermination)33 1074 y(is)d(rob)o(ust:)19 b(if)13 b(a)h(service)f
(termination)f(function)f(does)j(not)e(complete)h(within)e(\256v)o(e)j
(seconds,)h(then)d(a)i(timeout)e(message)33 1134 y(will)d(be)i(printed)e(to)h
(the)h(standard)f(error)h(stream.)17 b(Y)-5 b(ou)10 b(may)i(also)e(terminate)
h(a)g(run)f(by)g(typing)f(your)h(interrupt)f(character)33 1194
y(\(e.g.)15 b(control-C\),)9 b(which)h(will)f(asynchronously)g(force)h(a)h
(shutdo)o(wn.)p 33 2553 720 2 v 78 2583 a Fl(2)92 2594 y Fk(For)d(most)g
(machines,)f(a)h(20)g(ms.)k(scheduling)6 b(quantum)h(produces)f(an)h
(overhead)e(of)j(less)h(than)e(3\045)1263 2584 y Fo([Rep90)n(])1358
2594 y Fk(.)78 2623 y Fl(3)92 2635 y Fk(As)h(with)f Fj(IO.exportFn)o
Fk(,)e(you)i(probably)e(want)i(to)g(start)h(with)f(a)g(version)f(of)h
Fg(SML)i Fk(that)e(has)f(the)i(compiler)e(in)h(the)g(heap.)k(See)c(the)g
Fj(makeml)p Fk(\(1\))e(man)33 2674 y(page)i(in)h(the)g Fg(SML/NJ)h
Fk(distrib)o(ution)f(for)g(details.)912 2799 y Fu(33)p eop
%%Page: 34 40
34 39 bop 190 414 a Fi(Chapter)20 b(7)190 643 y Fs(Deb)n(ugging)25
b(CML)h(pr)n(ograms)190 889 y Fu(Deb)o(ugging)14 b(concurrent)g(programs)g
(can)i(be)f(quite)e(dif)o(\256cult,)i(because)h(of)e(their)g
(nondeterministic)f(beha)o(vior)n(.)28 b Fr(CML)190 949 y Fu(currently)6
b(has)i(fairly)d(limited)h(support)f(for)h(deb)o(ugging;)h(the)f
Fp(TraceCML)g Fu(module)g(pro)o(vides)g(a)i(mechanism)g(for)e(controlling)190
1009 y(diagnostic)14 b(output,)h(a)g(mechanism)h(for)f(monitoring)d(threads)j
(for)g(une)o(xpected)g(termination,)g(and)g(a)h(mechanism)g(for)190
1068 y(reporting)9 b(uncaught)h(e)o(xceptions)g(in)f(threads.)190
1229 y Fm(7.1)58 b(Deb)o(ugging)16 b(hints)190 1353 y Fu(Although)10
b(there)h(is)g(little)f(support)g(for)h(deb)o(ugging)f(in)g
Fr(CML)p Fu(,)i(there)g(are)g(a)g(fe)o(w)f(techniques)g(that)g(can)h(make)g
(deb)o(ugging)190 1413 y(easier)n(.)22 b(The)13 b(most)f(important)f(thing)g
(to)h(do)g(is)g(to)g(deb)o(ug)g(your)f(sequential)h(code)h(in)e
Fr(SML)i Fu(before)f(using)f(it)h(in)g(a)h Fr(CML)190 1472
y Fu(program;)8 b(you)g(can)h(use)f(the)g Fr(SML/NJ)f Fu(deb)o(ugger)h(to)g
(do)f(this)1083 1459 y Fo([T)n(ol90)m(])1169 1472 y Fu(.)14
b(Ev)o(en)9 b(with)e(correct)i(sequential)e(code,)i(your)f(program)190
1532 y(may)13 b(not)f(work.)20 b(In)12 b(this)f(situation,)g(there)i(are)g
(two)e(techniques)h(you)g(can)h(use:)18 b(adding)12 b(print)f(statements)h
(and)g(turning)190 1592 y(of)o(f)d(preempti)o(v)o(e)h(scheduling)e(\(see)i
(Chapter)f(6\).)15 b(T)o(ry)8 b(to)h(isolate)g(the)g(problem)g(to)f(one)i(or)
f(two)f(threads,)i(and)f(then)g(monitor)190 1652 y(their)g(state)h(with)e
(print)g(statements.)15 b(Unfortunately)m(,)9 b(this)f(technique)h(will)f
(often)h(not)g(work)f(with)g(race)j(conditions,)d(since)190
1711 y(the)k(print)f(statements)h(change)h(the)f(program)g(timing.)19
b(The)12 b(only)f(real)i(solution)d(to)h(race)i(conditions)d(is)i(to)g
(design)f(your)190 1771 y(communication)k(structure)g(carefully)m(.)30
b(T)n(urning)14 b(of)o(f)h(preemption)f(increases)j(the)e(repeatability)f(of)
h(your)f(program')n(s)190 1831 y(beha)o(vior)n(,)d(b)o(ut)f(programs)g(that)f
(use)i(stream)g(I/O)f(and)g(timeouts)f(will)g(not)h(function)f(correctly)h
(without)e(preemption.)190 1992 y Fm(7.2)58 b(T)l(race)14 b(modules)190
2115 y Fu(F)o(or)f(a)g(lar)o(ge)g Fr(CML)f Fu(program,)i(it)d(probably)h
(makes)h(sense)g(to)f(systematically)g(include)g(diagnostic)f(output)g
(throughout)190 2175 y(the)g(system.)18 b(The)12 b Fp(CMLTrace)d
Fu(structure)h(supports)g(this)g(process)i(by)e(pro)o(viding)f(a)j
(mechanism,)h(called)e Fn(tr)o(ace)h(modules)p Fu(,)190 2235
y(for)d(selecti)o(v)o(ely)g(enabling)f(diagnostic)g(output)f(for)h(dif)o
(ferent)g(parts)h(of)g(the)g(system.)15 b(The)9 b(basic)h(idea)f(is)g(that)f
(one)h(de\256nes)h(a)190 2295 y(heirarchy)h(of)f(trace)i(modules,)f(which)f
(pro)o(vide)g(v)o(alv)o(es)h(for)g(turining)d(deb)o(ugging)h(output)g(on)i
(and)f(of)o(f.)16 b(Figure)11 b(7.1)f(gi)o(v)o(es)190 2354
y(the)g(operations)f(on)h(trace)h(modules.)k(The)10 b(v)o(alue)h
Fp(traceRoot)d Fu(is)i(the)g(root)f(of)g(the)h(trace)h(module)f(heirarchy)m
(,)g(and)g(has)h(the)190 2414 y(name)g(\252)p Fp(/)p Fu(.)m(\272)16
b(A)10 b(ne)o(w)g(trace)g(module)f(may)i(be)f(created)g(as)h(the)e(child)g
(of)g(an)h(e)o(xisting)f(module)g(by)g(using)g(the)h Fp(traceModule)190
2474 y Fu(function;)j(the)f(name)i(of)f(a)g(trace)h(module)e(is)h(returned)f
(by)h Fp(nameOf)e Fu(and)i(a)h(name)f(can)h(be)f(mapped)h(to)e(a)h(trace)h
(module)190 2534 y(by)f Fp(moduleOf)e Fu(\(this)g(raises)i(the)g(e)o
(xception)f Fp(NoSuchModule)f Fu(if)h(no)g(module)g(of)h(the)f(gi)o(v)o(en)g
(name)i(e)o(xists\).)22 b(The)13 b(name)190 2594 y(of)f(a)h(trace)g(module)g
(in)e(a)i(heirarchy)f(is)g(similar)g(to)g(a)h(U)p Fk(NIX)p
Fu(-style)f(pathname;)h(i.e.,)h(the)e(indi)o(vidual)e(module)i(names)i(are)
190 2653 y(separated)e(by)d(\252)p Fp(/)p Fu(\272.)16 b(The)11
b(follo)o(wing)d(transcript)h(illustrates)g(this:)1070 2799
y(34)p eop
%%Page: 35 41
35 40 bop 95 105 a Fh(type)18 b(trace_modu)o(le)95 196 y(val)g(traceRoot)f(:)
i(trace_mod)o(ul)o(e)95 288 y(val)f(traceModule)e(:)j(\(trace_mo)o(dul)o(e)e
(*)i(string\))e(->)i(trace_mo)o(dul)o(e)95 333 y(val)f(nameOf)g(:)h
(trace_mod)o(ule)d(->)j(string)95 379 y(val)f(moduleOf)f(:)i(string)e(->)i
(trace_modu)o(le)95 470 y(val)f(traceOn)f(:)j(trace_mo)o(dul)o(e)c(->)j(unit)
95 516 y(val)f(traceOff)f(:)i(trace_modu)o(le)d(->)j(unit)95
562 y(val)f(traceOnly)f(:)i(trace_mod)o(ul)o(e)e(->)i(unit)95
607 y(val)f(amTracing)f(:)i(trace_mod)o(ul)o(e)e(->)i(bool)95
699 y(val)f(status)g(:)h(trace_mod)o(ule)d(->)j(\(trace_mo)o(du)o(le)d(*)k
(bool\))d(list)95 790 y(val)h(trace)g(:)h(\(trace_mod)o(ule)d(*)j(\(unit)f
(->)h(string)e(list\)\))g(->)i(unit)95 881 y(datatype)d(trace_to)134
927 y(=)j(TraceToOut)134 973 y(|)g(TraceToErr)134 1018 y(|)g(TraceToNull)134
1064 y(|)g(TraceToFile)d(of)j(string)134 1110 y(|)g(TraceToStre)o(am)d(of)j
(CIO.outst)o(rea)o(m)95 1201 y(val)f(setTraceFil)o(e)e(:)k(trace_to)c(->)j
(unit)628 1334 y Fu(Figure)10 b(7.1:)15 b(T)o(race)c(module)f(operations)95
1464 y Fh(-)19 b(val)g(foo)f(=)h(TraceCML.t)o(rac)o(eM)o(odu)o(le)d
(\(TraceCML.)o(tra)o(ce)o(Roo)o(t,)g("foo"\);)95 1510 y(val)i(foo)h(:)g
(TraceCML.t)o(ra)o(ce_)o(mo)o(dul)o(e)95 1556 y(-)g(TraceCML.n)o(ame)o(Of)d
(foo;)95 1601 y(val)i(it)h(=)g("/foo/")e(:)j(string)95 1647
y(-)f(val)g(bar)f(=)h(TraceCML.t)o(rac)o(eM)o(odu)o(le)d(\(foo,)i("bar"\);)95
1693 y(val)g(bar)h(:)g(TraceCML.t)o(ra)o(ce_)o(mo)o(dul)o(e)95
1738 y(-)g(TraceCML.n)o(ame)o(Of)d(bar;)95 1784 y(val)i(it)h(=)g("/foo/bar/")
d(:)j(string)95 1915 y Fu(Each)9 b(trace)f(module)f(is)h(a)g(point)e(of)h
(control)g(for)g(diagnostic)f(printing.)12 b(The)c(function)f
Fp(trace)f Fu(is)i(used)g(to)f(conditionally)33 1975 y(print)j(according)h
(to)g(the)h(state)g(of)f(a)h(gi)o(v)o(en)g(module;)f(the)h(second)g(ar)o
(gument)g(to)f Fp(trace)f Fu(is)i(a)g(function)e(that)h(is)h(e)o(v)o(aluated)
33 2035 y(if)j(the)g(module)h(gi)o(v)o(en)f(as)i(the)e(\256rst)h(ar)o(gument)
f(is)h(enabled.)32 b(The)16 b(results)f(of)h(e)o(v)o(aluating)e(the)i(second)
g(ar)o(gument)g(are)33 2095 y(concatenated)11 b(and)f(printed)f(to)h(the)g
(current)g(trace)h(\256le)f(\(see)h(belo)o(w\).)95 2175 y(The)16
b(functions)e Fp(traceOn)g Fu(and)h Fp(traceOff)f Fu(are)i(used)f(to)g
(change)h(the)f(status)g(of)g(a)g(trace)h(module)f(and)h(all)e(of)h(its)33
2235 y(descendents.)21 b(F)o(or)12 b(e)o(xample,)i(applying)d
Fp(traceOn)g Fu(to)g Fp(foo)h Fu(\(as)h(de\256ned)f(abo)o(v)o(e\),)i(will)d
(enable)h Fp(foo)p Fu(,)h Fp(bar)e Fu(and)h Fp(baz)p Fu(.)21
b(A)33 2295 y(subsequent)9 b(application)f(of)h Fp(traceOff)e
Fu(to)i Fp(bar)g Fu(will)f(lea)o(v)o(e)j(just)d Fp(foo)h Fu(and)g
Fp(baz)g Fu(enabled.)15 b(The)c(function)c Fp(traceOnly)h Fu(is)33
2355 y(used)k(to)f(turn)g(on)g(a)i(module)e(without)f(enabling)h(its)g
(descendents,)i(and)f(the)g(function)e Fp(amTracing)g Fu(returns)h(the)h
(current)33 2414 y(status)j(of)g(a)h(module.)30 b(The)16 b(function)e
Fp(status)g Fu(returns)h(a)h(list)e(of)i(a)g(module)f(and)g(all)g(of)g(its)g
(descendents)h(and)g(their)33 2474 y(associated)11 b(state;)f(the)g(list)f
(is)h(in)g(pre-order)n(.)95 2555 y(The)j(function)f Fp(setTraceFile)e
Fu(is)j(used)g(to)f(set)h(the)g(destination)e(of)i(the)f(trace)i(output.)21
b(The)14 b(v)o(alue)f Fp(TraceToOut)33 2614 y Fu(speci\256es)18
b(that)e(output)g(should)g(be)h(directed)g(to)g Fp(CIO.std_out)e
Fu(\(the)h(default\);)j(the)e(v)o(alue)g Fp(TraceToErr)f Fu(speci\256es)33
2674 y Fp(CIO.std_err)p Fu(;)9 b(while)h(th)h(v)o(alue)g Fp(TraceToNull)e
Fu(causes)j(output)e(to)g(be)i(discarded.)18 b(An)11 b(arbitrary)f
Fp(CIO)h Fu(output)e(stream)912 2799 y(35)p eop
%%Page: 36 42
36 41 bop 190 82 a Fu(may)15 b(be)g(speci\256ed)g(using)e(either)h
Fp(TraceToFile)e Fu(or)i Fp(TraceToStream)p Fu(.)25 b(In)14
b(the)g(former)h(case,)i(the)d(speci\256ed)h(\256le)g(is)190
142 y(opened)c(for)e(writing;)f(if)i(the)g(attempt)g(to)g(open)g(fails,)g
(then)f Fp(CIO.std_out)g Fu(is)h(used.)253 222 y(The)i(trace)h(module)e
(operations)g(are)i(designed)e(to)g(be)h(called)g(either)g(from)g(the)f
Fr(SML/NJ)g Fu(top-le)o(v)o(el)g(loop,)h(or)f(while)190 282
y(e)o(x)o(ecuting)g(a)g Fr(CML)f Fu(program)g(\(although)e
Fp(trace)i Fu(is)g(a)h(no-op)e(from)h(the)g(top-le)o(v)o(el\).)190
443 y Fm(7.3)58 b(Thr)o(ead)15 b(watching)190 566 y Fu(Another)i(common)i(b)o
(ug)e(in)g Fr(CML)h Fu(programs)f(is)h(when)g(a)g(thread)g(une)o(xpectedly)f
(dies.)38 b(The)19 b Fp(TraceCML)d Fu(module)190 626 y(addresses)d(this)d
(problem)h(by)g(pro)o(viding)e(a)j(mechanism)g(for)f(watching)f(speci\256c)i
(threads)f(for)g(une)o(xpected)h(termination.)190 686 y(The)f(interface)f
(is:)253 784 y Fh(val)18 b(watcher)f(:)i(trace_modu)o(le)253
829 y(val)f(watch)g(:)h(\(string)e(*)i(CML.thread)o(_id)o(\))d(->)j(unit)253
875 y(val)f(unwatch)f(:)i(CML.thread)o(_id)d(->)j(unit)190
987 y Fu(where)d(the)f(trace)h(module)f Fp(watcher)f Fu(controls)g(printing)f
(of)i(messages)i(\(this)d(is)h(enabled)g(by)g(default\);)h(the)f(function)190
1047 y Fp(watch)8 b Fu(causes)j(the)e(speci\256ed)g(thread)g(to)g(be)g
(watched;)g(and)g(the)g(function)e Fp(unwatch)h Fu(disables)g(the)h(watching)
f(of)h(a)g(thread.)190 1106 y(The)i(follo)o(wing)d(transcript)h(illustrates)g
(the)h(use)h(of)f(the)g(facility:)253 1204 y Fh(-)19 b(fun)f(wspawn)g
(\(name,)f(f\))i(=)g(let)253 1250 y(=)97 b(val)19 b(tid)f(=)h(CML.spawn)e(f)
253 1296 y(=)97 b(in)253 1341 y(=)156 b(TraceCML.w)o(atc)o(h)16
b(\(name,)i(tid\);)253 1387 y(=)137 b(tid)253 1433 y(=)117
b(end;)253 1478 y(val)18 b(wspawn)f(=)j(fn)e(:)i(string)d(*)i(\(unit)f(->)h
(unit\))e(->)i(CML.thread)o(_id)253 1524 y(-)g(fun)f(test)g(\(\))h(=)g
(\(wspawn)e(\("dummy",)g(fn)h(\(\))h(=>)g(\(\)\);)f(\(\)\);)253
1570 y(val)g(test)g(=)h(fn)g(:)g(unit)g(->)f(unit)253 1615
y(-)h(RunCML.do)o(it)d(\(test,)i(SOME)g(100\);)253 1661 y(WARNING!)36
b(Watched)17 b(thread)g(dummy[9])g(has)h(died.)253 1707 y(val)g(it)h(=)g
(\(\))g(:)g(unit)190 1898 y Fm(7.4)58 b(Uncaught)16 b(exceptions)190
2022 y Fu(One)7 b(of)g(the)g(the)g(most)g(common)g(errors)f(in)g
Fr(CML)h Fu(\(and)f Fr(SML)p Fu(\))g(prog)o(rams)h(is)g(an)g(un)o(caught)g(e)
o(xception)o(.)k(This)c(is)g(particularly)190 2082 y(nasty)k(in)e
Fr(CML)p Fu(,)i(since)g(if)f(a)h(thread)f(raises)h(an)g(uncaught)f(e)o
(xception,)g(then)g(it)g(will)f(terminate)i(without)d(a)j(trace)g(\(unless)f
(it)190 2141 y(is)g(being)g(watched\).)15 b(The)c Fp(TraceCML)e
Fu(structure)g(pro)o(vides)h(support)f(for)h(reporting)e(uncaught)i(e)o
(xceptions.)253 2222 y(If)k(a)h(thread)f(generates)i(an)e(uncaught)g(e)o
(xception,)i(then)e(a)h(message)h(is)e(sent)h(to)f(the)g Fn(uncaught-e)o
(xception)f(server)p Fu(,)190 2282 y(which)d(prints)f(a)i(message)h(to)e(the)
g(standard)g(error)g(stream.)16 b(F)o(or)10 b(e)o(xample:)253
2380 y Fh(-)19 b(fun)f(blah)g(\(\))h(=)g(\(hd)g([];)f(\(\)\);)253
2425 y(val)g(blah)g(=)h(fn)g(:)g(unit)g(->)f(unit)253 2471
y(-)h(RunCML.do)o(it\()o(bl)o(ah,)d(NONE\);)253 2517 y(CML:)i(uncaught)e
(exception)g(Hd)j(in)g(thread)e([8])253 2562 y(val)h(it)h(=)g(\(\))g(:)g
(unit)190 2674 y Fu(It)10 b(is)g(possible)g(to)f(set)i(the)f(function)f
(called)h(by)g(the)g(trace)h(serv)o(er)g(using)f(the)g(function)1070
2799 y(36)p eop
%%Page: 37 43
37 42 bop 95 82 a Fh(val)18 b(setUncaught)o(Fn)e(:)j(\(\(CML.thre)o(ad_)o(id)
d(*)j(exn\))f(->)h(unit\))f(->)h(unit)33 196 y Fu(Continuing)7
b(our)j(e)o(xample:)95 296 y Fh(-)19 b(fun)g(complain)d(_)j(=)h(\(CIO.pri)o
(nt)c("goodbye\\n)o(";)g(RunCML.shu)o(tdo)o(wn\()o(\)\))o(;)95
341 y(val)i(complain)f(=)i(fn)g(:)g('a)g(->)g('b)95 387 y(-)g(TraceCML.s)o
(etU)o(nc)o(aug)o(ht)o(Fn)d(complain;)95 433 y(-)j(RunCML.doi)o(t)e(\(blah,)g
(SOME)h(100\);)95 478 y(goodbye)95 524 y(val)g(it)h(=)g(\(\))g(:)h(unit)33
638 y Fu(This)10 b(can)h(be)f(used)h(to)f(report)f(the)h(ar)o(guments)h(of)f
(gi)o(v)o(en)g(e)o(xceptions,)g(as)h(well)f(as)h(their)f(names.)95
718 y(In)g(a)h(lar)o(ge)g(system,)g(dif)o(ferent)f(sub-systems)g(may)h(ha)o
(v)o(e)h(their)d(o)o(wn)h(special)h(e)o(xceptions)g(that)e(should)h(be)g
(reported)g(if)33 778 y(uncaught.)16 b(T)m(o)11 b(support)f(such)h(systems,)h
(the)f Fp(TraceML)f Fu(structure)g(allo)o(ws)g(additional)g(handlers)g(to)h
(be)g(layered)g(o)o(v)o(er)h(the)33 838 y(\252catch-all\272)f(handler)f
(de\256ned)g(by)g Fp(setUncaughtFn)p Fu(.)j(The)e(function)95
937 y Fh(val)18 b(setHandleFn)e(:)j(\(\(CML.thr)o(ead)o(_id)d(*)j(exn\))f(->)
h(bool\))f(->)g(unit)33 1051 y Fu(adds)f(an)h(uncaught-e)o(xception)e
(handler)n(.)36 b(When)18 b(a)g(thread)f(has)h(an)g(uncaught)e(e)o(xception,)
k(the)d(v)o(arious)g(uncaught-)33 1111 y(e)o(xception)11 b(handlers)h(are)g
(applied)f(to)g(the)h(thread)f(ID)h(and)f(e)o(xception,)i(until)d(one)h(of)h
(the)f(handlers)h(return)e(true.)20 b(If)11 b(none)33 1171
y(of)f(the)g(handlers)g(returns)f(true,)i(then)f(the)g(catch-all)g(handler)g
(is)g(applied.)k(F)o(or)d(e)o(xample:)95 1270 y Fh(-)19 b(exception)d(Error)i
(of)h(string;)95 1316 y(exception)d(Error)i(of)h(string)95
1362 y(-)g(fun)g(handleErr)o(or)d(\(_,)i(Error)g(s\))h(=)g(\(CIO.print)o
(\("E)o(RR)o(OR:)d(")j(^)g(s)h(^)f("\\n"\);)e(true\))95 1407
y(=)58 b(|)20 b(handleErr)o(or)c(_)j(=)g(false;)95 1453 y(val)f(handleError)e
(=)j(fn)g(:)g('a)g(*)g(exn)g(->)f(bool)95 1499 y(-)h(TraceCML.s)o(etH)o(an)o
(dle)o(Fn)d(handleErro)o(r;)95 1544 y(val)i(it)h(=)g(\(\))g(:)h(unit)95
1590 y(-)f(fun)g(foo)f(\(\))h(=)g(\(raise)e(Error)h("foo"\);)95
1636 y(val)g(foo)h(=)g(fn)g(:)g(unit)f(->)h('a)95 1681 y(-)g(RunCML.doi)o(t)e
(\(foo,)g(SOME)h(100\);)95 1727 y(ERROR:)f(foo)95 1773 y(val)h(it)h(=)g(\(\))
g(:)h(unit)95 1907 y Fu(The)11 b(default)e(catch-all)h(handler)g(can)h(be)g
(restored,)f(and)h(the)f(other)f(handlers)h(remo)o(v)o(ed)i(by)e(calling)f
(the)h(function:)95 2007 y Fh(val)18 b(resetUncaug)o(ht)o(Fn)e(:)j(unit)f(->)
h(unit)912 2799 y Fu(37)p eop
%%Page: 38 44
38 43 bop 190 414 a Fi(Chapter)20 b(8)190 643 y Fs(Administrati)o(v)o(e)25
b(details)190 904 y Fm(8.1)58 b(Ho)o(w)15 b(to)g(get)g(the)g(r)o(elease)190
1028 y Fr(CML)10 b Fu(is)f(distrib)o(uted)e(via)j(anon)o(ymous)f(FTP)h(from)g
(three)f(sites,)h(as)g(a)g(compressed)h(tar)e(\256le)h(named)g
Fp(CML-0.9.8.tar.Z)p Fu(.)190 1087 y(The)h(sites)g(and)f(locations)f(are:)608
1181 y Fr(FTP)i(Site)286 b(Path)p 583 1197 1015 2 v 608 1232
a Fp(ftp.cs.cornell.ed)o(u)47 b(/pub/CML-0.9.8.ta)o(r.Z)608
1282 y(research.att.com)90 b(/dist/ml/CML-0.9.)o(8.tar)o(.Z)608
1332 y(princeton.edu)156 b(/pub/ml/CML-0.9.8)o(.tar.)o(Z)190
1433 y Fu(In)10 b(addition)d(to)i(the)h Fr(CML)f Fu(distrib)o(ution,)e(you)i
(will)f(also)h(need)h(the)g Fr(SML/NJ)f Fu(distrib)o(utio)o(n,)e(which)i(is)h
(a)o(v)o(ailable)f(from)h(the)190 1493 y(latter)g(two)g(FTP)h(sites.)17
b(V)-5 b(ersion)10 b(0.9.8)h(of)f Fr(CML)h Fu(works)e(with)h(v)o(ersion)g
(0.75)h(of)f(SML/NJ,)h(b)o(ut)f(we)h(recommend)h(a)f(more)190
1553 y(recent)g(release)h(\(0.93)e(is)g(the)g(most)g(recent)h(v)o(ersion)f
(as)h(of)f(this)f(writing\).)k(The)e(follo)o(wing)d(is)i(a)h(sample)g(ftp)e
(dialog:)253 1652 y Fh(\045)19 b(ftp)f(ftp.cs.cor)o(nel)o(l.e)o(du)253
1698 y(Connected)e(to)j(ftp.cs.co)o(rn)o(ell)o(.e)o(du.)253
1744 y(...)253 1789 y(Name:)e(anonymous)253 1835 y(331)h(Guest)g(login)f(ok,)
i(send)f(ident)g(as)h(password)o(.)253 1881 y(Password:)25
b Fb(your)o(-name)p Fh(@)p Fb(your)n(-mac)o(hine)253 1926 y
Fh(230)18 b(Guest)g(login)f(ok,)i(access)e(restrictio)o(ns)f(apply.)253
1972 y(ftp>)i(cd)h(pub)253 2018 y(250)f(CWD)h(command)d(successful.)253
2063 y(ftp>)i(binary)253 2109 y(200)g(Type)g(set)h(to)f(I.)253
2155 y(ftp>)g(get)g(CML-0.9.8.)o(tar)o(.Z)253 2200 y(ftp>)g(quit)253
2246 y(221)g(Goodbye.)253 2292 y(\045)190 2405 y Fu(Once)11
b(you)f(ha)o(v)o(e)h(the)f(compressed)i(tar)e(\256le,)h(you)e(can)i(e)o
(xtract)g(the)f(distrib)o(ution)d(by)j(the)g(command)253 2505
y Fh(\045)19 b(zcat)f(CML-0.9.8)o(.ta)o(r.Z)e(|)j(tar)f(xof)h(-)190
2619 y Fu(This)11 b(will)e(create)i(a)g(directory)e(named)i
Fp(cml-0.9.8)p Fu(,)e(which)h(is)g(the)g(root)f(of)h(the)g(distrib)o(ution.)
1070 2799 y(38)p eop
%%Page: 39 45
39 44 bop 95 82 a Fu(W)m(e)15 b(would)f(like)f(to)i(keep)g(track)g(of)f(the)h
(use)g(of)g Fr(CML)p Fu(,)g(so)g(if)f(you)g(ftp)h(a)g(copy)m(,)h(please)g
(send)f(electronic)g(mail)f(to)33 142 y Fp(sml-bugs@researc)o(h.att)o(.com)o
Fu(.)g(W)m(e)d(will)e(use)i(this)e(information)g(to)h(notify)f(people)h(of)g
(b)o(ug)g(\256x)o(es)i(and)f(other)e(minor)33 202 y(changes)i(between)f
(releases.)33 363 y Fm(8.2)57 b(Installing)16 b(CML)33 486
y Fu(If)e(you)g(plan)g(to)g(use)g Fr(CML)h Fu(on)f(a)h(re)o(gular)f(basis)h
(\(or)f(if)g(you)g(ha)o(v)o(e)h(disk)f(space)i(to)e(waste\),)i(you)d(may)i
(want)f(to)g(install)33 546 y(a)i(pre-loaded)f(v)o(ersion)h(of)f(the)h
(system.)32 b(This)16 b(can)g(be)g(done)g(using)e(the)i Fp(exportML)e
Fu(function)g(of)i Fr(SML/NJ)p Fu(,)f(b)o(ut)g(to)33 606 y(make)f(things)e
(easier)n(,)k(an)e(installation)d(script)i(\()p Fp(install-cml)p
Fu(\))f(is)h(pro)o(vided.)24 b(T)m(o)14 b(install)e Fr(CML)p
Fu(,)i(\256rst)g(change)g(to)f(the)33 665 y(root)e(directory)h(of)h(the)f
(distrib)o(ution)e(and)j(then)f(run)g(the)h Fp(install-cml)e
Fu(command.)23 b(This)13 b(command)h(recognizes)f(the)33 725
y(follo)o(wing)7 b(options:)136 839 y Fr(-o)j Fn(name)21 b
Fu(Use)11 b Fn(name)f Fu(for)g(the)g(name)h(of)f(the)h(e)o(xported)f(object)f
(\(default)g Fp(cml)p Fu(\).)136 932 y Fr(-sml)h Fn(name)21
b Fu(Use)10 b Fn(name)h Fu(for)f(the)g(name)h(of)f(the)g Fr(SML/NJ)g
Fu(e)o(x)o(ecutable)h(\(default)e Fp(sml)p Fu(\).)136 1025
y Fr(-all)20 b Fu(Load)11 b(the)f(library)f(modules)h(\(described)g(in)g
(Appendix)f(B\))h(in)f(addition)g(to)g(the)i(core)f(modules)g(of)g
Fr(CML)p Fu(.)33 1186 y Fm(8.3)57 b(Release)14 b(history)33
1309 y Fu(The)f(follo)o(wing)d(list)i(describes)i(the)e(major)h(aspects)h(of)
e(the)h Fr(CML)g Fu(release)h(history)m(.)22 b(The)13 b(distrib)o(ution)d
(includes)i(a)i(\256le)33 1369 y(named)d Fp(CHANGES)p Fu(,)e(which)h
(contains)g(a)g(more)h(detailed)f(description)f(of)h(the)g(changes)h(between)
g(v)o(ersions.)33 1491 y Fr(V)l(ersion)f(0.9.8)h(\(F)o(ebruary)g(1993\).)20
b Fu(This)11 b(public)f(release)j(is)e(the)g(\256rst)g(that)f(is)h(being)g
(included)f(in)h(the)g Fr(SML/NJ)f Fu(distri-)136 1551 y(b)o(ution.)22
b(It)13 b(\256x)o(es)h(a)f(number)g(of)g(b)o(ugs,)h(pro)o(vides)e(impro)o(v)o
(ed)h(performance,)i(and)e(a)h(ne)o(w)m(,)h(more)e(po)o(werful,)g(trace)136
1611 y(facility)c(\(thanks)h(to)f(C.)i(Krumvieda\).)33 1704
y Fr(V)l(ersion)f(0.9.7)h(\(J)o(uly)e(1992\).)20 b Fu(This)10
b(internal)f(release)j(\256x)o(ed)e(some)h(b)o(ugs)f(and)g(included)f(a)i(ne)
o(w)f(scheduling)g(mechanism)136 1763 y(that)g(impro)o(v)o(es)h(interacti)o
(v)o(e)f(responsi)o(v)o(eness)g(in)g(systems)h(like)e Fr(eXene)p
Fu(.)33 1856 y Fr(V)l(ersion)h(0.9.6)h(\(October)g(1991\).)20
b Fu(This)11 b(public)e(release)j(tracks)f(changes)g(to)f(the)h(perv)o(asi)o
(v)o(e)g(en)n(vironment)e(in)h Fr(SML/NJ)136 1916 y Fu(v)o(ersion)h(0.74.)17
b(It)10 b(also)h(\256x)o(es)h(a)g(couple)e(of)h(b)o(ugs)f(and)h(gains)g(a)g
(performance)h(boost)e(by)h(adapting)f(the)g Fn(var)i(pointer)136
1976 y Fu(to)g(hold)g(the)g(current)g(thread)g(ID)h(\(the)f(v)o(ar)g(pointer)
g(is)g(a)h(dedicated)f(re)o(gister)h(pro)o(vided)e(by)h Fr(SML/NJ)g
Fu(to)g(support)136 2036 y(multiprocessors\).)33 2129 y Fr(V)l(ersion)e
(0.9.5)h(\(J)o(uly)e(1991\).)20 b Fu(This)c(public)f(release)i(corrects)f(a)h
(typing)d(problem)h(that)g(was)h(e)o(xposed)h(by)e(compiling)136
2188 y Fr(CML)c Fu(under)f Fr(SML/NJ)f Fu(v)o(ersion)h(0.70.)33
2281 y Fr(V)l(ersion)g(0.9.4)h(\(J)o(une)g(1991\).)20 b Fu(This)11
b(is)g(the)g(second)h(major)g(public)e(release)j(of)e(CML.)h(In)f(addition)f
(to)g(\256xing)h(a)h(number)136 2341 y(of)e(b)o(ugs,)h(it)e(pro)o(vides)h(a)h
(some)o(what)f(dif)o(ferent)g(interface)g(than)g(the)g(earlier)g(releases.)33
2434 y Fr(V)l(ersion)g(0.9.3)h(\(Mar)o(ch)g(1991\).)20 b Fu(This)13
b(internal)f(release)i(was)f(used)g(for)g(the)f(benchmarks)i(presented)f(in)f
([Rep91a].)23 b(It)136 2494 y(was)11 b(the)f(\256rst)g(implementation)f(of)h
(the)g(the)g Fp(guard)g Fu(and)g Fp(abort)f Fu(operations.)33
2587 y Fr(V)l(ersion)h(0.9.2)h(\(J)o(anuary)f(1991\).)20 b
Fu(This)11 b(release)i(\256x)o(es)f(a)g(serious)f(space-leak)i(b)o(ug.)18
b(The)12 b(actual)g(\256x)f(required)g(changes)136 2647 y(to)f
Fr(SML/NJ)p Fu(,)g(so)g(this)g(v)o(ersion)g(requires)g Fr(SML/NJ)f
Fu(v)o(ersion)h(0.68,)h(or)f(later)n(.)912 2799 y(39)p eop
%%Page: 40 46
40 45 bop 190 82 a Fr(V)l(ersion)11 b(0.9)f(\(November)g(1990\).)20
b Fu(This)d(is)f(the)g(\256rst)h(public)e(release)j(of)e Fr(CML)p
Fu(.)h(It)f(is)h(based)g(on)f Fr(SML/NJ)g Fu(v)o(ersion)294
142 y(0.66,)h(and)e(contains)g(the)g(basic)h(concurrenc)o(y)g(primiti)o(v)o
(es,)g(support)d(for)i(\256rst-class)h(synchronous)e(operations,)294
202 y(multithreaded)9 b(I/O,)h(preempti)o(v)o(e)h(scheduling)e(and)h
(rudimentary)g(deb)o(ugging)e(support.)190 363 y Fm(8.4)58
b(Bug)15 b(r)o(eports)190 486 y Fu(W)m(e)h(ha)o(v)o(e)g(tested)f
Fr(CML)g Fu(on)f(the)h(follo)o(wing)d(types)j(of)g(machines:)24
b(Sun-3,)16 b(Sun-4,)g(DECStation,)f(SGI)g(Indigo)f(\(both)190
546 y(R3000)e(and)i(R4000)500 531 y Fo(1)515 546 y Fu(\),)g(IBM)f(RS/6000)f
(and)h(NeXT)h(machines.)25 b(There)14 b(are)g(no)f(kno)o(wn)f(b)o(ugs)h(in)f
(0.9.8.)25 b(Bug)12 b(reports)190 606 y(should)d(be)i(mailed)f(to)g
Fp(sml-bugs@research.)o(att.c)o(om)p Fu(;)d(please)k(using)e(the)h(follo)o
(wing)e(format:)253 705 y Fh(Submitter)o(:)271 b Fb(Y)m(our)8
b(name)g(and)h(email)g(addr)o(ess.)253 751 y Fh(Date:)370 b
Fb(The)9 b(date)f(of)i(the)f(r)o(eport.)253 797 y Fh(System\(s\))16
b(and)i(Version:)36 b(CML)253 842 y(SML/NJ)17 b(Version:)173
b Fb(The)9 b(version)e(of)i(SML/NJ)g(you)f(ar)o(e)g(using)o(.)253
888 y Fh(Machine:)310 b Fb(The)9 b(ar)o(c)o(hitectur)o(e)d(and)j(oper)o
(ating)f(system)g(you)g(ar)o(e)g(using)o(.)253 934 y Fh(Severity:)290
b Fb(How)9 b(se)o(ver)o(e)e(is)i(the)g(b)o(ug)g(\(major)l(,)g(minor\)?)253
979 y Fh(Problem:)310 b Fb(A)10 b(short)e(description)f(of)j(the)f(pr)n
(oblem.)253 1025 y Fh(Transcrip)o(t:)251 b Fb(A)10 b(short)e(e)o(xample)g
(that)h(e)o(xhibits)g(the)g(b)o(ug,)g(and)f(the)h(output)g(tr)o(anscript)253
1071 y Fh(Comments:)290 b Fb(Any)9 b(aditional)g(comments.)253
1116 y Fh(Fix:)390 b Fb(Extr)o(a)9 b(points)g(for)g(\256lling)g(in)h(this)f
(\256eld!!)190 1230 y Fu(A)i(template)f(for)g(this)f(format)h(is)g(gi)o(v)o
(en)g(in)g(the)g(\256le)g Fp(doc/cml-bug-form)p Fu(.)p 190
2635 720 2 v 236 2662 a Fl(1)250 2674 y Fk(There)e(is)g(a)g(kno)o(wn)f
(hardware)g(b)o(ug)g(in)h(the)g(R4000)f(chip)h(that)g(can)f(cause)g
Fg(SML)i Fk(\(and)f(thus)f Fg(CML)p Fk(\))i(to)f(crash.)1070
2799 y Fu(40)p eop
%%Page: 41 47
41 46 bop 33 435 a Fs(Bibliograph)n(y)33 667 y Fu([Agh86])19
b(Agha,)c(G.)23 b Fn(Actors:)f(A)14 b(Model)e(of)h(Concurr)n(ent)h
(Computation)c(in)j(Distrib)o(uted)f(Systems)p Fu(.)24 b(The)14
b(MIT)g(Press,)183 717 y(Cambridge,)c(Mass.,)h(1986.)33 800
y([ASS85])20 b(Abelson,)14 b(H.,)h(G.)e(Sussman,)j(and)d(J.)h(Sussman.)24
b Fn(Structur)n(e)13 b(and)g(Interpr)n(etation)f(of)h(Computer)f(Pr)n(ogr)o
(ams)p Fu(.)183 850 y(The)e(MIT)h(Press,)g(Cambridge,)g(Mass.,)g(1985.)33
933 y([Bor86])19 b(Bornat,)8 b(R.)j(A)e(protocol)d(for)i(generalized)h
(occam.)k Fn(Softwar)n(e)7 b(\261)h(Pr)o(actice)i(and)d(Experience)p
Fu(,)k Fr(16)p Fu(\(9\),)d(September)183 983 y(1986,)h(pp.)i(783\261799.)33
1065 y([DHM91])19 b(Duba,)13 b(B.,)g(R.)f(Harper)n(,)h(and)f(D.)g(MacQueen.)
21 b(T)m(ype-checking)11 b(\256rst-class)h(continuations.)17
b(In)12 b Fn(Confer)n(ence)183 1115 y(Recor)n(d)k(of)f(the)g(18th)f(Annual)g
(A)o(CM)h(Symposium)f(on)h(Principles)g(of)f(Pr)n(ogr)o(amming)g(Languages)p
Fu(,)i(January)183 1165 y(1991,)9 b(pp.)i(163\261173.)33 1248
y([GNV88])19 b(Gansner)n(,)12 b(E.)f(R.,)g(S.)g(C.)f(North,)g(and)h(K.)f(P)-5
b(.)12 b(V)-5 b(o.)14 b(D)n(A)n(G)d(\261)g(a)g(program)f(that)f(dra)o(ws)i
(directed)f(graphs.)16 b Fn(Softwar)n(e)183 1298 y(\261)10
b(Pr)o(actice)h(and)f(Experience)p Fu(,)i Fr(18)p Fu(\(11\),)e(No)o(v)o
(ember)h(1988,)f(pp.)g(1047\2611062.)33 1381 y([Hal85])20 b(Halstead,)10
b(Jr)n(.,)g(R.)g(H.)j(Multilisp:)f(A)d(language)h(for)f(concurrent)g
(symbolic)f(computation.)13 b Fn(A)o(CM)c(T)n(r)o(ansactions)183
1430 y(on)g(Pr)n(ogr)o(amming)h(Languages)f(and)g(Systems)p
Fu(,)i Fr(7)p Fu(\(4\),)f(October)g(1985,)g(pp.)g(501\261538.)33
1513 y([Har86])20 b(Harper)n(,)h(R.)35 b(Introduction)15 b(to)i(Standard)h
(ML.)35 b Fn(T)l(ec)o(hnical)19 b(Report)e(ECS-LFCS-86-14)p
Fu(,)i(Laboratory)e(for)183 1563 y(F)o(oundations)12 b(of)i(Computer)f
(Science,)j(Computer)d(Science)i(Department,)h(Edinb)o(ur)o(gh)d(Uni)o(v)o
(ersity)m(,)h(August)183 1613 y(1986.)33 1696 y([McI90])20
b(McIlroy)m(,)11 b(M.)h(D.)20 b(Squinting)9 b(at)j(po)o(wer)g(series.)20
b Fn(Softwar)n(e)10 b(\261)i(Pr)o(actice)h(and)e(Experience)p
Fu(,)k Fr(20)p Fu(\(7\),)c(July)g(1990,)183 1745 y(pp.)f(661\261683.)33
1828 y([MTH90])20 b(Milner)n(,)10 b(R.,)h(M.)g(T)m(ofte,)g(and)f(R.)h(Harper)
n(.)16 b Fn(The)11 b(De\256nition)d(of)i(Standar)n(d)g(ML)p
Fu(.)15 b(The)c(MIT)g(Press,)h(Cambridge,)183 1878 y(Mass,)f(1990.)33
1961 y([P)o(au91])20 b(P)o(aulson,)15 b(L.)g(C.)25 b Fn(ML)13
b(for)h(the)f(W)l(orking)g(Pr)n(ogr)o(ammer)p Fu(.)26 b(Cambridge)13
b(Uni)o(v)o(ersity)g(Press,)j(Ne)o(w)e(Y)-5 b(ork,)15 b(N.Y)-5
b(.,)183 2011 y(1991.)33 2094 y([Ram90])20 b(Ramse)o(y)m(,)e(N.)28
b(Concurrent)14 b(programming)g(in)g(ML.)28 b Fn(T)l(ec)o(hnical)15
b(Report)g(CS-TR-262-90)p Fu(,)g(Department)g(of)183 2143 y(Computer)9
b(Science,)j(Princeton)d(Uni)o(v)o(ersity)m(,)h(April)f(1990.)33
2226 y([Rep88])19 b(Reppy)m(,)e(J.)f(H.)30 b(Synchronous)15
b(operations)f(as)j(\256rst-class)e(v)o(alues.)30 b(In)15 b
Fn(Pr)n(oceedings)i(of)e(the)g(SIGPLAN'88)183 2276 y(Confer)n(ence)c(on)f(Pr)
n(ogr)o(amming)f(Language)g(Design)h(and)f(Implementation)p
Fu(,)g(June)h(1988,)g(pp.)g(250\261259.)33 2359 y([Rep89])19
b(Reppy)m(,)c(J.)f(H.)24 b(First-class)13 b(synchronous)g(operations)f(in)h
(Standard)h(ML.)24 b Fn(T)l(ec)o(hnical)14 b(Report)g(TR)g(89-1068)p
Fu(,)183 2409 y(Department)c(of)g(Computer)f(Science,)j(Cornell)d(Uni)o(v)o
(ersity)m(,)h(December)i(1989.)33 2492 y([Rep90])19 b(Reppy)m(,)11
b(J.)h(H.)k(Asynchronous)10 b(signals)g(in)g(Standard)h(ML.)17
b Fn(T)l(ec)o(hnical)11 b(Report)g(TR)g(90-1144)p Fu(,)f(Department)h(of)183
2541 y(Computer)e(Science,)j(Cornell)d(Uni)o(v)o(ersity)m(,)g(August)h(1990.)
33 2624 y([Rep91a])20 b(Reppy)m(,)d(J.)g(H.)30 b(CML:)15 b(A)h(higher)o
(-order)f(concurrent)h(language.)30 b(In)15 b Fn(Pr)n(oceedings)i(of)e(the)h
(SIGPLAN'91)183 2674 y(Confer)n(ence)11 b(on)f(Pr)n(ogr)o(amming)f(Language)g
(Design)h(and)f(Implementation)p Fu(,)g(June)h(1991,)g(pp.)g(293\261305.)912
2799 y(41)p eop
%%Page: 42 48
42 47 bop 190 82 a Fu([Rep91b])20 b(Reppy)m(,)10 b(J.)h(H.)j(An)c
(operational)f(semantics)i(of)f(\256rst-class)g(synchronous)f(operations.)14
b Fn(T)l(ec)o(hnical)d(Report)f(TR)340 132 y(91-1232)p Fu(,)f(Department)i
(of)f(Computer)f(Science,)j(Cornell)d(Uni)o(v)o(ersity)m(,)h(August)f(1991.)
190 215 y([Rep92])20 b(Reppy)m(,)d(J.)g(H.)30 b Fn(Higher)o(-or)n(der)16
b(concurr)n(ency)p Fu(.)33 b(Ph.D.)16 b(dissertation,)g(Department)g(of)g
(Computer)f(Science,)340 265 y(Cornell)9 b(Uni)o(v)o(ersity)m(,)h(Ithaca,)h
(NY)-5 b(,)10 b(January)h(1992.)j(A)m(v)o(ailable)c(as)h(T)m(echnical)g
(Report)e(TR)i(92-1285.)190 348 y([T)m(ol90])25 b(T)m(olmach,)19
b(A.)e(P)-5 b(.)32 b Fn(Deb)o(ugging)15 b(in)h(Standar)n(d)f(ML)i(of)f(Ne)o
(w)g(J)o(erse)o(y)p Fu(.)33 b(Department)17 b(of)f(Computer)g(Science,)340
398 y(Princeton)10 b(Uni)o(v)o(ersity)m(,)f(Princeton,)h(N.J.,)i(1990.)1070
2799 y(42)p eop
%%Page: 43 49
43 48 bop 33 414 a Fi(A)n(ppendix)20 b(A)33 643 y Fs(The)26
b(top-le)n(v)o(el)e(en)l(vir)n(onment)33 889 y Fu(The)16 b(top-le)o(v)o(el)e
Fr(CML)h Fu(en)n(vironment)g(consists)f(of)h(four)g(structures;)i(this)d
(appendix)g(lists)h(these)g(with)f(their)h(interface)33 949
y(signatures.)29 b(These)17 b(structures)e(are)h(implemented)f(as)h
(functors,)g(the)f(source)h(code)g(of)f(which)f(can)i(be)g(found)e(in)h(the)
33 1009 y(directory)9 b Fp(cml-0.9.8/src)p Fu(.)14 b(The)e(follo)o(wing)c
(table)j(lists)e(the)i(top-le)o(v)o(el)f(structures,)g(with)g(the)h(source)g
(\256le)g(and)f(a)i(short)33 1068 y(description)d(of)g(each)j(structure:)p
246 1129 1374 2 v 245 1191 2 63 v 254 1191 V 281 1172 a Fr(Structur)o(e)p
477 1191 V 103 w(Sour)o(ce)g(\256le)p 811 1191 V 372 w(Description)p
1610 1191 V 1619 1191 V 246 1193 1374 2 v 245 1301 2 109 v
254 1301 V 279 1236 a Fp(CML)p 477 1301 V 158 w(concur.sml)p
811 1301 V 113 w Fu(The)d(core)f(structure)f(of)g Fr(CML)p
Fu(;)h(it)f(de\256nes)h(threads,)836 1286 y(channels)j(and)f(e)o(v)o(ents.)p
1610 1301 V 1619 1301 V 246 1303 1374 2 v 245 1411 2 109 v
254 1411 V 279 1346 a Fp(RunCML)p 477 1411 V 92 w(run.sml)p
811 1411 V 179 w Fu(Pro)o(vides)i(support)f(for)h(initialization)d(and)j
(termi-)836 1396 y(nation)d(of)h Fr(CML)h Fu(programs.)p 1610
1411 V 1619 1411 V 246 1413 1374 2 v 245 1475 2 63 v 254 1475
V 279 1456 a Fp(CIO)p 477 1475 V 158 w(cio.sml)p 811 1475 V
179 w Fu(A)g(multi-threaded)d(input/output)f(facility)m(.)p
1610 1475 V 1619 1475 V 246 1477 1374 2 v 245 1585 2 109 v
254 1585 V 279 1520 a Fp(TraceCML)p 477 1585 V 48 w(trace-cml.sml)p
811 1585 V 47 w Fu(Support)29 b(for)h(diagnostic)f(output)g(and)i(error)836
1570 y(catching)p 1610 1585 V 1619 1585 V 246 1587 1374 2 v
33 1715 a Fm(A.1)57 b Fa(CML)33 1838 y Fu(The)11 b(structure)e
Fp(CML)h Fu(pro)o(vides)g(the)g(core)h(functionality)c(of)j(the)g
Fr(CML)g Fu(system.)16 b(See)c(Chapters)d(2)i(and)f(3)g(for)g(a)h(discussion)
33 1898 y(of)f(its)f(facilities.)14 b(This)c(structure)g(has)h(the)f(follo)o
(wing)e(signature:)33 2035 y Fh(signature)16 b(CONCUR_ML)g(=)72
2081 y(sig)111 2172 y(val)j(version)d(:)k({major)d(:)i(int,)f(minor)g(:)h
(int,)f(rev)h(:)g(int,)f(date)g(:)h(string})111 2218 y(val)g(versionN)o(ame)d
(:)j(string)72 2309 y(\(**)f(events)g(**\))111 2355 y(type)g('a)h(event)111
2446 y(val)g(sync)57 b(:)19 b('a)g(event)f(->)g('a)111 2492
y(val)h(select)e(:)i('a)g(event)f(list)g(->)h('a)111 2537 y(val)g(poll)57
b(:)19 b('a)g(event)f(->)g('a)h(option)111 2628 y(val)g(choose)e(:)i('a)g
(event)f(list)g(->)h('a)f(event)912 2799 y Fu(43)p eop
%%Page: 44 50
44 49 bop 269 82 a Fh(val)18 b(guard)g(:)h(\(unit)f(->)h('a)g(event\))e(->)i
('a)g(event)269 174 y(val)f(wrap)156 b(:)19 b(\('a)f(event)g(*)h(\('a)g(->)g
('b\)\))f(->)g('b)h(event)269 219 y(val)f(wrapHandle)o(r)f(:)i(\('a)f(event)g
(*)h(\(exn)f(->)h('a\)\))f(->)h('a)g(event)269 265 y(val)f(wrapAbort)56
b(:)19 b(\('a)f(event)g(*)h(\(unit)f(->)h(unit\)\))e(->)i('a)g(event)269
356 y(val)f(always)g(:)h('a)g(->)g('a)f(event)269 402 y(val)g(ALWAYS)g(:)h
(unit)f(event)76 b(\(*)19 b(for)g(backward)d(compatibil)o(ity)g(*\))230
493 y(\(**)i(threads)f(**\))269 539 y(type)h(thread_id)269
630 y(val)g(spawn)g(:)h(\(unit)f(->)h(unit\))e(->)i(thread_id)269
721 y(val)f(yield)g(:)h(unit)f(->)h(unit)269 767 y(val)f(exit)g(:)i(unit)e
(->)h('a)269 858 y(val)f(getTid)g(:)h(unit)f(->)h(thread_id)269
904 y(val)f(sameThread)e(:)j(\(thread_id)d(*)j(thread_id\))d(->)j(bool)269
950 y(val)f(tidLessTha)o(n)f(:)i(\(thread_i)o(d)e(*)i(thread_id)o(\))e(->)h
(bool)269 995 y(val)g(tidToStrin)o(g)f(:)i(thread_id)d(->)j(string)269
1087 y(val)f(threadWait)e(:)j(thread_id)d(->)j(unit)f(event)230
1178 y(\(**)g(condition)e(variables)g(**\))269 1224 y(type)i('a)h(cond_var)
269 1315 y(val)f(condVar)f(:)i(unit)g(->)f('1a)h(cond_var)269
1406 y(val)f(writeVar)f(:)i(\('a)g(cond_var)d(*)j('a\))g(->)g(unit)269
1452 y(exception)d(WriteTwice)269 1543 y(val)i(readVar)f(:)i('a)g(cond_var)e
(->)i('a)269 1589 y(val)f(readVarEvt)e(:)j('a)g(cond_var)e(->)h('a)h(event)
230 1680 y(\(**)f(channels)f(**\))269 1726 y(type)h('a)h(chan)269
1817 y(val)f(channel)f(:)i(unit)g(->)f('1a)h(chan)269 1909
y(val)f(send)58 b(:)19 b(\('a)f(chan)g(*)i('a\))e(->)h(unit)269
1954 y(val)f(sendc)38 b(:)19 b('a)g(chan)f(->)h('a)f(->)h(unit)269
2000 y(val)f(accept)g(:)h('a)g(chan)f(->)h('a)269 2091 y(val)f(sameChanne)o
(l)f(:)i(\('a)f(chan)g(*)i('a)e(chan\))g(->)h(bool)269 2183
y(val)f(transmit)36 b(:)20 b(\('a)e(chan)g(*)h('a\))g(->)g(unit)f(event)269
2228 y(val)g(transmitc)e(:)k('a)f(chan)f(->)g('a)h(->)g(unit)f(event)269
2274 y(val)g(receive)56 b(:)20 b('a)f(chan)f(->)g('a)h(event)230
2365 y(\(**)f(real-time)e(synchroniz)o(ati)o(on)g(**\))269
2411 y(datatype)g(time)i(=)i(TIME)e(of)h({sec)f(:)h(int,)f(usec)g(:)h(int})38
b(\(*)19 b(from)f(System.Ti)o(mer)e(*\))308 2457 y(sharing)h(type)h(time)g(=)
h(System.Tim)o(er.)o(tim)o(e)269 2502 y(val)f(waitUntil)e(:)k(time)e(->)h
(unit)f(event)269 2548 y(val)g(timeout)56 b(:)20 b(time)e(->)h(unit)f(event)
230 2639 y(\(*)g(low-level)f(I/O)h(support)f(\(not)h(for)g(general)f(use\))h
(*\))1070 2799 y Fu(44)p eop
%%Page: 45 51
45 50 bop 111 82 a Fh(exception)16 b(InvalidFil)o(eDe)o(sc)g(of)j(int)111
128 y(val)g(syncOnIn)o(put)36 b(:)19 b(int)f(->)h(unit)f(event)111
174 y(val)h(syncOnOu)o(tpu)o(t)e(:)i(int)f(->)h(unit)f(event)111
219 y(val)h(syncOnEx)o(cep)o(t)e(:)i(int)f(->)h(unit)f(event)72
310 y(end)g(\(*)h(signature)d(CONCUR_ML)g(*\))33 503 y Fm(A.2)57
b Fa(RunCml)33 626 y Fu(The)18 b(structure)f Fp(RunCML)f Fu(pro)o(vides)h
(the)g(bookkeeping)f(code)i(for)f(starting)f(and)i(terminating)e
Fr(CML)h Fu(programs)h(\(see)33 686 y(Chapter)9 b(6\).)15 b(It)10
b(has)h(the)f(follo)o(wing)e(signature:)95 785 y Fh(signature)16
b(RUN_CML)h(=)134 830 y(sig)173 876 y(structure)g(CML)h(:)h(CONCUR_ML)134
967 y(\(*)g(log/unlog)d(channels)h(and)h(servers)f(for)h(initializat)o(io)o
(n)f(and)h(terminatio)o(n)e(*\))173 1013 y(exception)h(Unlog)173
1059 y(val)i(logChanne)o(l)e(:)i(\(string)e(*)i('a)g(CML.chan\))d(->)j(unit)
173 1104 y(val)g(unlogChan)o(nel)d(:)j(string)e(->)i(unit)173
1150 y(val)g(logServer)d(:)j(\(string)e(*)i(\(unit)f(->)h(unit\))f(*)h
(\(unit)e(->)i(unit\)\))f(->)g(unit)173 1196 y(val)h(unlogServ)o(er)d(:)j
(string)f(->)h(unit)173 1241 y(val)g(unlogAll)d(:)k(unit)e(->)g(unit)134
1333 y(\(*)h(run)f(the)h(system)e(*\))173 1378 y(val)i(doit)f(:)h(\(\(unit)e
(->)i(unit\))f(*)h(int)g(option\))e(->)h(unit)173 1424 y(exception)f(Running)
134 1515 y(\(*)i(export)e(a)j(CML)e(program)f(*\))173 1561
y(val)i(exportFn)d(:)k(\(string)c(*)k(\(\(string)c(list)i(*)i(string)d
(list\))h(->)g(unit\))g(*)h(int)g(option\))291 1606 y(->)g(unit)134
1698 y(\(*)g(shutdown)e(a)i(run)f(*\))173 1743 y(val)h(shutdown)d(:)k(unit)e
(->)g('a)173 1789 y(exception)f(NotRunni)o(ng)134 1880 y(end)i(\(*)f(RUN_CML)
f(*\))33 2073 y Fm(A.3)57 b Fa(CIO)33 2196 y Fu(The)10 b Fp(CIO)g
Fu(structure)f(implements)h(a)g(concurrent)g(v)o(ersion)f(of)h(most)g(of)f
(the)h Fr(SML/NJ)f Fu(IO)h(operations)f(\(see)i(Chapter)e(5\).)15
b(It)33 2256 y(has)10 b(the)g(follo)o(wing)e(signature:)33
2400 y Fh(signature)16 b(CONCUR_IO)g(=)72 2446 y(sig)111 2492
y(structure)g(CML)j(:)g(CONCUR_ML)111 2583 y(exception)d(Io)j(of)g(string)111
2674 y(type)f(instream)912 2799 y Fu(45)p eop
%%Page: 46 52
46 51 bop 269 82 a Fh(type)18 b(outstream)269 174 y(val)g(std_in)g(:)h
(instream)269 219 y(val)f(std_out)f(:)i(outstream)269 265 y(val)f(std_err)f
(:)i(outstream)269 356 y(val)f(open_in)f(:)i(string)f(->)h(instream)269
402 y(val)f(open_strin)o(g)f(:)i(string)e(->)i(instream)269
447 y(val)f(open_out)f(:)i(string)e(->)i(outstream)269 493
y(val)f(open_appen)o(d)f(:)i(string)e(->)i(outstream)269 539
y(val)f(execute)f(:)i(\(string)e(*)j(string)d(list\))h(->)g(\(instream)f(*)i
(outstream)o(\))269 584 y(val)f(execute_in)o(_en)o(v)f(:)i(\(string)e(*)i
(string)e(list)h(*)h(string)f(list\))387 630 y(->)g(\(instream)f(*)i
(outstream)o(\))269 721 y(exception)d(ClosedStre)o(am)269 767
y(val)i(openChanIn)36 b(:)19 b(unit)f(->)h(\(\(string)d(->)j(unit\))f(*)h
(instream\))269 813 y(val)f(openChanOu)o(t)f(:)i(unit)f(->)h(\(string)e
(CML.event)f(*)j(outstream\))269 904 y(val)f(close_in)f(:)i(instream)e(->)h
(unit)269 950 y(val)g(close_out)e(:)k(outstream)c(->)j(unit)269
1041 y(val)f(can_input)e(:)k(instream)c(->)j(int)269 1087 y(val)f(lookahead)e
(:)k(instream)c(->)j(string)269 1132 y(val)f(input)g(:)h(instream)e(*)i(int)f
(->)h(string)269 1178 y(val)f(inputc)g(:)h(instream)d(->)j(int)g(->)f(string)
269 1224 y(val)g(input_line)e(:)j(instream)e(->)i(string)269
1269 y(val)f(end_of_str)o(eam)e(:)j(instream)e(->)h(bool)269
1361 y(val)g(lookaheadE)o(vt)e(:)k(instream)c(->)j(string)e(CML.event)269
1406 y(val)h(inputEvt)f(:)i(instream)e(*)i(int)f(->)h(string)e(CML.event)269
1452 y(val)h(inputcEvt)e(:)k(instream)c(->)j(int)f(->)h(string)f(CML.event)
269 1498 y(val)g(inputLineE)o(vt)e(:)k(instream)c(->)j(string)e(CML.event)269
1589 y(val)h(output)g(:)h(outstream)d(*)j(string)e(->)i(unit)269
1635 y(val)f(outputc)f(:)i(outstream)e(->)h(string)g(->)h(unit)269
1680 y(val)f(flush_out)e(:)k(outstream)c(->)j(unit)269 1772
y(val)f(print)g(:)h(string)f(->)g(unit)230 1863 y(end)g(\(*)h(CONCUR_IO)d
(*\))190 2057 y Fm(A.4)58 b Fa(TraceCML)190 2181 y Fu(The)12
b Fp(TraceCML)e Fu(structure)g(pro)o(vides)h(support)e(for)i(deb)o(uggin)f
Fr(CML)h Fu(program)g(\(see)h(Chapter)f(7\).)17 b(It)11 b(has)g(the)g(follo)o
(wing)190 2240 y(signature:)190 2386 y Fh(signature)17 b(TRACE_CM)o(L)g(=)230
2431 y(sig)269 2523 y(structure)f(CML)i(:)i(CONCUR_ML)269 2568
y(structure)c(CIO)i(:)i(CONCUR_IO)230 2660 y(\(**)e(Trace)g(modules)f(**\))
1070 2799 y Fu(46)p eop
%%Page: 47 53
47 52 bop 111 128 a Fh(type)18 b(trace_modu)o(le)111 219 y(val)h(traceRoo)o
(t)e(:)i(trace_mod)o(ule)111 310 y(exception)d(NoSuchModu)o(le)111
402 y(val)j(traceMod)o(ule)d(:)j(\(trace_mod)o(ule)d(*)j(string\))e(->)i
(trace_mod)o(ul)o(e)111 447 y(val)g(nameOf)e(:)i(trace_modu)o(le)d(->)j
(string)111 493 y(val)g(moduleOf)d(:)j(string)f(->)g(trace_modul)o(e)111
584 y(val)h(traceOn)d(:)k(trace_mod)o(ul)o(e)d(->)i(unit)111
630 y(val)g(traceOff)d(:)j(trace_modu)o(le)d(->)j(unit)111
676 y(val)g(traceOnl)o(y)e(:)i(trace_mod)o(ule)d(->)j(unit)111
721 y(val)g(amTracin)o(g)e(:)i(trace_mod)o(ule)d(->)j(bool)111
813 y(val)g(status)e(:)i(trace_modu)o(le)d(->)j(\(trace_mo)o(dul)o(e)d(*)k
(bool\))d(list)111 904 y(val)i(trace)e(:)i(\(trace_modu)o(le)d(*)j(\(unit)f
(->)h(string)e(list\)\))g(->)i(unit)111 995 y(datatype)e(trace_to)150
1041 y(=)j(TraceToO)o(ut)150 1087 y(|)g(TraceToE)o(rr)150 1132
y(|)g(TraceToN)o(ull)150 1178 y(|)g(TraceToF)o(ile)c(of)j(string)150
1224 y(|)h(TraceToS)o(tre)o(am)c(of)j(CIO.outstr)o(ea)o(m)111
1315 y(val)g(setTrace)o(Fil)o(e)e(:)i(trace_to)d(->)j(unit)72
1406 y(\(**)f(Thread)g(watching)e(**\))111 1498 y(val)j(watcher)d(:)k
(trace_mod)o(ul)o(e)111 1543 y(val)f(watch)e(:)i(\(string)e(*)j(CML.threa)o
(d_)o(id\))c(->)j(unit)111 1589 y(val)g(unwatch)d(:)k(CML.threa)o(d_)o(id)c
(->)j(unit)72 1680 y(\(**)f(Uncaught)f(exception)f(handling)h(**\))111
1772 y(val)i(setUncau)o(ght)o(Fn)d(:)j(\(\(CML.threa)o(d_)o(id)d(*)j(exn\))f
(->)h(unit\))f(->)h(unit)111 1817 y(val)g(setHandl)o(eFn)d(:)j(\(\(CML.thre)o
(ad_)o(id)d(*)j(exn\))f(->)h(bool\))f(->)h(unit)111 1863 y(val)g(resetUnc)o
(aug)o(htF)o(n)d(:)k(unit)e(->)h(unit)72 1954 y(end;)f(\(*)h(TRACE_CML)d(*\))
912 2799 y Fu(47)p eop
%%Page: 48 54
48 53 bop 190 414 a Fi(A)n(ppendix)21 b(B)190 643 y Fs(The)26
b(CML)g(Library)190 889 y Fu(This)13 b(release)h(of)f Fr(CML)g
Fu(includes)f(a)h(small)g(library)f(of)g(modules)h(implementing)f(some)h
(common)g(concurrent)g(idioms;)190 949 y(it)k(will)g(be)h(e)o(xpanded)h(in)e
(future)g(releases)i(of)f Fr(CML)p Fu(.)g(This)g(appendix)f(describes)h(the)g
(interfaces)g(of)f(these)i(library)190 1009 y(modules)c(\(which)e(include)h
(the)g(b)o(uf)o(fered)g(channels)h(used)f(in)g(Example)h(1.8\).)28
b(The)o(y)15 b(can)g(be)f(found)g(in)f(the)i(directory)190
1068 y Fp(cml-0.9.8/library)p Fu(;)7 b(the)j(follo)o(wing)e(table)i(lists)f
(them)h(with)g(their)f(source)i(\256le)f(and)h(a)f(short)g(description:)p
371 1137 1440 2 v 370 1200 2 63 v 379 1200 V 450 1181 a Fr(Structur)o(e)p
690 1200 V 136 w(Sour)o(ce)i(\256le)p 1001 1200 V 360 w(Description)p
1801 1200 V 1810 1200 V 371 1201 1440 2 v 370 1264 2 63 v 379
1264 V 404 1245 a Fp(Plumbing)p 690 1264 V 135 w(plumbing.sml)p
1001 1264 V 48 w Fu(Fixtures)d(for)h(connecting)f(threads.)p
1801 1264 V 1810 1264 V 371 1265 1440 2 v 370 1328 2 63 v 379
1328 V 404 1309 a Fp(BufferChan)p 690 1328 V 91 w(buffer.sml)p
1001 1328 V 92 w Fu(Buf)o(fered)h(channels.)p 1801 1328 V 1810
1328 V 371 1329 1440 2 v 370 1392 2 63 v 379 1392 V 404 1373
a Fp(Future)p 690 1392 V 179 w(future.sml)p 1001 1392 V 92
w Fr(Multi-lisp)e Fu(style)i(futures.)p 1801 1392 V 1810 1392
V 371 1393 1440 2 v 370 1455 2 63 v 379 1455 V 404 1437 a Fp(Cobegin)p
690 1455 V 157 w(cobegin.sml)p 1001 1455 V 70 w Fu(Cobe)o(gin/end)f(with)g
(barrier)h(synchronization.)p 1801 1455 V 1810 1455 V 371 1457
1440 2 v 370 1519 2 63 v 379 1519 V 404 1501 a Fp(ConcurCallCC)p
690 1519 V 47 w(callcc.sml)p 1001 1519 V 92 w Fu(A)g(\252safe\272)i(v)o
(ersion)e(of)g Fp(callcc)f Fu(and)i Fp(throw)p Fu(.)p 1801
1519 V 1810 1519 V 371 1521 1440 2 v 190 1607 a(If)h(your)f(v)o(ersion)g(of)g
Fr(CML)h Fu(is)f(installed)g(with)f(the)i(library)e(\(see)j(section)e(8.2\),)
h(then)f(these)h(modules)g(will)e(be)i(de\256ned)g(in)190 1667
y(the)g(top-le)o(v)o(el)e(en)n(vironment,)h(otherwise)g(you)g(must)g(load)g
(them)g(indi)o(vidually)m(.)16 b(These)d(structures)d(are)j(implemented)e(as)
190 1727 y(functors,)f(so)f(to)g(load)g(one)h(requires)f(both)g(reading)g(in)
g(the)g(source)h(\256le)g(and)f(applying)f(the)h(resulting)f(functor)n(.)14
b(The)c(rest)g(of)190 1787 y(this)g(appendix)f(gi)o(v)o(es)i(the)f(signature)
f(and)i(a)f(description)f(of)h(each)i(library)d(module.)190
1948 y Fm(B.1)58 b(Plumbing)190 2071 y Fu(The)17 b(structure)f
Fp(Plumbing)e Fu(contains)i(v)o(arious)g(functions)e(for)i(connecting)g
(networks)f(of)h(processes)h(together)n(.)32 b(It)16 b(is)190
2131 y(de\256ned)11 b(by)f(the)g(functor)253 2230 y Fh(functor)17
b(Plumbing)f(\(CML)i(:)h(CONCUR_ML\))d(:)j(PLUMBING)190 2344
y Fu(and)11 b(has)f(the)h(follo)o(wing)c(signature:)1070 2799
y(48)p eop
%%Page: 49 55
49 54 bop 95 82 a Fh(signature)16 b(PLUMBING)h(=)134 128 y(sig)173
174 y(structure)g(CML)h(:)h(CONCUR_ML)173 219 y(val)g(sink)f(:)h('a)g
(CML.event)d(->)j(unit)173 265 y(val)g(source)e(:)i('1a)g(->)g('1a)f
(CML.event)173 310 y(val)h(iterate)e(:)i(\('1a)f(*)h(\('1a)f(->)h('1a\)\))f
(->)h('1a)f(CML.event)173 356 y(val)h(connect)e(:)i(\('a)f(CML.event)f(*)i
(\('a)f(->)h(unit)f(CML.event\))o(\))f(->)h(unit)173 402 y(val)h(filter)e(:)i
(\('a)g(CML.event)d(*)j(\('a)g(->)f('b\))h(*)g(\('b)g(->)f(unit)h(CML.even)o
(t\)\))d(->)j(unit)134 447 y(end)g(\(*)f(PLUMBING)f(*\))33
561 y Fu(The)10 b(functions)f Fp(source)g Fu(and)i Fp(sink)e
Fu(pro)o(vide)h(end-points)e(for)i(a)g(network)f(of)h(threads)g(\(Note)g
(that)g Fp(source)f Fu(is)h(really)g(just)33 621 y Fp(always)p
Fu(\).)k(W)m(e)c(can)h(connect)g(them)f(to)g(form)g(a)h(\(useless\))f
(network:)95 721 y Fh(sink)18 b(\(source)f(1\))33 834 y Fu(In)8
b(this)h(e)o(xample)h Fp(source)e Fu(will)f(produce)i(an)h(in\256nite)d
(stream)j(of)f Fp(1)p Fu(s,)h(which)e(will)g(be)h(consumed)h(by)e
Fp(sink)p Fu(.)15 b(The)9 b(function)33 894 y Fp(iterate)14
b Fu(also)h(produces)g(an)h(in\256nite)e(stream)i(of)f(v)o(alues,)j(b)o(ut)c
(each)j(v)o(alue)e(is)g(computed)h(from)f(the)g(pre)o(vious.)30
b(F)o(or)33 954 y(e)o(xample,)11 b(the)g(stream)g(of)f(numbers)g(that)g(we)g
(used)h(in)e(Example)i(1.3)g(could)e(ha)o(v)o(e)j(been)e(pro)o(vided)g(by:)95
1054 y Fh(iterate)17 b(\(2,)h(fn)h(x)g(=>)g(\(x)g(+)g(1\)\))33
1167 y Fu(The)11 b(functions)f Fp(connect)f Fu(and)i Fp(filter)f
Fu(pro)o(vide)g(connections)g(between)h(threads.)17 b(F)o(or)11
b(e)o(xample,)h(the)f(follo)o(wing)d(code)33 1227 y(will)h(print)f(the)j
(numbers)f(from)g Fp(1)g Fu(to)g Fp(n)p Fu(:)95 1327 y Fh(fun)18
b(printN)g(n)h(=)g(let)134 1372 y(open)f(Plumbing)134 1418
y(val)h(ch)f(=)i(CML.chann)o(el)o(\(\))134 1464 y(in)173 1509
y(filter)e(\()213 1555 y(iterate)f(\(1,)h(fn)h(x)g(=>)g(\(if)f(\(x)h(>=)g
(n\))g(then)f(CML.exit\()o(\))f(else)h(x+1\)\),)213 1601 y(fn)g(x)i(=>)f
(CIO.prin)o(t\(m)o(ak)o(est)o(rin)o(g)d(x)k(^)f("\\n"\),)213
1646 y(fn)f(x)i(=>)f(CML.tran)o(smi)o(t\()o(ch,)d(x\)\);)173
1692 y(sink\(CML.re)o(ce)o(ive)g(ch\))134 1738 y(end)33 1851
y Fu(This)9 b(e)o(xample)h(uses)g Fp(iterate)e Fu(to)h(generate)h(the)f
(numbers;)g Fp(filter)f Fu(to)h(print)f(them;)h(and)g Fp(sink)g
Fu(to)g(pro)o(vide)f(the)h(demand)33 1911 y(to)g(keep)i(the)f(\257o)o(w)g
(going.)33 2072 y Fm(B.2)57 b(Buffer)o(ed)15 b(channels)33
2196 y Fu(Buf)o(fered)9 b(channels)i(pro)o(vide)e(a)i(means)g(of)f
(asynchronous)g(communication.)k(This)c(facility)f(is)h(pro)o(vided)f(by)h
(the)g(functor)95 2295 y Fh(functor)17 b(BufferCha)o(n)g(\(CML)h(:)h
(CONCUR_ML)o(\))e(:)i(BUFFER_CH)o(AN)33 2409 y Fu(which)9 b(has)i(the)f
(follo)o(wing)e(signature:)912 2799 y(49)p eop
%%Page: 50 56
50 55 bop 253 82 a Fh(signature)16 b(BUFFER_CH)o(AN)g(=)292
128 y(sig)331 174 y(structure)g(CML)j(:)g(CONCUR_ML)331 219
y(type)f('a)h(buffer_cha)o(n)331 265 y(val)g(buffer)e(:)i(unit)f(->)h('1a)f
(buffer_chan)331 310 y(val)h(bufferIn)d(:)j('1a)g(CML.chan)d(->)j('1a)g
(buffer_ch)o(an)331 356 y(val)g(bufferOu)o(t)e(:)i('1a)f(CML.chan)f(->)i('1a)
f(buffer_cha)o(n)331 402 y(val)h(bufferSe)o(nd)d(:)k(\('a)e(buffer_cha)o(n)e
(*)k('a\))e(->)h(unit)331 447 y(val)g(bufferAc)o(cep)o(t)e(:)i('a)g
(buffer_ch)o(an)d(->)j('a)331 493 y(val)g(bufferRe)o(cei)o(ve)d(:)j('a)g
(buffer_cha)o(n)e(->)h('a)h(CML.event)292 539 y(end)f(\(*)h(BUFFER_CHA)o(N)e
(*\))190 642 y Fu(There)c(are)g(three)f(dif)o(ferent)e(ways)i(to)f(create)i
(a)g(b)o(uf)o(fered)e(channel.)20 b(If)12 b(you)f(already)h(ha)o(v)o(e)h(a)f
(channel)g(to)f(connect)h(to)g(the)190 702 y(input)c(or)i(output)d(of)i(the)h
(b)o(uf)o(fer)n(,)g(then)f(the)g(functions)f Fp(bufferIn)g
Fu(or)h Fp(bufferOut)f Fu(can)i(be)g(used;)g(otherwise)f(the)g(function)190
761 y Fp(buffer)i Fu(should)g(be)i(used)f(\(as)h(in)e(Example)i(1.8\).)21
b(Buf)o(fered)12 b(channels)g(pro)o(vide)g(an)g(asynchronous)g(output)e
(operation,)190 821 y Fp(bufferSend)p Fu(,)d(and)g(two)g(forms)g(of)g
(synchronous)g(input)e(operation,)j Fp(bufferAccept)d Fu(and)i
Fp(bufferReceive)p Fu(.)12 b(Note)7 b(that)190 881 y(in)j(the)g(case)i(where)
f(you)f(attach)h(an)g(e)o(xisting)e(channel)i(to)e(a)i(b)o(uf)o(fer)f
(\(using)g Fp(bufferIn)f Fu(or)h Fp(bufferOut)p Fu(\),)f(the)h(associated)190
941 y(channel)h(operations)e(may)i(be)g(substituted)d(for)i(the)g(b)o(uf)o
(fer)g(operations.)190 1099 y Fm(B.3)58 b(Futur)o(es)190 1223
y Fu(Futures)16 b(are)h(a)f(construct)f(pro)o(vided)g(by)h
Fr(Multi-lisp)e Fu(for)h(introducing)f(parallel)h(e)o(v)o(aluation)g(of)h(an)
g(e)o(xpression.)32 b(W)m(e)190 1283 y(pro)o(vide)11 b(them,)h(more)g(as)g(a)
g(demonstration)f(of)g(b)o(uilding)e(ne)o(w)i(abstractions,)h(than)f(because)
i(we)f(think)e(the)o(y)h(are)i(useful.)190 1342 y(The)e(functor)253
1431 y Fh(functor)17 b(Future)g(\(CML)h(:)h(CONCUR_ML\))d(:)j(FUTURE)190
1534 y Fu(implements)10 b(this)g(mechanism.)16 b(It)10 b(has)h(the)f
(signature)253 1624 y Fh(signature)16 b(FUTURE)h(=)292 1669
y(sig)331 1715 y(structure)f(CML)j(:)g(CONCUR_ML)331 1760 y(val)g(future)e(:)
i(\('a)g(->)f('2b\))g(->)h('a)g(->)g('2b)f(CML.event)292 1806
y(end)g(\(*)h(FUTURE)e(*\))190 1987 y Fm(B.4)58 b(Cobegin)190
2111 y Fu(The)15 b(structure)e Fp(Cobegin)g Fu(pro)o(vides)h(a)g
(generalization)f(of)h(the)g Fp(spawn)f Fu(operation.)26 b(It)13
b(allo)o(ws)h(a)g(list)f(of)h(threads)g(to)f(be)190 2170 y(spa)o(wned)e(and)f
(returns)g(an)g(e)o(v)o(ent)h(for)e(synchronizing)g(on)g(the)h(termination)f
(of)h(all)f(of)h(the)g(threads)g(\(this)f(is)h(called)g Fn(barrier)190
2230 y(sync)o(hr)n(onization)p Fu(\).)k(The)d(structure)f(is)g(implemented)g
(by)g(the)g(functor)253 2319 y Fh(functor)17 b(Cobegin)f(\(CML)j(:)g
(CONCUR_ML)o(\))e(:)i(COBEGIN)190 2422 y Fu(which)10 b(has)h(the)f(signature)
253 2511 y Fh(signature)16 b(COBEGIN)h(=)i(sig)331 2557 y(structure)d(CML)j
(:)g(CONCUR_ML)331 2603 y(val)g(cobegin)d(:)k(\(unit)d(->)i(unit\))f(list)g
(->)h(unit)f(CML.event)292 2648 y(end)g(\(*)h(COBEGIN)e(*\))1070
2799 y Fu(50)p eop
%%Page: 51 57
51 56 bop 33 82 a Fm(B.5)57 b(Safe)15 b(callcc)33 206 y Fu(This)d(is)h(the)f
(interface)h(of)f(a)i(safe)f(implementation)f(of)g(the)h(\256rst-class)f
(continuation)f(primiti)o(v)o(es.)21 b(A)13 b(thread)g(may)g(only)33
265 y(thro)o(w)d(to)g(one)i(of)f(its)f(o)o(wn)h(continuations;)e(an)j
(attempt)f(to)f(thro)o(w)g(to)h(another)g(thread')n(s)g(continuation)e(will)h
(result)g(in)h(the)33 325 y(e)o(xception)f Fp(BadCont)f Fu(being)g(raised.)95
425 y Fh(signature)16 b(CONCUR_CAL)o(LC)o(C)h(=)134 471 y(sig)173
516 y(exception)g(BadCont)173 562 y(type)h('a)h(cont)173 608
y(val)g(callcc)e(:)i(\('1a)f(cont)g(->)h('1a\))f(->)h('1a)173
653 y(val)g(throw)f(:)h('a)g(cont)f(->)g('a)h(->)g('b)134 699
y(end)912 2799 y Fu(51)p eop
%%Page: 52 58
52 57 bop 190 414 a Fi(A)n(ppendix)21 b(C)190 643 y Fs(Sour)n(ce)26
b(\256les)g(f)m(or)g(examples)190 889 y Fu(The)13 b(source)g(code)g(for)f
(the)g(e)o(xamples)i(of)e(this)f(document)i(are)g(a)o(v)o(ailable)f(on-line)f
(in)h(the)g(distrib)o(ution)e(in)h(the)i(directory)190 949
y(\252)p Fp(cml-0.9.8/examples)p Fu(.)m(\272)g(The)e(follo)o(wing)d(table)i
(maps)h(the)f(e)o(xample)h(numbers)g(to)e(\256le)i(names:)p
709 1018 762 2 v 708 1080 2 63 v 717 1080 V 769 1062 a Fr(Example)p
977 1080 V 194 w(Sour)o(ce)h(File)p 1462 1080 V 1471 1080 V
709 1082 762 2 v 708 1144 2 63 v 717 1144 V 743 1125 a Fu(Example)f(1.1)p
977 1144 V 49 w Fp(ex-simple-comm.sml)p 1462 1144 V 1471 1144
V 709 1146 762 2 v 708 1208 2 63 v 717 1208 V 743 1189 a Fu(Example)g(1.3)p
977 1208 V 49 w Fp(ex-counter.sml)p 1462 1208 V 1471 1208 V
708 1270 V 717 1270 V 977 1270 V 1002 1252 a(ex-sieve.sml)p
1462 1270 V 1471 1270 V 708 1333 V 717 1333 V 977 1333 V 1002
1314 a(ex-primes.sml)p 1462 1333 V 1471 1333 V 709 1334 762
2 v 708 1397 2 63 v 717 1397 V 743 1378 a Fu(Example)g(1.4)p
977 1397 V 49 w Fp(ex-future.sml)p 1462 1397 V 1471 1397 V
709 1398 762 2 v 708 1460 2 63 v 717 1460 V 743 1442 a Fu(Example)g(1.5)p
977 1460 V 49 w Fp(ex-simple-comm2.sml)p 1462 1460 V 1471 1460
V 709 1462 762 2 v 708 1524 2 63 v 717 1524 V 743 1506 a Fu(Example)g(1.6)p
977 1524 V 49 w Fp(ex-token-sig.sml)p 1462 1524 V 1471 1524
V 708 1587 V 717 1587 V 977 1587 V 1002 1568 a(ex-token.sml)p
1462 1587 V 1471 1587 V 709 1588 762 2 v 708 1651 2 63 v 717
1651 V 743 1632 a Fu(Example)g(1.7)p 977 1651 V 49 w Fp(ex-buffer-sig.sml)p
1462 1651 V 1471 1651 V 708 1713 V 717 1713 V 977 1713 V 1002
1694 a(ex-buffer.sml)p 1462 1713 V 1471 1713 V 709 1714 762
2 v 708 1777 2 63 v 717 1777 V 743 1758 a Fu(Example)g(1.8)p
977 1777 V 49 w Fp(ex-multicast-sig.sm)o(l)p 1462 1777 V 1471
1777 V 708 1839 V 717 1839 V 977 1839 V 1002 1820 a(ex-multicast.sml)p
1462 1839 V 1471 1839 V 709 1841 762 2 v 708 1903 2 63 v 717
1903 V 743 1884 a Fu(Example)g(3.1)p 977 1903 V 49 w Fp(ex-simple-comm3.sml)p
1462 1903 V 1471 1903 V 709 1905 762 2 v 708 1967 2 63 v 717
1967 V 743 1948 a Fu(Example)g(4.1)p 977 1967 V 49 w Fp(ex-future-cv.sml)p
1462 1967 V 1471 1967 V 709 1969 762 2 v 708 2031 2 63 v 717
2031 V 743 2012 a Fu(Example)g(5.1)p 977 2031 V 49 w Fp(ex-get-answer.sml)p
1462 2031 V 1471 2031 V 709 2032 762 2 v 708 2095 2 63 v 717
2095 V 743 2076 a Fu(Example)g(6.1)p 977 2095 V 49 w Fp(ex-unique-sig.sml)p
1462 2095 V 1471 2095 V 708 2157 V 717 2157 V 977 2157 V 1002
2138 a(ex-unique.sml)p 1462 2157 V 1471 2157 V 709 2159 762
2 v 1070 2799 a Fu(52)p eop
%%Trailer
end
userdict /end-hook known{end-hook}if
%%EOF
